<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HuShengBinâ€™s blog</title>
  
  <subtitle>ç æ¸£çš„ä¸ªäººåšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://hsb786.github.io/"/>
  <updated>2018-04-24T05:25:15.267Z</updated>
  <id>https://hsb786.github.io/</id>
  
  <author>
    <name>HuShengBin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å±±é¬¼</title>
    <link href="https://hsb786.github.io/2018/04/24/%E5%B1%B1%E9%AC%BC/"/>
    <id>https://hsb786.github.io/2018/04/24/å±±é¬¼/</id>
    <published>2018-04-24T05:10:17.000Z</published>
    <updated>2018-04-24T05:25:15.267Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘åœ¨å¾ªç¯çš„ä¸€é¦–éŸ³ä¹ï¼Œæ­Œè¯å‡ºè‡ªå±ˆåŸã€Šæ¥šè¾Â·ä¹æ­Œã€‹ä¸­çš„ç¬¬ä¹ç« ã€‚<br><a id="more"></a></p></blockquote><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=445198021&auto=0&height=66"></iframe><p><strong>ä¹æ­ŒÂ·å±±é¬¼</strong></p><p> è‹¥æœ‰äººå…®å±±ä¹‹é˜¿ï¼Œè¢«è–œè”å…®å¸¦å¥³ç½—ã€‚</p><p> æ—¢å«ç‡å…®åˆå®œç¬‘ï¼Œå­æ…•äºˆå…®å–„çªˆçª•ã€‚</p><p> ä¹˜èµ¤è±¹å…®ä»æ–‡é‡Œï¼Œè¾›å¤·è½¦å…®ç»“æ——ã€‚</p><p> è¢«çŸ³å…°å…®å¸¦æœè¡¡ã€‚æŠ˜èŠ³é¦¨å…®é—æ‰€æ€ã€‚</p><p> ä½™å¤„å¹½ç¯å…®ç»ˆä¸è§å¤©ï¼Œè·¯é™©éš¾å…®ç‹¬åæ¥ã€‚</p><p> è¡¨ç‹¬ç«‹å…®å±±ä¹‹ç±»ä¸Šï¼Œäº‘å®¹å®¹å…®è€Œåœ¨ä¸‹ã€‚</p><p> æ³å†¥å†¥å…®ç¾Œæ˜¼æ™¦ï¼Œä¸œé£é£˜å…®ç¥çµé›¨ã€‚</p><p> ç•™çµä¿®å…®å¿˜å½’ï¼Œå²æ—¢æ™å…®å­°åäºˆã€‚</p><p> é‡‡ä¸‰ç§€å…®æ–¼å±±é—´ï¼ŒçŸ³ç£Šç£Šå…®è‘›è”“è”“ã€‚</p><p> æ€¨å…¬å­å…®æ€…å¿˜å½’ï¼Œå›æ€æˆ‘å…®ä¸å¾—é—²ã€‚</p><p> å±±ä¸­äººå…®èŠ³æœè‹¥ï¼Œé¥®çŸ³æ³‰å…®è«æ¾æŸã€‚</p><p> å›æˆ‘å…®ç„¶ç–‘ä½œã€‚</p><p> é›·å¡«å¡«å…®é›¨å†¥å†¥ï¼ŒçŒ¿å•¾å•¾å…®åˆå¤œé¸£ã€‚</p><p> é£é£’é£’å…®æœ¨è§è§ï¼Œæ€å…¬å­å…®å¾™ç¦»å¿§ã€‚ </p><hr><p> <a href="https://music.douban.com/review/8790064/" target="_blank" rel="noopener"> å±±é¬¼è‡ªå•¼é£é›¨Â·ã€Šå±±é¬¼ã€‹ä¹è¯„. </a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘åœ¨å¾ªç¯çš„ä¸€é¦–éŸ³ä¹ï¼Œæ­Œè¯å‡ºè‡ªå±ˆåŸã€Šæ¥šè¾Â·ä¹æ­Œã€‹ä¸­çš„ç¬¬ä¹ç« ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hsb786.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="æ‚è°ˆ" scheme="https://hsb786.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>RandomAccess</title>
    <link href="https://hsb786.github.io/2018/04/23/RandomAccess/"/>
    <id>https://hsb786.github.io/2018/04/23/RandomAccess/</id>
    <published>2018-04-23T10:30:51.000Z</published>
    <updated>2018-04-23T10:58:03.042Z</updated>
    
    <content type="html"><![CDATA[<p>JDKå®˜æ–¹æ–‡æ¡£ä¸Šçš„è§£é‡Šï¼š</p><blockquote><p>Marker interface used by List implementations to indicate that they support fast (generally constant time) random access.  The primary purpose of this interface is to allow generic algorithms to alter their behavior to provide good performance when applied to either random or sequential access lists.<br>å¤§è‡´æ„æ€å°±æ˜¯ï¼šRandomAccess æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨äºæ ‡æ˜å®ç°è¯¥æ¥å£çš„Listæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œä¸»è¦ç›®çš„æ˜¯ä½¿ç®—æ³•èƒ½å¤Ÿåœ¨éšæœºé¡ºåºè®¿é—®çš„listä¸­è¡¨ç°çš„æ›´åŠ é«˜æ•ˆã€‚<br><a id="more"></a></p></blockquote><p>åªå®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public interface RandomAccess &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨é‡Šä¸Šä¸¾äº†ä¸ªæ —å­ğŸ‚ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­ç¬¬ä¸€ç§å¾ªç¯è¿è¡Œæ¯”ç¬¬äºŒç§å¿«<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">this loop:</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> *     for (int i=0, n=list.size(); i &amp;lt; n; i++)</span><br><span class="line"> *         list.get(i);</span><br><span class="line"> * &lt;/pre&gt;</span><br><span class="line"> * runs faster than this loop:</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> *     for (Iterator i=list.iterator(); i.hasNext(); )</span><br><span class="line"> *         i.next();</span><br><span class="line"> * &lt;/pre&gt;</span><br></pre></td></tr></table></figure></p><p>soï¼Œåœ¨éå†ArrayListæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ç¬¬ä¸€ç§å¾ªç¯ï¼›åœ¨éå†LinkedListåˆ™ä½¿ç”¨ç¬¬äºŒç§å¾ªç¯ã€‚<br>æ ¹æ®æœ‰æ²¡æœ‰å®ç°RandomAccessæ¥å£æ¥åˆ¤æ–­ã€‚<br>ArrayListå®ç°äº†RandomAccessæ¥å£ï¼ŒLinkedListæ²¡æœ‰å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//Collections.class</span><br><span class="line">public static &lt;T&gt;</span><br><span class="line">int binarySearch(List&lt;? extends Comparable&lt;? super T&gt;&gt; list, T key) &#123;</span><br><span class="line">    if (list instanceof RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD)</span><br><span class="line">        return Collections.indexedBinarySearch(list, key);</span><br><span class="line">    else</span><br><span class="line">        return Collections.iteratorBinarySearch(list, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>foreachå†…éƒ¨æ˜¯é€šè¿‡Iteratorå®ç°çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class T01 &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">List&lt;String&gt; list=new ArrayList&lt;&gt;();</span><br><span class="line">list.add(&quot;a&quot;);</span><br><span class="line">list.add(&quot;b&quot;);</span><br><span class="line">for(String s:list) &#123;</span><br><span class="line">System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ã€‚<br>ä»ç¬¬27ï¼Œ37ï¼Œ54è¡Œå¯ä»¥çœ‹å‡ºï¼Œforeachå…¶å®æ˜¯é€šè¿‡Iteratoræ¥å®ç°çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class al.T01 &#123;</span><br><span class="line">  public al.T01();</span><br><span class="line">    Code:</span><br><span class="line">       0: aload_0</span><br><span class="line">       1: invokespecial #8                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       4: return</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]) throws java.lang.Exception;</span><br><span class="line">    Code:</span><br><span class="line">       0: new           #19                 // class java/util/ArrayList</span><br><span class="line">       3: dup</span><br><span class="line">       4: invokespecial #21                 // Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       7: astore_1</span><br><span class="line">       8: aload_1</span><br><span class="line">       9: ldc           #22                 // String a</span><br><span class="line">      11: invokeinterface #24,  2           // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z</span><br><span class="line">      16: pop</span><br><span class="line">      17: aload_1</span><br><span class="line">      18: ldc           #30                 // String b</span><br><span class="line">      20: invokeinterface #24,  2           // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z</span><br><span class="line">      25: pop</span><br><span class="line">      26: aload_1</span><br><span class="line">      27: invokeinterface #32,  1           // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;</span><br><span class="line">      32: astore_3</span><br><span class="line">      33: goto          53</span><br><span class="line">      36: aload_3</span><br><span class="line">      37: invokeinterface #36,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;</span><br><span class="line">      42: checkcast     #42                 // class java/lang/String</span><br><span class="line">      45: astore_2</span><br><span class="line">      46: getstatic     #44                 // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">      49: aload_2</span><br><span class="line">      50: invokevirtual #50                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">      53: aload_3</span><br><span class="line">      54: invokeinterface #56,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z</span><br><span class="line">      59: ifne          36</span><br><span class="line">      62: return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JDKå®˜æ–¹æ–‡æ¡£ä¸Šçš„è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Marker interface used by List implementations to indicate that they support fast (generally constant time) random access.  The primary purpose of this interface is to allow generic algorithms to alter their behavior to provide good performance when applied to either random or sequential access lists.&lt;br&gt;å¤§è‡´æ„æ€å°±æ˜¯ï¼šRandomAccess æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨äºæ ‡æ˜å®ç°è¯¥æ¥å£çš„Listæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œä¸»è¦ç›®çš„æ˜¯ä½¿ç®—æ³•èƒ½å¤Ÿåœ¨éšæœºé¡ºåºè®¿é—®çš„listä¸­è¡¨ç°çš„æ›´åŠ é«˜æ•ˆã€‚&lt;br&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>HotSpot</title>
    <link href="https://hsb786.github.io/2018/04/23/HotSpot/"/>
    <id>https://hsb786.github.io/2018/04/23/HotSpot/</id>
    <published>2018-04-23T10:15:36.000Z</published>
    <updated>2018-04-23T12:52:33.687Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç»å¸¸çœ‹åˆ°HotSpotï¼Œä½†ä¸çŸ¥é“æ˜¯ä»€ä¹ˆã€‚soï¼Œè¿™æ˜¯ä¸€ç¯‡ç§‘æ™®æ–‡ã€‚æ‘˜è‡ª&lt;&lt;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ&gt;&gt;ã€‚ç­‰ä»¥åå·¥ä½œäº†ï¼Œä¸€å®šè¦çœ‹è¿™æœ¬ç¥ä¹¦ï¼Œçœ‹ä¸‹æœ‰æ²¡æœ‰ä¼ è¯´ä¸­çš„é‚£ä¹ˆç¥å¥‡ã€‚ğŸ™„ğŸ™„</p></blockquote><a id="more"></a><p>æèµ·HotSpot VMï¼Œç›¸ä¿¡æ‰€æœ‰Javaç¨‹åºå‘˜éƒ½çŸ¥é“ï¼Œå®ƒæ˜¯Sun JDKå’ŒOpenJDKä¸­æ‰€å¸¦çš„è™šæ‹Ÿæœºï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿çš„Javaè™šæ‹Ÿæœºã€‚ä½†ä¸ä¸€å®šæ‰€æœ‰äººéƒ½çŸ¥é“çš„æ˜¯ï¼Œè¿™ä¸ªç›®å‰çœ‹èµ·æ¥â€œè¡€ç»Ÿçº¯æ­£â€çš„è™šæ‹Ÿæœºåœ¨æœ€åˆå¹¶éç”±Sunå…¬å¸å¼€å‘ï¼Œè€Œæ˜¯ç”±ä¸€å®¶åä¸ºâ€œLongview Technologiesâ€çš„å°å…¬å¸è®¾è®¡çš„ï¼›ç”šè‡³è¿™ä¸ªè™šæ‹Ÿæœºæœ€åˆå¹¶éæ˜¯ä¸ºJavaè¯­è¨€è€Œå¼€å‘çš„ï¼Œå®ƒæ¥æºäºStrongtalk VMï¼Œè€Œè¿™æ¬¾è™šæ‹Ÿæœºä¸­ç›¸å½“å¤šçš„æŠ€æœ¯åˆæ˜¯æ¥æºäºä¸€æ¬¾æ”¯æŒSelfè¯­è¨€å®ç°â€œè¾¾åˆ°Cè¯­è¨€50%ä»¥ä¸Šçš„æ‰§è¡Œæ•ˆç‡â€çš„ç›®æ ‡è€Œè®¾è®¡çš„è™šæ‹Ÿæœºï¼ŒSunå…¬å¸æ³¨æ„åˆ°äº†è¿™æ¬¾è™šæ‹Ÿæœºåœ¨JITç¼–è¯‘ä¸Šæœ‰è®¸å¤šä¼˜ç§€çš„ç†å¿µå’Œå®é™…æ•ˆæœï¼Œåœ¨1997å¹´æ”¶è´­äº†Longview Technologieså…¬å¸ï¼Œä»è€Œè·å¾—äº†HotSpot VMã€‚</p><p>HotSpot VMæ—¢ç»§æ‰¿äº†Sunä¹‹å‰ä¸¤æ¬¾å•†ç”¨è™šæ‹Ÿæœºçš„ä¼˜ç‚¹ï¼ˆå¦‚å‰é¢æåˆ°çš„å‡†ç¡®å¼å†…å­˜ç®¡ç†ï¼‰ï¼Œä¹Ÿæœ‰è®¸å¤šè‡ªå·±æ–°çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œå¦‚å®ƒåç§°ä¸­çš„HotSpotæŒ‡çš„å°±æ˜¯å®ƒçš„çƒ­ç‚¹ä»£ç æ¢æµ‹æŠ€æœ¯ï¼ˆå…¶å®ä¸¤ä¸ªVMåŸºæœ¬ä¸Šæ˜¯åŒæ—¶æœŸçš„ç‹¬ç«‹äº§å“ï¼ŒHotSpotè¿˜ç¨æ—©ä¸€äº›ï¼ŒHotSpotä¸€å¼€å§‹å°±æ˜¯å‡†ç¡®å¼GCï¼Œè€ŒExact VMä¹‹ä¸­ä¹Ÿæœ‰ä¸HotSpotå‡ ä¹ä¸€æ ·çš„çƒ­ç‚¹æ¢æµ‹ã€‚ä¸ºäº†Exact VMå’ŒHotSpot VMå“ªä¸ªæˆä¸ºSunä¸»è¦æ”¯æŒçš„VMäº§å“ï¼Œåœ¨Sunå…¬å¸å†…éƒ¨è¿˜æœ‰è¿‡äº‰è®ºï¼ŒHotSpotæ‰“è´¥Exactå¹¶ä¸èƒ½ç®—æŠ€æœ¯ä¸Šçš„èƒœåˆ©ï¼‰ï¼Œ<strong>HotSpot VMçš„çƒ­ç‚¹ä»£ç æ¢æµ‹èƒ½åŠ›å¯ä»¥é€šè¿‡æ‰§è¡Œè®¡æ•°å™¨æ‰¾å‡ºæœ€å…·æœ‰ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œç„¶åé€šçŸ¥<a href="https://hsb786.github.io/2018/04/09/æœ¯è¯­/">JITç¼–è¯‘å™¨</a>ä»¥æ–¹æ³•ä¸ºå•ä½è¿›è¡Œç¼–è¯‘ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•è¢«é¢‘ç¹è°ƒç”¨ï¼Œæˆ–æ–¹æ³•ä¸­æœ‰æ•ˆå¾ªç¯æ¬¡æ•°å¾ˆå¤šï¼Œå°†ä¼šåˆ†åˆ«è§¦å‘æ ‡å‡†ç¼–è¯‘å’ŒOSRï¼ˆæ ˆä¸Šæ›¿æ¢ï¼‰ç¼–è¯‘åŠ¨ä½œã€‚é€šè¿‡ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨æ°å½“åœ°ååŒå·¥ä½œï¼Œå¯ä»¥åœ¨æœ€ä¼˜åŒ–çš„ç¨‹åºå“åº”æ—¶é—´ä¸æœ€ä½³æ‰§è¡Œæ€§èƒ½ä¸­å–å¾—å¹³è¡¡ï¼Œè€Œä¸”æ— é¡»ç­‰å¾…æœ¬åœ°ä»£ç è¾“å‡ºæ‰èƒ½æ‰§è¡Œç¨‹åºï¼Œå³æ—¶ç¼–è¯‘çš„æ—¶é—´å‹åŠ›ä¹Ÿç›¸å¯¹å‡å°ï¼Œè¿™æ ·æœ‰åŠ©äºå¼•å…¥æ›´å¤šçš„ä»£ç ä¼˜åŒ–æŠ€æœ¯ï¼Œè¾“å‡ºè´¨é‡æ›´é«˜çš„æœ¬åœ°ä»£ç ã€‚</strong></p><p>åœ¨2006å¹´çš„JavaOneå¤§ä¼šä¸Šï¼ŒSunå…¬å¸å®£å¸ƒæœ€ç»ˆä¼šæŠŠJavaå¼€æºï¼Œå¹¶åœ¨éšåçš„ä¸€å¹´ï¼Œé™†ç»­å°†JDKçš„å„ä¸ªéƒ¨åˆ†ï¼ˆå…¶ä¸­å½“ç„¶ä¹ŸåŒ…æ‹¬äº†HotSpot VMï¼‰åœ¨GPLåè®®ä¸‹å…¬å¼€äº†æºç ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå»ºç«‹äº†OpenJDKã€‚è¿™æ ·ï¼ŒHotSpot VMä¾¿æˆä¸ºäº†Sun JDKå’ŒOpenJDKä¸¤ä¸ªå®ç°æåº¦æ¥è¿‘çš„JDKé¡¹ç›®çš„å…±åŒè™šæ‹Ÿæœºã€‚</p><p>åœ¨2008å¹´å’Œ2009å¹´ï¼ŒOracleå…¬å¸åˆ†åˆ«æ”¶è´­äº†BEAå…¬å¸å’ŒSunå…¬å¸ï¼Œè¿™æ ·Oracleå°±åŒæ—¶æ‹¥æœ‰äº†ä¸¤æ¬¾ä¼˜ç§€çš„Javaè™šæ‹Ÿæœºï¼šJRockit VMå’ŒHotSpot VMã€‚Oracleå…¬å¸å®£å¸ƒåœ¨ä¸ä¹…çš„å°†æ¥ï¼ˆå¤§çº¦åº”åœ¨å‘å¸ƒJDK 8çš„æ—¶å€™ï¼‰ä¼šå®Œæˆè¿™ä¸¤æ¬¾è™šæ‹Ÿæœºçš„æ•´åˆå·¥ä½œï¼Œä½¿ä¹‹ä¼˜åŠ¿äº’è¡¥ã€‚æ•´åˆçš„æ–¹å¼å¤§è‡´ä¸Šæ˜¯åœ¨HotSpotçš„åŸºç¡€ä¸Šï¼Œç§»æ¤JRockitçš„ä¼˜ç§€ç‰¹æ€§ï¼Œè­¬å¦‚ä½¿ç”¨JRockitçš„åƒåœ¾å›æ”¶å™¨ä¸MissionControlæœåŠ¡ï¼Œä½¿ç”¨HotSpotçš„JITç¼–è¯‘å™¨ä¸æ··åˆçš„è¿è¡Œæ—¶ç³»ç»Ÿã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç»å¸¸çœ‹åˆ°HotSpotï¼Œä½†ä¸çŸ¥é“æ˜¯ä»€ä¹ˆã€‚soï¼Œè¿™æ˜¯ä¸€ç¯‡ç§‘æ™®æ–‡ã€‚æ‘˜è‡ª&amp;lt;&amp;lt;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ&amp;gt;&amp;gt;ã€‚ç­‰ä»¥åå·¥ä½œäº†ï¼Œä¸€å®šè¦çœ‹è¿™æœ¬ç¥ä¹¦ï¼Œçœ‹ä¸‹æœ‰æ²¡æœ‰ä¼ è¯´ä¸­çš„é‚£ä¹ˆç¥å¥‡ã€‚ğŸ™„ğŸ™„&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JVM" scheme="https://hsb786.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://hsb786.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>LinkedHashMap</title>
    <link href="https://hsb786.github.io/2018/04/22/LinkedHashMap/"/>
    <id>https://hsb786.github.io/2018/04/22/LinkedHashMap/</id>
    <published>2018-04-22T11:37:01.000Z</published>
    <updated>2018-04-23T11:06:33.655Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>LinkedHashMap ä¿è¯æ’å…¥æ•°æ®çš„æœ‰åºæ€§</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; implements Map&lt;K,V&gt;&#123;</span><br><span class="line">    static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            super(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The head (eldest) of the doubly linked list.</span><br><span class="line">     */</span><br><span class="line">    transient LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The tail (youngest) of the doubly linked list.</span><br><span class="line">     */</span><br><span class="line">    transient LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span><br><span class="line">     * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span><br><span class="line">     *</span><br><span class="line">     * @serial</span><br><span class="line">     */</span><br><span class="line">    final boolean accessOrder;</span><br><span class="line"></span><br><span class="line">    public LinkedHashMap() &#123;</span><br><span class="line">        super();</span><br><span class="line">        accessOrder = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LinkedHashMapå†…éƒ¨æ²¡æœ‰é‡å†™putæ–¹æ³•ï¼Œå¾ˆå¥½å¥‡ï¼Œæ˜¯æ€ä¹ˆæŠŠé“¾è¡¨åŠ ä¸Šå»çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//HashMap.class</span><br><span class="line">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,boolean evict) &#123;</span><br><span class="line">    ....................</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ç¯‡åšå®¢ä¸Šçœ‹åˆ°åŠ é“¾è¡¨æ˜¯é€šè¿‡<code>afterNodeInsertion(evict)</code>ã€‚å¯ä»¥çœ‹å‡ºæ¯æ¬¡putçš„æ—¶å€™éƒ½è°ƒç”¨äº†<code>afterNodeInsertion(evict)</code>; è€Œè¿™ä¸ªafterNodeInsertionåœ¨LinkedHashMapä¸­æ˜¯é‡å†™äº†çš„ã€‚ç„¶åå°±å‚»å‘¼å‘¼çš„ç›¸ä¿¡äº†ï¼Œbut åœ¨<code>afterNodeInsertion(evict)</code>ä¸­å¹¶æ²¡æœ‰æ·»åŠ é“¾è¡¨å•Šï¼Œå‚»å‚»çš„ç›¯ç€è¿™æ®µä»£ç çœ‹äº†å¾ˆä¹…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">    if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">        K key = first.key;</span><br><span class="line">        removeNode(hash(key), key, null, false, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯ï¼Œå¼€å§‹è‡ªå·±æ‰¾ã€‚å‘ç°äº†<code>linkNodeLast()</code>æ–¹æ³•ï¼Œè¿™ä¸å°±æ˜¯å®ç°é“¾è¡¨çš„å…³é”®å—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// link at the end of list</span><br><span class="line">private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123;</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">    tail = p;</span><br><span class="line">    if (last == null)</span><br><span class="line">        head = p;</span><br><span class="line">    else &#123;</span><br><span class="line">        p.before = last;</span><br><span class="line">        last.after = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ç€å‘ç°<code>linkNodeLast()</code>åœ¨<code>newNode()</code>ä¸­è°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123;</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">        new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e);</span><br><span class="line">    linkNodeLast(p);</span><br><span class="line">    return p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¹¶ä¸”newNode()åœ¨HashMapä¸­ä¹Ÿå­˜åœ¨ï¼Œæ³¨é‡Šè¿˜å†™å¾—æ¸…æ¸…æ¥šæ¥šï¼Œå°±æ˜¯ç”¨æ¥è¢«LinkedHashMapé‡å†™çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//HashMap.class</span><br><span class="line">/* ------------------------------------------------------------ */</span><br><span class="line">// LinkedHashMap support</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* The following package-protected methods are designed to be</span><br><span class="line">* overridden by LinkedHashMap, but not by any other subclass.</span><br><span class="line">* Nearly all other internal methods are also package-protected</span><br><span class="line">* but are declared final, so can be used by LinkedHashMap, view</span><br><span class="line">* classes, and HashSet.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// Create a regular (non-tree) node</span><br><span class="line">Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">    return new Node&lt;&gt;(hash, key, value, next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨<code>putVal()</code>ä¸­è°ƒç”¨äº†<code>newNode()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span><br><span class="line">                   boolean evict) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</span><br><span class="line">        if ((tab = table) == null || (n = tab.length) == 0)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        if ((p = tab[i = (n - 1) &amp; hash]) == null)</span><br><span class="line">            tab[i] = newNode(hash, key, value, null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±è§£é‡Šé€šäº†ï¼ŒLinkedHashMapæ²¡æœ‰é‡å†™putæ–¹æ³•ã€‚ä¸ºäº†ä¿è¯æœ‰åºï¼Œé‚£ä¹ˆä»–æ˜¯æ€ä¹ˆå®ç°é“¾è¡¨çš„å‘¢ï¼Ÿ</p><p>åˆ©ç”¨å¤šæ€ï¼Œé€šè¿‡é‡å†™<code>newNode()</code>æ–¹æ³•ï¼Œåœ¨<code>newNode()</code>æ–¹æ³•ä¸­å®ç°äº†é“¾è¡¨çš„è¿æ¥ã€‚è€Œ<code>newNode</code>æ–¹æ³•åœ¨<code>putVal()</code>ä¸­è°ƒç”¨äº†ã€‚soï¼Œæ¯æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚é€šè¿‡é“¾è¡¨å®ç°äº†æœ‰åºã€‚</p><p>çœ‹æ¥ï¼Œå¹³æ—¶ä¸èƒ½å¤ªä¾èµ–äºç½‘ä¸Šåˆ«äººåˆ†æçš„ä¸œè¥¿ï¼Œä¸ä¸€å®šæ˜¯å¯¹çš„ã€‚</p><hr><p><strong>accessOrder</strong></p><p>LinkedHashMapä¸­å®šä¹‰äº†accessOrderå±æ€§ã€‚å®˜æ–¹æ˜¯è¿™æ ·è§£é‡Šçš„ï¼šaccessOrderä¸ºtrueæ—¶ï¼Œè¿­ä»£é¡ºåºå°±æ˜¯è®¿é—®é¡ºåºï¼›ä¸ºfalseæ—¶ï¼Œè¿­ä»£é¡ºåºå°±æ˜¯æ’å…¥é¡ºåºã€‚<br>æ’å…¥é¡ºåºå€’å¥½ç†è§£ï¼Œè®¿é—®é¡ºåºæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span><br><span class="line">* for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span><br><span class="line">*</span><br><span class="line">* @serial</span><br><span class="line">*/</span><br><span class="line">final boolean accessOrder;</span><br></pre></td></tr></table></figure></p><p>LinkedHashMapé‡å†™äº†<code>get(Object key)</code>æ–¹æ³•ã€‚accessOrderä¸ºtrueæ—¶ï¼Œè°ƒç”¨äº†<code>afterNodeAccess(e);</code>æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public V get(Object key) &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    if ((e = getNode(hash(key), key)) == null)</span><br><span class="line">        return null;</span><br><span class="line">    if (accessOrder)</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">    return e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>void afterNodeAccess(Node&lt;K,V&gt; e)</code> æ–¹æ³•æ³¨è§£å†™çš„å¾ˆæ˜ç™½ï¼Œmove node to lastï¼ŒæŠŠnodeç§»åŠ¨åˆ°æœ€åã€‚æ„æ€å°±æ˜¯å¦‚æœaccessOrderè®¾ä¸ºtrueæ—¶ï¼Œæ¯æ¬¡é€šè¿‡get()è·å–ï¼Œéƒ½ä¼šæŠŠè·å–çš„å…ƒç´ ç§»åˆ°é“¾è¡¨çš„æœ€åé¢ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">    if (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">        p.after = null;</span><br><span class="line">        if (b == null)</span><br><span class="line">            head = a;</span><br><span class="line">        else</span><br><span class="line">            b.after = a;</span><br><span class="line">        if (a != null)</span><br><span class="line">            a.before = b;</span><br><span class="line">        else</span><br><span class="line">            last = b;</span><br><span class="line">        if (last == null)</span><br><span class="line">            head = p;</span><br><span class="line">        else &#123;</span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">        tail = p;</span><br><span class="line">        ++modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>final boolean accessOrder;</code> accessOrderåŒ…è®¿é—®æƒé™ï¼Œä¹Ÿæ²¡æœ‰setæ–¹æ³•ï¼Œåªèƒ½é€šè¿‡<code>public LinkedHashMap(int initialCapacity,float loadFactor, boolean accessOrder)</code> æ„é€ å‡½æ•°æ¥å°†accessOrderè®¾ä¸ºtrueã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public LinkedHashMap(int initialCapacity,</span><br><span class="line">                         float loadFactor,</span><br><span class="line">                         boolean accessOrder) &#123;</span><br><span class="line">        super(initialCapacity, loadFactor);</span><br><span class="line">        this.accessOrder = accessOrder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;LinkedHashMap ä¿è¯æ’å…¥æ•°æ®çš„æœ‰åºæ€§&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
      <category term="é›†åˆ" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/%E9%9B%86%E5%90%88/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>HashSet</title>
    <link href="https://hsb786.github.io/2018/04/22/HashSet/"/>
    <id>https://hsb786.github.io/2018/04/22/HashSet/</id>
    <published>2018-04-22T10:44:43.000Z</published>
    <updated>2018-04-22T11:37:57.346Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>HashSet åº•å±‚ç”±HashMapå®ç°<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class HashSet&lt;E&gt; extends AbstractSet&lt;E&gt; implements Set&lt;E&gt;, Cloneable, java.io.Serializable&#123;</span><br><span class="line">    //HashSetåº•å±‚ä½¿ç”¨HashMapå®ç°</span><br><span class="line">    private transient HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line">    // Dummy value to associate with an Object in the backing Map</span><br><span class="line">    //HashSet add(E e)æ–¹æ³•ä¸­ï¼Œkeyä¸ºeï¼Œvalueä¸ºPRESENT</span><br><span class="line">    private static final Object PRESENT = new Object();</span><br><span class="line"></span><br><span class="line">    public HashSet() &#123;</span><br><span class="line">        map = new HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructs a new, empty linked hash set.  (This package private</span><br><span class="line">     * constructor is only used by LinkedHashSet.) The backing</span><br><span class="line">     * HashMap instance is a LinkedHashMap with the specified initial</span><br><span class="line">     * capacity and the specified load factor.</span><br><span class="line">     *</span><br><span class="line">     * @param      initialCapacity   the initial capacity of the hash map</span><br><span class="line">     * @param      loadFactor        the load factor of the hash map</span><br><span class="line">     * @param      dummy             ignored (distinguishes this</span><br><span class="line">     *             constructor from other int, float constructor.)</span><br><span class="line">     * @throws     IllegalArgumentException if the initial capacity is less</span><br><span class="line">     *             than zero, or if the load factor is nonpositive</span><br><span class="line">     */</span><br><span class="line">     //è¿™ä¸ªå°±æœ‰ç‚¹æ„æ€äº†ï¼Œdummyå‚æ•°å…¶å®æ²¡ç”¨ï¼Œåªæ˜¯ä¸ºäº†é‡è½½ï¼Œä¸å…¶å®ƒæ–¹æ³•åŒºåˆ†å¼€äº†è€Œå·²ï¼Œè¿™æ ·ä¹Ÿè¡Œï¼</span><br><span class="line">     //æ³¨æ„çš„æ˜¯è¿”å›çš„æ˜¯LinkedHashMapï¼Œæ•°æ®æ˜¯æœ‰é¡ºåºçš„ã€‚</span><br><span class="line">    HashSet(int initialCapacity, float loadFactor, boolean dummy) &#123;</span><br><span class="line">        map = new LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p><code>add(E e)</code>,<code>remove(Object o)</code>åªæ˜¯ç›´æ¥è°ƒç”¨HashMapçš„putå’Œremoveæ–¹æ³•ã€‚<br>key: e ; value : PRESENT<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public boolean add(E e) &#123;</span><br><span class="line">    return map.put(e, PRESENT)==null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public boolean remove(Object o) &#123;</span><br><span class="line">    return map.remove(o)==PRESENT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;HashSet åº•å±‚ç”±HashMapå®ç°&lt;br&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
      <category term="é›†åˆ" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/%E9%9B%86%E5%90%88/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>Javaå†…å­˜è®¿é—®é‡æ’åºçš„ç ”ç©¶ï¼ˆè½¬è½½ï¼‰</title>
    <link href="https://hsb786.github.io/2018/04/21/Java%E5%86%85%E5%AD%98%E8%AE%BF%E9%97%AE%E9%87%8D%E6%8E%92%E5%BA%8F%E7%9A%84%E7%A0%94%E7%A9%B6/"/>
    <id>https://hsb786.github.io/2018/04/21/Javaå†…å­˜è®¿é—®é‡æ’åºçš„ç ”ç©¶/</id>
    <published>2018-04-21T13:40:14.000Z</published>
    <updated>2018-04-24T05:49:34.283Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç¾å›¢æŠ€æœ¯åšå®¢ä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œè®²çš„å¾ˆå¥½ï¼Œå°±æ˜¯åˆ°äº†åé¢æœ‰äº›çœ‹ä¸å¤ªæ‡‚ï¼Œåªèƒ½æ€ªè‡ªå·±å¤ªèœäº†ã€‚<a href="https://tech.meituan.com/java-memory-reordering.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a><br><a id="more"></a></p></blockquote><h2 id="ä»€ä¹ˆæ˜¯é‡æ’åº"><a href="#ä»€ä¹ˆæ˜¯é‡æ’åº" class="headerlink" title="ä»€ä¹ˆæ˜¯é‡æ’åº"></a>ä»€ä¹ˆæ˜¯é‡æ’åº</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class PossibleReordering &#123;</span><br><span class="line">static int x = 0, y = 0;</span><br><span class="line">static int a = 0, b = 0;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">    Thread one = new Thread(new Runnable() &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            a = 1;</span><br><span class="line">            x = b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Thread other = new Thread(new Runnable() &#123;</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            b = 1;</span><br><span class="line">            y = a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    one.start();other.start();</span><br><span class="line">    one.join();other.join();</span><br><span class="line">    System.out.println(â€œ(â€ + x + â€œ,â€ + y + â€œ)â€);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“æƒ³åˆ°è¿™æ®µä»£ç çš„è¿è¡Œç»“æœå¯èƒ½ä¸º(1,0)ã€(0,1)æˆ–(1,1)ï¼Œå› ä¸ºçº¿ç¨‹oneå¯ä»¥åœ¨çº¿ç¨‹twoå¼€å§‹ä¹‹å‰å°±æ‰§è¡Œå®Œäº†ï¼Œä¹Ÿæœ‰å¯èƒ½åä¹‹ï¼Œç”šè‡³æœ‰å¯èƒ½äºŒè€…çš„æŒ‡ä»¤æ˜¯åŒæ—¶æˆ–äº¤æ›¿æ‰§è¡Œçš„ã€‚</p><p>ç„¶è€Œï¼Œè¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœä¹Ÿå¯èƒ½æ˜¯(0,0). å› ä¸ºï¼Œåœ¨å®é™…è¿è¡Œæ—¶ï¼Œä»£ç æŒ‡ä»¤å¯èƒ½å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§ä»£ç è¯­å¥é¡ºåºæ‰§è¡Œçš„ã€‚å¾—åˆ°(0,0)ç»“æœçš„è¯­å¥æ‰§è¡Œè¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œa=1å’Œx=bè¿™ä¸¤ä¸ªè¯­å¥çš„èµ‹å€¼æ“ä½œçš„é¡ºåºè¢«é¢ å€’äº†ï¼Œæˆ–è€…è¯´ï¼Œå‘ç”Ÿäº†æŒ‡ä»¤â€œé‡æ’åºâ€(reordering)ã€‚ï¼ˆäº‹å®ä¸Šï¼Œè¾“å‡ºäº†è¿™ä¸€ç»“æœï¼Œå¹¶ä¸ä»£è¡¨ä¸€å®šå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºï¼Œå†…å­˜å¯è§æ€§é—®é¢˜ä¹Ÿä¼šå¯¼è‡´è¿™æ ·çš„è¾“å‡ºï¼Œè¯¦è§åæ–‡ï¼‰</p><p><img src="/images/reordered01.png" alt=""></p><p>å¯¹é‡æ’åºç°è±¡ä¸å¤ªäº†è§£çš„å¼€å‘è€…å¯èƒ½ä¼šå¯¹è¿™ç§ç°è±¡æ„Ÿåˆ°åƒæƒŠï¼Œä½†æ˜¯ï¼Œç¬”è€…å¼€å‘ç¯å¢ƒä¸‹åšçš„ä¸€ä¸ªå°å®éªŒè¯å®äº†è¿™ä¸€ç»“æœã€‚</p><p><img src="/images/reordered02.png" alt=""></p><p>å®éªŒä»£ç æ˜¯æ„é€ ä¸€ä¸ªå¾ªç¯ï¼Œåå¤æ‰§è¡Œä¸Šé¢çš„å®ä¾‹ä»£ç ï¼Œç›´åˆ°å‡ºç°a=0ä¸”b=0çš„è¾“å‡ºä¸ºæ­¢ã€‚å®éªŒç»“æœè¯´æ˜ï¼Œå¾ªç¯æ‰§è¡Œåˆ°ç¬¬13830æ¬¡æ—¶è¾“å‡ºäº†(0,0).</p><p>å¤§å¤šæ•°ç°ä»£å¾®å¤„ç†å™¨éƒ½ä¼šé‡‡ç”¨å°†<strong>æŒ‡ä»¤ä¹±åºæ‰§è¡Œï¼ˆout-of-order executionï¼Œç®€ç§°OoOEæˆ–OOEï¼‰</strong>çš„æ–¹æ³•ï¼Œ<strong>åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¿è¡Œå½“å‰æœ‰èƒ½åŠ›ç«‹å³æ‰§è¡Œçš„åç»­æŒ‡ä»¤ï¼Œé¿å¼€è·å–ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€éœ€æ•°æ®æ—¶é€ æˆçš„ç­‰å¾…ã€‚</strong>é€šè¿‡ä¹±åºæ‰§è¡Œçš„æŠ€æœ¯ï¼Œå¤„ç†å™¨å¯ä»¥å¤§å¤§æé«˜æ‰§è¡Œæ•ˆç‡ã€‚<br>é™¤äº†å¤„ç†å™¨ï¼Œå¸¸è§çš„Javaè¿è¡Œæ—¶ç¯å¢ƒçš„JITç¼–è¯‘å™¨ä¹Ÿä¼šåšæŒ‡ä»¤é‡æ’åºæ“ä½œï¼Œå³ç”Ÿæˆçš„æœºå™¨æŒ‡ä»¤ä¸å­—èŠ‚ç æŒ‡ä»¤é¡ºåºä¸ä¸€è‡´ã€‚</p><h2 id="as-if-serialè¯­ä¹‰"><a href="#as-if-serialè¯­ä¹‰" class="headerlink" title="as-if-serialè¯­ä¹‰"></a>as-if-serialè¯­ä¹‰</h2><p><strong>As-if-serialè¯­ä¹‰çš„æ„æ€æ˜¯ï¼Œæ‰€æœ‰çš„åŠ¨ä½œ(Action)éƒ½å¯ä»¥ä¸ºäº†ä¼˜åŒ–è€Œè¢«é‡æ’åºï¼Œä½†æ˜¯å¿…é¡»ä¿è¯å®ƒä»¬é‡æ’åºåçš„ç»“æœå’Œç¨‹åºä»£ç æœ¬èº«çš„åº”æœ‰ç»“æœæ˜¯ä¸€è‡´çš„</strong>ã€‚Javaç¼–è¯‘å™¨ã€è¿è¡Œæ—¶å’Œå¤„ç†å™¨éƒ½ä¼šä¿è¯å•çº¿ç¨‹ä¸‹çš„as-if-serialè¯­ä¹‰ã€‚<br>æ¯”å¦‚ï¼Œä¸ºäº†ä¿è¯è¿™ä¸€è¯­ä¹‰ï¼Œé‡æ’åºä¸ä¼šå‘ç”Ÿåœ¨æœ‰æ•°æ®ä¾èµ–çš„æ“ä½œä¹‹ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int a = 1;</span><br><span class="line">int b = 2;</span><br><span class="line">int c = a + b;</span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æˆJavaå­—èŠ‚ç æˆ–ç”Ÿæˆæœºå™¨æŒ‡ä»¤ï¼Œå¯è§†ä¸ºå±•å¼€æˆäº†ä»¥ä¸‹å‡ æ­¥åŠ¨ä½œï¼ˆå®é™…å¯èƒ½ä¼šçœç•¥æˆ–æ·»åŠ æŸäº›æ­¥éª¤ï¼‰ã€‚</p><ul><li>å¯¹aèµ‹å€¼1</li><li>å¯¹bèµ‹å€¼2</li><li>å–açš„å€¼</li><li>å–bçš„å€¼</li><li>å°†å–åˆ°ä¸¤ä¸ªå€¼ç›¸åŠ åå­˜å…¥c</li></ul><p>åœ¨ä¸Šé¢5ä¸ªåŠ¨ä½œä¸­ï¼ŒåŠ¨ä½œ1å¯èƒ½ä¼šå’ŒåŠ¨ä½œ2ã€4é‡æ’åºï¼ŒåŠ¨ä½œ2å¯èƒ½ä¼šå’ŒåŠ¨ä½œ1ã€3é‡æ’åºï¼ŒåŠ¨ä½œ3å¯èƒ½ä¼šå’ŒåŠ¨ä½œ2ã€4é‡æ’åºï¼ŒåŠ¨ä½œ4å¯èƒ½ä¼šå’Œ1ã€3é‡æ’åºã€‚ä½†åŠ¨ä½œ1å’ŒåŠ¨ä½œ3ã€5ä¸èƒ½é‡æ’åºã€‚åŠ¨ä½œ2å’ŒåŠ¨ä½œ4ã€5ä¸èƒ½é‡æ’åºã€‚å› ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œä¸€æ—¦é‡æ’ï¼Œas-if-serialè¯­ä¹‰ä¾¿æ— æ³•ä¿è¯ã€‚</p><p>ä¸ºä¿è¯as-if-serialè¯­ä¹‰ï¼Œ<strong>Javaå¼‚å¸¸å¤„ç†æœºåˆ¶ä¹Ÿä¼šä¸ºé‡æ’åºåšä¸€äº›ç‰¹æ®Šå¤„ç†</strong>ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œy = 0 / 0å¯èƒ½ä¼šè¢«é‡æ’åºåœ¨x = 2ä¹‹å‰æ‰§è¡Œï¼Œä¸ºäº†ä¿è¯æœ€ç»ˆä¸è‡´äºè¾“å‡ºx = 1çš„é”™è¯¯ç»“æœï¼Œ<strong>JITåœ¨é‡æ’åºæ—¶ä¼šåœ¨catchè¯­å¥ä¸­æ’å…¥é”™è¯¯ä»£å¿ä»£ç ï¼Œå°†xèµ‹å€¼ä¸º2ï¼Œå°†ç¨‹åºæ¢å¤åˆ°å‘ç”Ÿå¼‚å¸¸æ—¶åº”æœ‰çš„çŠ¶æ€</strong>ã€‚è¿™ç§åšæ³•çš„ç¡®å°†å¼‚å¸¸æ•æ‰çš„é€»è¾‘å˜å¾—å¤æ‚äº†ï¼Œä½†æ˜¯JITçš„ä¼˜åŒ–çš„åŸåˆ™æ˜¯ï¼Œ<strong>å°½åŠ›ä¼˜åŒ–æ­£å¸¸è¿è¡Œä¸‹çš„ä»£ç é€»è¾‘ï¼Œå“ªæ€•ä»¥catchå—é€»è¾‘å˜å¾—å¤æ‚ä¸ºä»£ä»·</strong>ï¼Œæ¯•ç«Ÿï¼Œè¿›å…¥catchå—å†…æ˜¯ä¸€ç§â€œå¼‚å¸¸â€æƒ…å†µçš„è¡¨ç°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Reordering &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int x, y;</span><br><span class="line">        x = 1;</span><br><span class="line">        try &#123;</span><br><span class="line">            x = 2;</span><br><span class="line">            y = 0 / 0;    </span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            System.out.println(&quot;x = &quot; + x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜è®¿é—®é‡æ’åºä¸å†…å­˜å¯è§æ€§"><a href="#å†…å­˜è®¿é—®é‡æ’åºä¸å†…å­˜å¯è§æ€§" class="headerlink" title="å†…å­˜è®¿é—®é‡æ’åºä¸å†…å­˜å¯è§æ€§"></a>å†…å­˜è®¿é—®é‡æ’åºä¸å†…å­˜å¯è§æ€§</h2><p>è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä¸ºäº†å°½å¯èƒ½åœ°é¿å…å¤„ç†å™¨è®¿é—®ä¸»å†…å­˜çš„æ—¶é—´å¼€é”€ï¼Œå¤„ç†å™¨å¤§å¤šä¼šåˆ©ç”¨ç¼“å­˜(cache)ä»¥æé«˜æ€§èƒ½ã€‚å…¶æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/images/reordered03.png" alt=""></p><p>åœ¨è¿™ç§æ¨¡å‹ä¸‹ä¼šå­˜åœ¨ä¸€ä¸ªç°è±¡ï¼Œå³ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸»å†…å­˜çš„æ•°æ®å¹¶ä¸æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œå„CPUï¼ˆæˆ–CPUæ ¸å¿ƒï¼‰é—´ç¼“å­˜çš„æ•°æ®ä¹Ÿä¸æ˜¯å®æ—¶åŒæ­¥çš„ã€‚è¿™å¯¼è‡´åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå„CPUæ‰€çœ‹åˆ°åŒä¸€å†…å­˜åœ°å€çš„æ•°æ®çš„å€¼å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚ä»ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå°±æ˜¯åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå„ä¸ªçº¿ç¨‹æ‰€çœ‹åˆ°çš„å…±äº«å˜é‡çš„å€¼å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚<br>æœ‰çš„è§‚ç‚¹ä¼šå°†è¿™ç§ç°è±¡ä¹Ÿè§†ä¸ºé‡æ’åºçš„ä¸€ç§ï¼Œå‘½åä¸ºâ€œå†…å­˜ç³»ç»Ÿé‡æ’åºâ€ã€‚å› ä¸ºè¿™ç§å†…å­˜å¯è§æ€§é—®é¢˜é€ æˆçš„ç»“æœå°±å¥½åƒæ˜¯å†…å­˜è®¿é—®æŒ‡ä»¤å‘ç”Ÿäº†é‡æ’åºä¸€æ ·ã€‚<br>è¿™ç§å†…å­˜å¯è§æ€§é—®é¢˜ä¹Ÿä¼šå¯¼è‡´ç« èŠ‚ä¸€ä¸­ç¤ºä¾‹ä»£ç å³ä¾¿åœ¨æ²¡æœ‰å‘ç”ŸæŒ‡ä»¤é‡æ’åºçš„æƒ…å†µä¸‹çš„æ‰§è¡Œç»“æœä¹Ÿè¿˜æ˜¯(0, 0)ã€‚</p><h2 id="å†…å­˜è®¿é—®é‡æ’åºä¸Javaå†…å­˜æ¨¡å‹"><a href="#å†…å­˜è®¿é—®é‡æ’åºä¸Javaå†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜è®¿é—®é‡æ’åºä¸Javaå†…å­˜æ¨¡å‹"></a>å†…å­˜è®¿é—®é‡æ’åºä¸Javaå†…å­˜æ¨¡å‹</h2><p>Javaçš„ç›®æ ‡æ˜¯æˆä¸ºä¸€é—¨å¹³å°æ— å…³æ€§çš„è¯­è¨€ï¼Œå³Write once, run anywhere. ä½†æ˜¯<strong>ä¸åŒç¡¬ä»¶ç¯å¢ƒä¸‹æŒ‡ä»¤é‡æ’åºçš„è§„åˆ™ä¸å°½ç›¸åŒ</strong>ã€‚ä¾‹å¦‚ï¼Œx86ä¸‹è¿è¡Œæ­£å¸¸çš„Javaç¨‹åºåœ¨IA64ä¸‹å°±å¯èƒ½å¾—åˆ°éé¢„æœŸçš„è¿è¡Œç»“æœã€‚ä¸ºæ­¤ï¼ŒJSR-1337åˆ¶å®šäº†<strong>Javaå†…å­˜æ¨¡å‹(Java Memory Model, JMM)ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å¯å‚è€ƒçš„è§„èŒƒï¼Œå±è”½å¹³å°å·®å¼‚æ€§</strong>ã€‚ä»Java 5å¼€å§‹ï¼ŒJavaå†…å­˜æ¨¡å‹æˆä¸ºJavaè¯­è¨€è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚<br>æ ¹æ®Javaå†…å­˜æ¨¡å‹ä¸­çš„è§„å®šï¼Œå¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹å‡ æ¡happens-beforeè§„åˆ™ã€‚Happens-beforeçš„å‰åä¸¤ä¸ªæ“ä½œä¸ä¼šè¢«é‡æ’åºä¸”åè€…å¯¹å‰è€…çš„å†…å­˜å¯è§ã€‚</p><ul><li>ç¨‹åºæ¬¡åºæ³•åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ¯ä¸ªåŠ¨ä½œAéƒ½happens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„æ¯ä¸€ä¸ªåŠ¨ä½œBï¼Œå…¶ä¸­ï¼Œåœ¨ç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„åŠ¨ä½œBéƒ½èƒ½å‡ºç°åœ¨Aä¹‹åã€‚</li><li>ç›‘è§†å™¨é”æ³•åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨é”çš„è§£é” happens-beforeäºæ¯ä¸€ä¸ªåç»­å¯¹åŒä¸€ç›‘è§†å™¨é”çš„åŠ é”ã€‚</li><li>volatileå˜é‡æ³•åˆ™ï¼šå¯¹volatileåŸŸçš„å†™å…¥æ“ä½œhappens-beforeäºæ¯ä¸€ä¸ªåç»­å¯¹åŒä¸€ä¸ªåŸŸçš„è¯»å†™æ“ä½œã€‚</li><li>çº¿ç¨‹å¯åŠ¨æ³•åˆ™ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œå¯¹Thread.startçš„è°ƒç”¨ä¼šhappens-beforeäºæ¯ä¸ªå¯åŠ¨çº¿ç¨‹çš„åŠ¨ä½œã€‚</li><li>çº¿ç¨‹ç»ˆç»“æ³•åˆ™ï¼šçº¿ç¨‹ä¸­çš„ä»»ä½•åŠ¨ä½œéƒ½happens-beforeäºå…¶ä»–çº¿ç¨‹æ£€æµ‹åˆ°è¿™ä¸ªçº¿ç¨‹å·²ç»ç»ˆç»“ã€æˆ–è€…ä»Thread.joinè°ƒç”¨ä¸­æˆåŠŸè¿”å›ï¼Œæˆ–Thread.isAliveè¿”å›falseã€‚</li><li>ä¸­æ–­æ³•åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„interrupt happens-beforeäºè¢«ä¸­æ–­çš„çº¿ç¨‹å‘ç°ä¸­æ–­ã€‚</li><li>ç»ˆç»“æ³•åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°çš„ç»“æŸhappens-beforeäºè¿™ä¸ªå¯¹è±¡finalizerçš„å¼€å§‹ã€‚</li><li>ä¼ é€’æ€§ï¼šå¦‚æœA happens-beforeäºBï¼Œä¸”B happens-beforeäºCï¼Œåˆ™A happens-beforeäºC</li></ul><p>Happens-beforeå…³ç³»åªæ˜¯å¯¹Javaå†…å­˜æ¨¡å‹çš„ä¸€ç§è¿‘ä¼¼æ€§çš„æè¿°ï¼Œå®ƒå¹¶ä¸å¤Ÿä¸¥è°¨ï¼Œä½†ä¾¿äºæ—¥å¸¸ç¨‹åºå¼€å‘å‚è€ƒä½¿ç”¨ï¼Œå…³äºæ›´ä¸¥è°¨çš„Javaå†…å­˜æ¨¡å‹çš„å®šä¹‰å’Œæè¿°ï¼Œè¯·é˜…è¯»JSR-133åŸæ–‡æˆ–Javaè¯­è¨€è§„èŒƒç« èŠ‚17.4ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒJavaå†…å­˜æ¨¡å‹å¯¹volatileå’Œfinalçš„è¯­ä¹‰åšäº†æ‰©å±•ã€‚å¯¹volatileè¯­ä¹‰çš„æ‰©å±•ä¿è¯äº†volatileå˜é‡åœ¨ä¸€äº›æƒ…å†µä¸‹ä¸ä¼šé‡æ’åºï¼Œvolatileçš„64ä½å˜é‡doubleå’Œlongçš„è¯»å–å’Œèµ‹å€¼æ“ä½œéƒ½æ˜¯åŸå­çš„ã€‚å¯¹finalè¯­ä¹‰çš„æ‰©å±•ä¿è¯ä¸€ä¸ªå¯¹è±¡çš„æ„å»ºæ–¹æ³•ç»“æŸå‰ï¼Œæ‰€æœ‰finalæˆå‘˜å˜é‡éƒ½å¿…é¡»å®Œæˆåˆå§‹åŒ–ï¼ˆçš„å‰ææ˜¯æ²¡æœ‰thiså¼•ç”¨æº¢å‡ºï¼‰ã€‚</p><p>Javaå†…å­˜æ¨¡å‹å…³äºé‡æ’åºçš„è§„å®šï¼Œæ€»ç»“åå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p><p><img src="/images/reordered04.png" alt=""></p><p>è¡¨ä¸­â€œç¬¬äºŒé¡¹æ“ä½œâ€çš„å«ä¹‰æ˜¯æŒ‡ï¼Œç¬¬ä¸€é¡¹æ“ä½œä¹‹åçš„æ‰€æœ‰æŒ‡å®šæ“ä½œã€‚å¦‚ï¼Œæ™®é€šè¯»ä¸èƒ½ä¸å…¶ä¹‹åçš„æ‰€æœ‰volatileå†™é‡æ’åºã€‚å¦å¤–ï¼ŒJMMä¹Ÿè§„å®šäº†ä¸Šè¿°volatileå’ŒåŒæ­¥å—çš„è§„åˆ™å°½é€‚ç”¨äºå­˜åœ¨å¤šçº¿ç¨‹è®¿é—®çš„æƒ…æ™¯ã€‚ä¾‹å¦‚ï¼Œè‹¥ç¼–è¯‘å™¨ï¼ˆè¿™é‡Œçš„ç¼–è¯‘å™¨ä¹ŸåŒ…æ‹¬JITï¼Œä¸‹åŒï¼‰è¯æ˜äº†ä¸€ä¸ªvolatileå˜é‡åªèƒ½è¢«å•çº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šæŠŠå®ƒåšä¸ºæ™®é€šå˜é‡æ¥å¤„ç†ã€‚<br>ç•™ç™½çš„å•å…ƒæ ¼ä»£è¡¨å…è®¸åœ¨ä¸è¿åJavaåŸºæœ¬è¯­ä¹‰çš„æƒ…å†µä¸‹é‡æ’åºã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹å¯¹åŒä¸€å†…å­˜åœ°å€çš„è¯»å’Œå†™æ“ä½œé‡æ’åºï¼Œä½†æ˜¯å…è®¸å¯¹ä¸åŒåœ°å€çš„è¯»å’Œå†™æ“ä½œé‡æ’åºã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†ä¿è¯finalçš„æ–°å¢è¯­ä¹‰ã€‚JSR-133å¯¹äºfinalå˜é‡çš„é‡æ’åºä¹Ÿåšäº†é™åˆ¶ã€‚</p><ul><li>æ„å»ºæ–¹æ³•å†…éƒ¨çš„finalæˆå‘˜å˜é‡çš„å­˜å‚¨ï¼Œå¹¶ä¸”ï¼Œå‡å¦‚finalæˆå‘˜å˜é‡æœ¬èº«æ˜¯ä¸€ä¸ªå¼•ç”¨çš„è¯ï¼Œè¿™ä¸ªfinalæˆå‘˜å˜é‡å¯ä»¥å¼•ç”¨åˆ°çš„ä¸€åˆ‡å­˜å‚¨æ“ä½œï¼Œéƒ½ä¸èƒ½ä¸æ„å»ºæ–¹æ³•å¤–çš„å°†å½“æœŸæ„å»ºå¯¹è±¡èµ‹å€¼äºå¤šçº¿ç¨‹å…±äº«å˜é‡çš„å­˜å‚¨æ“ä½œé‡æ’åºã€‚ä¾‹å¦‚å¯¹äºå¦‚ä¸‹è¯­å¥<br>x.finalField = v; â€¦ ;  æ„å»ºæ–¹æ³•è¾¹ç•ŒsharedRef = x;<br>v.afield = 1; x.finalField = v; â€¦ ; æ„å»ºæ–¹æ³•è¾¹ç•ŒsharedRef = x;<br>è¿™ä¸¤æ¡è¯­å¥ä¸­ï¼Œæ„å»ºæ–¹æ³•è¾¹ç•Œå‰åçš„æŒ‡ä»¤éƒ½ä¸èƒ½é‡æ’åºã€‚</li><li>åˆå§‹è¯»å–å…±äº«å¯¹è±¡ä¸åˆå§‹è¯»å–è¯¥å…±äº«å¯¹è±¡çš„finalæˆå‘˜å˜é‡ä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ä¾‹å¦‚å¯¹äºå¦‚ä¸‹è¯­å¥<br>x = sharedRef; â€¦ ; i = x.finalField;<br>å‰åä¸¤å¥è¯­å¥ä¹‹é—´ä¸ä¼šå‘ç”Ÿé‡æ’åºã€‚ç”±äºè¿™ä¸¤å¥è¯­å¥æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨æœ¬èº«å°±ä¸ä¼šå¯¹å®ƒä»¬é‡æ’åºï¼Œä½†ç¡®å®æœ‰ä¸€äº›å¤„ç†å™¨ä¼šå¯¹è¿™ç§æƒ…å†µé‡æ’åºï¼Œå› æ­¤ç‰¹åˆ«åˆ¶å®šäº†è¿™ä¸€è§„åˆ™ã€‚</li></ul><h2 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h2><p>å†…å­˜å±éšœï¼ˆMemory Barrierï¼Œæˆ–æœ‰æ—¶å«åšå†…å­˜æ …æ ï¼ŒMemory Fenceï¼‰æ˜¯ä¸€ç§CPUæŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶ç‰¹å®šæ¡ä»¶ä¸‹çš„é‡æ’åºå’Œå†…å­˜å¯è§æ€§é—®é¢˜ã€‚Javaç¼–è¯‘å™¨ä¹Ÿä¼šæ ¹æ®å†…å­˜å±éšœçš„è§„åˆ™ç¦æ­¢é‡æ’åºã€‚<br>å†…å­˜å±éšœå¯ä»¥è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹  </p><ul><li>LoadLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li><li>StoreStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚</li><li>LoadStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li><li>StoreLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</li></ul><p>æœ‰çš„å¤„ç†å™¨çš„é‡æ’åºè§„åˆ™è¾ƒä¸¥ï¼Œæ— éœ€å†…å­˜å±éšœä¹Ÿèƒ½å¾ˆå¥½çš„å·¥ä½œï¼ŒJavaç¼–è¯‘å™¨ä¼šåœ¨è¿™ç§æƒ…å†µä¸‹ä¸æ”¾ç½®å†…å­˜å±éšœã€‚<br>ä¸ºäº†å®ç°ä¸Šä¸€ç« ä¸­è®¨è®ºçš„JSR-133çš„è§„å®šï¼ŒJavaç¼–è¯‘å™¨ä¼šè¿™æ ·ä½¿ç”¨å†…å­˜å±éšœã€‚</p><p><img src="/images/reordered05.png" alt=""></p><p>ä¸ºäº†ä¿è¯finalå­—æ®µçš„ç‰¹æ®Šè¯­ä¹‰ï¼Œä¹Ÿä¼šåœ¨ä¸‹é¢çš„è¯­å¥åŠ å…¥å†…å­˜å±éšœã€‚<br>x.finalField = v; StoreStore; sharedRef = x;</p><h2 id="Intel-64-IA-32æ¶æ„ä¸‹çš„å†…å­˜è®¿é—®é‡æ’åº"><a href="#Intel-64-IA-32æ¶æ„ä¸‹çš„å†…å­˜è®¿é—®é‡æ’åº" class="headerlink" title="Intel 64/IA-32æ¶æ„ä¸‹çš„å†…å­˜è®¿é—®é‡æ’åº"></a>Intel 64/IA-32æ¶æ„ä¸‹çš„å†…å­˜è®¿é—®é‡æ’åº</h2><p>Intel 64å’ŒIA-32æ˜¯æˆ‘ä»¬è¾ƒå¸¸ç”¨çš„ç¡¬ä»¶ç¯å¢ƒï¼Œç›¸å¯¹äºå…¶å®ƒå¤„ç†å™¨è€Œè¨€ï¼Œå®ƒä»¬æ‹¥æœ‰ä¸€ç§è¾ƒä¸¥æ ¼çš„é‡æ’åºè§„åˆ™ã€‚Pentium 4ä»¥åçš„Intel 64æˆ–IA-32å¤„ç†çš„é‡æ’åºè§„åˆ™å¦‚ä¸‹ã€‚</p><p>åœ¨å•CPUç³»ç»Ÿä¸­</p><ul><li>è¯»æ“ä½œä¸ä¸å…¶å®ƒè¯»æ“ä½œé‡æ’åºã€‚</li><li>å†™æ“ä½œä¸ä¸å…¶ä¹‹å‰çš„å†™æ“ä½œé‡æ’åºã€‚</li><li>å†™å†…å­˜æ“ä½œä¸ä¸å…¶å®ƒå†™æ“ä½œé‡æ’åºï¼Œä½†æœ‰ä»¥ä¸‹å‡ ç§ä¾‹å¤–</li><li>CLFLUSHçš„å†™æ“ä½œ</li><li>å¸¦æœ‰non-temporal moveæŒ‡ä»¤(MOVNTI, MOVNTQ, MOVNTDQ, MOVNTPS, and MOVNTPD)çš„streamingå†™å…¥ã€‚</li><li>å­—ç¬¦ä¸²æ“ä½œ</li><li>è¯»æ“ä½œå¯èƒ½ä¼šä¸å…¶ä¹‹å‰çš„å†™ä¸åŒä½ç½®çš„å†™æ“ä½œé‡æ’åºï¼Œä½†ä¸ä¸å…¶ä¹‹å‰çš„å†™ç›¸åŒä½ç½®çš„å†™æ“ä½œé‡æ’åºã€‚</li><li>è¯»å’Œå†™æ“ä½œä¸ä¸I/OæŒ‡ä»¤ï¼Œå¸¦é”çš„æŒ‡ä»¤æˆ–åºåˆ—åŒ–æŒ‡ä»¤é‡æ’åºã€‚</li><li>è¯»æ“ä½œä¸èƒ½é‡æ’åºåˆ°LFENCEå’ŒMFENCEä¹‹å‰ã€‚</li><li>å†™æ“ä½œä¸èƒ½é‡æ’åºåˆ°LFENCEã€SFENCEå’ŒMFENCEä¹‹å‰ã€‚</li><li>LFENCEä¸èƒ½é‡æ’åºåˆ°è¯»æ“ä½œä¹‹å‰ã€‚</li><li>SFENCEä¸èƒ½é‡æ’åºåˆ°å†™ä¹‹å‰ã€‚</li><li>MFENCEä¸èƒ½é‡æ’åºåˆ°è¯»æˆ–å†™æ“ä½œä¹‹å‰ã€‚</li></ul><p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­</p><ul><li>å„è‡ªå¤„ç†å™¨å†…éƒ¨éµå¾ªå•å¤„ç†å™¨çš„é‡æ’åºè§„åˆ™ã€‚</li><li>å•å¤„ç†å™¨çš„å†™æ“ä½œå¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§æ˜¯åŒæ—¶çš„ã€‚</li><li>å„è‡ªå¤„ç†å™¨çš„å†™æ“ä½œä¸ä¼šé‡æ’åºã€‚</li><li>å†…å­˜é‡æ’åºéµå®ˆå› æœæ€§(causality)ï¼ˆå†…å­˜é‡æ’åºéµå®ˆä¼ é€’å¯è§æ€§ï¼‰ã€‚</li><li>ä»»ä½•å†™æ“ä½œå¯¹äºæ‰§è¡Œè¿™äº›å†™æ“ä½œçš„å¤„ç†å™¨ä¹‹å¤–çš„å¤„ç†å™¨æ¥çœ‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li>så¸¦é”æŒ‡ä»¤æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºJavaç¼–è¯‘å™¨è€Œè¨€ï¼ŒIntel 64/IA-32æ¶æ„ä¸‹å¤„ç†å™¨ä¸éœ€è¦LoadLoadã€LoadStoreã€StoreStoreå±éšœï¼Œå› ä¸ºä¸ä¼šå‘ç”Ÿéœ€è¦è¿™ä¸‰ç§å±éšœçš„é‡æ’åºã€‚</p><h2 id="ä¸€ä¾‹Intel-64-IA-32æ¶æ„ä¸‹çš„ä»£ç æ€§èƒ½ä¼˜åŒ–"><a href="#ä¸€ä¾‹Intel-64-IA-32æ¶æ„ä¸‹çš„ä»£ç æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ä¸€ä¾‹Intel 64/IA-32æ¶æ„ä¸‹çš„ä»£ç æ€§èƒ½ä¼˜åŒ–"></a>ä¸€ä¾‹Intel 64/IA-32æ¶æ„ä¸‹çš„ä»£ç æ€§èƒ½ä¼˜åŒ–</h2><p>ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä¸€ä¸ªå®¹å™¨å¯ä»¥æ”¾ä¸€ä¸ªä¸œè¥¿ï¼Œå®¹å™¨æ”¯æŒcreateæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸œè¥¿å¹¶æ”¾åˆ°å®¹å™¨é‡Œï¼Œæ”¯æŒgetæ–¹æ³•å–åˆ°è¿™ä¸ªå®¹å™¨é‡Œçš„ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥è¾ƒå®¹æ˜“åœ°å†™å‡ºä¸‹é¢çš„ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Container &#123;</span><br><span class="line">    public static class SomeThing &#123;</span><br><span class="line">        private int status;</span><br><span class="line"></span><br><span class="line">        public SomeThing() &#123;</span><br><span class="line">            status = 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getStatus() &#123;</span><br><span class="line">            return status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private SomeThing object;</span><br><span class="line"></span><br><span class="line">    public void create() &#123;</span><br><span class="line">        object = new SomeThing();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SomeThing get() &#123;</span><br><span class="line">        while (object == null) &#123;</span><br><span class="line">            Thread.yield(); //ä¸åŠ è¿™å¥è¯å¯èƒ½ä¼šåœ¨æ­¤å‡ºç°æ— é™å¾ªç¯</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å•çº¿ç¨‹åœºæ™¯ä¸‹ï¼Œè¿™æ®µä»£ç æ‰§è¡Œèµ·æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯åœ¨å¤šçº¿ç¨‹å¹¶å‘åœºæ™¯ä¸‹ï¼Œç”±ä¸åŒçš„çº¿ç¨‹createå’Œgetä¸œè¥¿ï¼Œè¿™æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜çš„åŸå› ä¸æ™®é€šçš„åŒé‡æ£€æŸ¥é”å®šå•ä¾‹æ¨¡å¼(Double Checked Locking, DCL)10ç±»ä¼¼ï¼Œå³SomeThingçš„æ„å»ºä¸å°†æŒ‡å‘æ„å»ºä¸­çš„SomeThingå¼•ç”¨èµ‹å€¼åˆ°objectå˜é‡è¿™ä¸¤è€…å¯èƒ½ä¼šå‘ç”Ÿé‡æ’åºã€‚å¯¼è‡´getä¸­è¿”å›ä¸€ä¸ªæ­£è¢«æ„å»ºä¸­çš„ä¸å®Œæ•´çš„SomeThingå¯¹è±¡å®ä¾‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œé€šå¸¸çš„åŠæ³•æ˜¯ä½¿ç”¨volatileä¿®é¥°objectå­—æ®µã€‚è¿™ç§æ–¹æ³•é¿å…äº†é‡æ’åºï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‘’å¼ƒæ¯”ä½¿ç”¨åŒæ­¥å—å¯¼è‡´çš„æ€§èƒ½æŸå¤±æ›´å°ã€‚ä½†æ˜¯ï¼Œå‡å¦‚ä½¿ç”¨åœºæ™¯å¯¹objectçš„å†…å­˜å¯è§æ€§å¹¶ä¸æ•æ„Ÿçš„è¯ï¼ˆä¸è¦æ±‚ä¸€ä¸ªçº¿ç¨‹å†™å…¥äº†objectï¼Œobjectçš„æ–°å€¼ç«‹å³å¯¹ä¸‹ä¸€ä¸ªè¯»å–çš„çº¿ç¨‹å¯è§ï¼‰ï¼Œåœ¨Intel 64/IA-32ç¯å¢ƒä¸‹ï¼Œæœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æ ¹æ®ä¸Šä¸€ç« çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“Intel 64/IA-32ä¸‹å†™æ“ä½œä¹‹é—´ä¸ä¼šå‘ç”Ÿé‡æ’åºï¼Œå³åœ¨å¤„ç†å™¨ä¸­ï¼Œæ„å»ºSomeThingå¯¹è±¡ä¸èµ‹å€¼åˆ°objectè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„é¡ºåºæ€§æ˜¯å¯ä»¥ä¿è¯çš„ã€‚è¿™æ ·çœ‹èµ·æ¥ï¼Œä»…ä»…ä½¿ç”¨volatileæ¥é¿å…é‡æ’åºæ˜¯å¤šæ­¤ä¸€ä¸¾çš„ã€‚ä½†æ˜¯ï¼ŒJavaç¼–è¯‘å™¨å´å¯èƒ½ç”Ÿæˆé‡æ’åºåçš„æŒ‡ä»¤ã€‚ä½†ä»¤äººé«˜å…´çš„æ˜¯ï¼ŒOracleçš„JDKä¸­æä¾›äº†Unsafe. putOrderedObjectï¼ŒUnsafe. putOrderedIntï¼ŒUnsafe. putOrderedLongè¿™ä¸‰ä¸ªæ–¹æ³•ï¼ŒJDKä¼šåœ¨æ‰§è¡Œè¿™ä¸‰ä¸ªæ–¹æ³•æ—¶æ’å…¥StoreStoreå†…å­˜å±éšœï¼Œé¿å…å‘ç”Ÿå†™æ“ä½œé‡æ’åºã€‚è€Œåœ¨Intel 64/IA-32æ¶æ„ä¸‹ï¼ŒStoreStoreå±éšœå¹¶ä¸éœ€è¦ï¼ŒJavaç¼–è¯‘å™¨ä¼šå°†StoreStoreå±éšœå»é™¤ã€‚æ¯”èµ·å†™å…¥volatileå˜é‡ä¹‹åæ‰§è¡ŒStoreLoadå±éšœçš„å·¨å¤§å¼€é”€ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•é™¤äº†é¿å…é‡æ’åºè€Œå¸¦æ¥çš„æ€§èƒ½æŸå¤±ä»¥å¤–ï¼Œä¸ä¼šå¸¦æ¥å…¶å®ƒçš„æ€§èƒ½å¼€é”€ã€‚</p><p>æˆ‘ä»¬å°†åšä¸€ä¸ªå°å®éªŒæ¥æ¯”è¾ƒäºŒè€…çš„æ€§èƒ½å·®å¼‚ã€‚ä¸€ç§æ˜¯ä½¿ç”¨volatileä¿®é¥°objectæˆå‘˜å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Container &#123;</span><br><span class="line">    public static class SomeThing &#123;</span><br><span class="line">        private int status;</span><br><span class="line"></span><br><span class="line">        public SomeThing() &#123;</span><br><span class="line">            status = 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getStatus() &#123;</span><br><span class="line">            return status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private volatile  SomeThing object;</span><br><span class="line"></span><br><span class="line">    public void create() &#123;</span><br><span class="line">        object = new SomeThing();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SomeThing get() &#123;</span><br><span class="line">        while (object == null) &#123;</span><br><span class="line">            Thread.yield(); //ä¸åŠ è¿™å¥è¯å¯èƒ½ä¼šåœ¨æ­¤å‡ºç°æ— é™å¾ªç¯</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ç§æ˜¯åˆ©ç”¨Unsafe. putOrderedObjectåœ¨é¿å…åœ¨é€‚å½“çš„ä½ç½®å‘ç”Ÿé‡æ’åºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public class Container &#123;</span><br><span class="line">    public static class SomeThing &#123;</span><br><span class="line">        private int status;</span><br><span class="line"></span><br><span class="line">        public SomeThing() &#123;</span><br><span class="line">            status = 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getStatus() &#123;</span><br><span class="line">            return status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private SomeThing object;</span><br><span class="line"></span><br><span class="line">    private Object value;</span><br><span class="line">    private static final Unsafe unsafe = getUnsafe();</span><br><span class="line">    private static final long valueOffset;</span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset(Container.class.getDeclaredField(&quot;value&quot;));</span><br><span class="line">        &#125; catch (Exception ex) &#123; throw new Error(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void create() &#123;</span><br><span class="line">        SomeThing temp = new SomeThing();</span><br><span class="line">        unsafe.putOrderedObject(this, valueOffset, null);    //å°†valueèµ‹nullå€¼åªæ˜¯ä¸€é¡¹æ— ç”¨æ“ä½œï¼Œå®é™…åˆ©ç”¨çš„æ˜¯è¿™æ¡è¯­å¥çš„å†…å­˜å±éšœ</span><br><span class="line">        object = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SomeThing get() &#123;</span><br><span class="line">        while (object == null) &#123;</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Unsafe getUnsafe() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Field f = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;);</span><br><span class="line">            f.setAccessible(true);</span><br><span class="line">            return (Unsafe)f.get(null);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºç›´æ¥è°ƒç”¨Unsafe.getUnsafe()éœ€è¦é…ç½®JREè·å–è¾ƒé«˜æƒé™ï¼Œæˆ‘ä»¬åˆ©ç”¨åå°„è·å–Unsafeä¸­çš„theUnsafeæ¥å–å¾—Unsafeçš„å¯ç”¨å®ä¾‹ã€‚<br>unsafe.putOrderedObject(this, valueOffset, null)<br>è¿™å¥ä»…ä»…æ˜¯ä¸ºäº†å€Ÿç”¨è¿™å¥è¯åŠŸèƒ½çš„é˜²æ­¢å†™é‡æ’åºï¼Œé™¤æ­¤ä¹‹å¤–æ— å…¶å®ƒä½œç”¨ã€‚</p><p>åˆ©ç”¨ä¸‹é¢çš„ä»£ç åˆ†åˆ«æµ‹è¯•ä¸¤ç§æ–¹æ¡ˆçš„å®é™…è¿è¡Œæ—¶é—´ã€‚åœ¨è¿è¡Œæ—¶å¼€å¯-serverå’Œ -XX:CompileThreshold=1ä»¥æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸‹é•¿æ—¶é—´è¿è¡Œåçš„JITä¼˜åŒ–æ•ˆæœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">    final int THREADS_COUNT = 20;</span><br><span class="line">    final int LOOP_COUNT = 100000;</span><br><span class="line"></span><br><span class="line">    long sum = 0;</span><br><span class="line">    long min = Integer.MAX_VALUE;</span><br><span class="line">    long max = 0;</span><br><span class="line">    for(int n = 0;n &lt;= 100;n++) &#123;</span><br><span class="line">        final Container basket = new Container();</span><br><span class="line">        List&lt;Thread&gt; putThreads = new ArrayList&lt;Thread&gt;();</span><br><span class="line">        List&lt;Thread&gt; takeThreads = new ArrayList&lt;Thread&gt;();</span><br><span class="line">        for (int i = 0; i &lt; THREADS_COUNT; i++) &#123;</span><br><span class="line">            putThreads.add(new Thread() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    for (int j = 0; j &lt; LOOP_COUNT; j++) &#123;</span><br><span class="line">                        basket.create();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            takeThreads.add(new Thread() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    for (int j = 0; j &lt; LOOP_COUNT; j++) &#123;</span><br><span class="line">                        basket.get().getStatus();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        long start = System.nanoTime();</span><br><span class="line">        for (int i = 0; i &lt; THREADS_COUNT; i++) &#123;</span><br><span class="line">            takeThreads.get(i).start();</span><br><span class="line">            putThreads.get(i).start();</span><br><span class="line">        &#125;</span><br><span class="line">        for (int i = 0; i &lt; THREADS_COUNT; i++) &#123;</span><br><span class="line">            takeThreads.get(i).join();</span><br><span class="line">            putThreads.get(i).join();</span><br><span class="line">        &#125;</span><br><span class="line">        long end = System.nanoTime();</span><br><span class="line">        long period = end - start;</span><br><span class="line">        if(n == 0) &#123;</span><br><span class="line">            continue;    //ç”±äºJITçš„ç¼–è¯‘ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œéœ€è¦æ›´å¤šæ—¶é—´ï¼Œå°†æ­¤æ—¶é—´ä¸è®¡å…¥ç»Ÿè®¡</span><br><span class="line">        &#125;</span><br><span class="line">        sum += (period);</span><br><span class="line">        System.out.println(period);</span><br><span class="line">        if(period &lt; min) &#123;</span><br><span class="line">            min = period;</span><br><span class="line">        &#125;</span><br><span class="line">        if(period &gt; max) &#123;</span><br><span class="line">            max = period;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;Average : &quot; + sum / 100);</span><br><span class="line">    System.out.println(&quot;Max : &quot; + max);</span><br><span class="line">    System.out.println(&quot;Min : &quot; + min);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬”è€…çš„è®¡ç®—æœºä¸Šè¿è¡Œæµ‹è¯•ï¼Œé‡‡ç”¨volatileæ–¹æ¡ˆçš„è¿è¡Œç»“æœå¦‚ä¸‹<br>Average : 62535770<br>Max : 82515000<br>Min : 45161000</p><p>é‡‡ç”¨unsafe.putOrderedObjectæ–¹æ¡ˆçš„è¿è¡Œç»“æœå¦‚ä¸‹<br>Average : 50746230<br>Max : 68999000<br>Min : 38038000</p><p>ä»ç»“æœçœ‹å‡ºï¼Œunsafe.putOrderedObjectæ–¹æ¡ˆæ¯”volatileæ–¹æ¡ˆå¹³å‡è€—æ—¶å‡å°‘18.9%ï¼Œæœ€å¤§è€—æ—¶å‡å°‘16.4%ï¼Œæœ€å°è€—æ—¶å‡å°‘15.8%.å¦å¤–ï¼Œå³ä½¿åœ¨å…¶å®ƒä¼šå‘ç”Ÿå†™å†™é‡æ’åºçš„å¤„ç†å™¨ä¸­ï¼Œç”±äºStoreStoreå±éšœçš„æ€§èƒ½æŸè€—å°äºStoreLoadå±éšœï¼Œé‡‡ç”¨è¿™ä¸€æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆã€‚ä½†å€¼å¾—å†æ¬¡æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€æ–¹æ¡ˆä¸æ˜¯å¯¹volatileè¯­ä¹‰çš„ç­‰ä»·æ›¿æ¢ï¼Œè€Œæ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹åšçš„ç‰¹æ®Šä¼˜åŒ–ï¼Œå®ƒä»…é¿å…äº†å†™å†™é‡æ’åºï¼Œä½†ä¸ä¿è¯å†…å­˜å¯è§æ€§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç¾å›¢æŠ€æœ¯åšå®¢ä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œè®²çš„å¾ˆå¥½ï¼Œå°±æ˜¯åˆ°äº†åé¢æœ‰äº›çœ‹ä¸å¤ªæ‡‚ï¼Œåªèƒ½æ€ªè‡ªå·±å¤ªèœäº†ã€‚&lt;a href=&quot;https://tech.meituan.com/java-memory-reordering.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;åŸæ–‡é“¾æ¥&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>HashMapä¸­çš„æ‰©å®¹</title>
    <link href="https://hsb786.github.io/2018/04/21/HashMap%E4%B8%AD%E7%9A%84%E6%89%A9%E5%AE%B9/"/>
    <id>https://hsb786.github.io/2018/04/21/HashMapä¸­çš„æ‰©å®¹/</id>
    <published>2018-04-21T12:10:50.000Z</published>
    <updated>2018-04-25T07:17:39.105Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥å‰åªçŸ¥é“HashMapä¼šæ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šæ˜¯ä¸¤å€ã€‚è‡ªä»çœ‹äº†ç¾å›¢æŠ€æœ¯åšå®¢åæ‰ç¨å¾®æ‡‚äº†ä¸€ç‚¹ã€‚äºŒè¿›åˆ¶çœŸæ˜¯çƒ¦äººğŸ˜ğŸ˜ğŸ˜<br><a id="more"></a><br>æœ¯è¯­ï¼š</p><ul><li>é«˜ä½è¿ç®—ï¼šä¸å¤ªäº†è§£ï¼Œç½‘ä¸Šä¹Ÿæ‰¾ä¸åˆ°è§£é‡Šã€‚è®©é«˜ä½å‚åŠ è¿ç®—?</li><li>å–æ¨¡è¿ç®—ï¼šä¾‹å¦‚å¯¹äºæ•´æ•°aï¼Œbæ¥è¯´ï¼Œå–æ¨¡æˆ–è€…æ±‚ä½™ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥<ul><li><ol><li>æ±‚æ•´æ•°å•†: c=a/b     </li></ol></li><li><ol start="2"><li>è®¡ç®—æ¨¡æˆ–è€…ä½™æ•°ï¼šr=a-c*b   </li></ol></li><li>å–æ¨¡è¿ç®—æ˜¯rå‘è´Ÿæ— ç©·æ–¹å‘èˆå¼ƒå°æ•°ä½</li><li>æ±‚ä½™è¿ç®—æ—¶rå‘æ­£æ— ç©·æ–¹å‘èˆå¼ƒå°æ•°ä½</li></ul></li></ul></blockquote><p><em>é’ˆå¯¹java8</em></p><h2 id="æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®"><a href="#æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®" class="headerlink" title="æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®"></a>æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public V put(K key, V value) &#123;</span><br><span class="line">    return putVal(hash(key), key, value, false, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static final int hash(Object key) &#123;</span><br><span class="line">    int h;</span><br><span class="line">    //1. h=key.hashCode()    å–hashCodeå€¼</span><br><span class="line">    //2. h^(H&gt;&gt;&gt;16)     é«˜ä½å‚ä¸è¿ç®—</span><br><span class="line">    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span><br><span class="line">                   boolean evict) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</span><br><span class="line">        if ((tab = table) == null || (n = tab.length) == 0)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        // 3. (n-1)&amp;hash    å–æ¨¡è¿ç®—</span><br><span class="line">        if ((p = tab[i = (n - 1) &amp; hash]) == null)</span><br><span class="line">            tab[i] = newNode(hash, key, value, null);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„Hashç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼š<strong>å–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®—</strong></p><p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨å–æ¨¡è¿ç®—æ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚</p><p>é€šè¿‡(table.length -1)&amp;hæ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚<strong>å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œ(length-1)&amp; hè¿ç®—ç­‰ä»·äºå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</strong></p><p>åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚<br><em>è¡¥å……ä¸€ä¸‹ï¼šä¸ºä»€ä¹ˆæ±‚å¾—çš„hashå€¼æ˜¯32ä½çš„ï¼Ÿè¿™æ˜¯å› ä¸ºintç±»å‹4å­—èŠ‚ï¼Œ4X8=32</em></p><p><img src="/images/HashMap21.png" alt=""></p><h2 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h2><p><strong>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</strong>çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚</p><p><img src="/images/HashMap22.png" alt=""></p><p>å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p><p><img src="/images/HashMap23.png" alt=""></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œ<strong>åªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€</strong>ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p><p><img src="/images/HashMap24.png" alt=""></p><p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚</p><p><code>final Node&lt;K,V&gt;[] resize()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">final Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    int oldCap = (oldTab == null) ? 0 : oldTab.length;</span><br><span class="line">    int oldThr = threshold;</span><br><span class="line">    int newCap, newThr = 0;</span><br><span class="line">    if (oldCap &gt; 0) &#123;</span><br><span class="line">        // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span><br><span class="line">        if (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            return oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        //// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span><br><span class="line">        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                    oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; 1; // double threshold</span><br><span class="line">    &#125;</span><br><span class="line">    else if (oldThr &gt; 0) // initial capacity was placed in threshold</span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    else &#123;               // zero initial threshold signifies using defaults</span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    // è®¡ç®—æ–°çš„resizeä¸Šé™</span><br><span class="line">    if (newThr == 0) &#123;</span><br><span class="line">        float ft = (float)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?</span><br><span class="line">                    (int)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    if (oldTab != null) &#123;</span><br><span class="line">        // æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span><br><span class="line">        for (int j = 0; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            if ((e = oldTab[j]) != null) &#123;</span><br><span class="line">                oldTab[j] = null;</span><br><span class="line">                if (e.next == null)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - 1)] = e;</span><br><span class="line">                else if (e instanceof TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);</span><br><span class="line">                else &#123; // é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å—</span><br><span class="line">                    Node&lt;K,V&gt; loHead = null, loTail = null;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = null, hiTail = null;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    do &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                         // åŸç´¢å¼•</span><br><span class="line">                        if ((e.hash &amp; oldCap) == 0) &#123;</span><br><span class="line">                            if (loTail == null)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            else</span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        // åŸç´¢å¼•+oldCap</span><br><span class="line">                        else &#123;</span><br><span class="line">                            if (hiTail == null)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            else</span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; while ((e = next) != null);</span><br><span class="line">                    // åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span><br><span class="line">                    if (loTail != null) &#123;</span><br><span class="line">                        loTail.next = null;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    // åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span><br><span class="line">                    if (hiTail != null) &#123;</span><br><span class="line">                        hiTail.next = null;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ‰ä¸€ç‚¹æä¸æ‡‚ï¼Œ<code>if ((e.hash &amp; oldCap) == 0) {</code>è¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆåˆ¤æ–­å°±èƒ½ç¡®å®šæ–°å¢çš„1bitå°±æ˜¯0å‘¢ğŸ˜±ğŸ˜±ğŸ˜±ã€‚è¢«äºŒè¿›åˆ¶æçš„å¤´æ˜è„‘èƒ€ğŸ˜–ğŸ˜ğŸ˜Ÿã€‚<br>ç°åœ¨å¥½åƒæ˜ç™½äº†ï¼ŒoldCap=01 0000ï¼Œkey1= 00 0101 , key2= 01 0101    key1&amp;oldCap=0ï¼Œæ–°å¢çš„1bitä¸º0ã€‚åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>(n - 1) &amp; hashï¼Œå½“næ˜¯2æ¬¡å¹‚çš„æ—¶å€™ï¼Œhash%nç­‰äº(n-1)&amp;hashï¼Œ&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡</li><li>ç”±äºé•¿åº¦æ˜¯2æ¬¡å¹‚çš„æ‰©å±•ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</li></ul><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://tech.meituan.com/java-hashmap.html" target="_blank" rel="noopener">Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä»¥å‰åªçŸ¥é“HashMapä¼šæ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šæ˜¯ä¸¤å€ã€‚è‡ªä»çœ‹äº†ç¾å›¢æŠ€æœ¯åšå®¢åæ‰ç¨å¾®æ‡‚äº†ä¸€ç‚¹ã€‚äºŒè¿›åˆ¶çœŸæ˜¯çƒ¦äººğŸ˜ğŸ˜ğŸ˜&lt;br&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
      <category term="é›†åˆ" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/%E9%9B%86%E5%90%88/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>Metaspace</title>
    <link href="https://hsb786.github.io/2018/04/21/Metaspace/"/>
    <id>https://hsb786.github.io/2018/04/21/Metaspace/</id>
    <published>2018-04-21T04:21:05.000Z</published>
    <updated>2018-04-21T07:35:08.004Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç°åœ¨java 10 éƒ½å‡ºæ¥äº†ï¼Œå†çœ‹çœ‹è‡ªå·±ï¼Œè¿java 8 éƒ½æ²¡æå®šã€‚Stay Hungry, Stay Foolish</p></blockquote><p>Java 8 å½»åº•å°†æ°¸ä¹…ä»£(PermGen)ä»HotSpot JVMç§»é™¤ã€‚æ–¹æ³•åŒºç§»è‡³Metaspaceï¼Œå­—ç¬¦ä¸²å¸¸é‡ç§»è‡³Java Heap</p><blockquote><p>In JDK 8, classes metadata is now stored in the native heap and this space is called Metaspace.<br>JDK 8 å¼€å§‹æŠŠç±»çš„å…ƒæ•°æ®å­˜æ”¾åˆ°æœ¬åœ°å †å†…å­˜ï¼ˆnative heapï¼‰ä¸­ï¼Œè¿™ä¸€å—åŒºåŸŸå°±å«Metaspaceã€‚<br><a id="more"></a></p></blockquote><h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><ul><li>å­—ç¬¦ä¸²å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡ºã€‚</li><li>ç±»åŠæ–¹æ³•çš„ä¿¡æ¯ç­‰æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§åˆ™å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚</li><li>æ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚</li><li>Oracle å¯èƒ½ä¼šå°†HotSpot ä¸ JRockit åˆäºŒä¸ºä¸€ã€‚</li></ul><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><p>é¿å…äº†OutOfMemoryErrorçš„é—®é¢˜ã€‚ç±»çš„å…ƒæ•°æ®åˆ†é…åªå—æœ¬åœ°å†…å­˜å¤§å°çš„é™åˆ¶ã€‚</p><h2 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h2><p>å¦‚æœMetaspaceçš„ç©ºé—´å ç”¨è¾¾åˆ°äº†è®¾å®šçš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘GCæ¥æ”¶é›†æ­»äº¡å¯¹è±¡å’Œç±»çš„åŠ è½½å™¨ã€‚æ ¹æ®JDK 8çš„ç‰¹æ€§ï¼ŒG1å’ŒCMSéƒ½ä¼šå¾ˆå¥½åœ°æ”¶é›†MetaspaceåŒºï¼ˆä¸€èˆ¬éƒ½ä¼´éšç€Full GCï¼‰ã€‚</p><h2 id="JVMå‚æ•°"><a href="#JVMå‚æ•°" class="headerlink" title="JVMå‚æ•°"></a>JVMå‚æ•°</h2><ul><li>-XX:MetaspaceSize æ˜¯åˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´ï¼ˆä»¥å­—èŠ‚è®¡ï¼‰çš„åˆå§‹å¤§å°(Oracleé€»è¾‘å­˜å‚¨ä¸Šçš„åˆå§‹é«˜æ°´ä½ï¼Œthe initial high-water-mark )ï¼Œæ­¤å€¼ä¸ºä¼°è®¡å€¼ã€‚MetaspaceSizeçš„å€¼è®¾ç½®çš„è¿‡å¤§ä¼šå»¶é•¿åƒåœ¾å›æ”¶æ—¶é—´ã€‚åƒåœ¾å›æ”¶è¿‡åï¼Œå¼•èµ·ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„ç±»å…ƒæ•°æ®ç©ºé—´çš„å¤§å°å¯èƒ½ä¼šå˜å¤§ã€‚</li><li>-XX:MaxMetaspaceSize æ˜¯åˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡æ­¤å€¼å°±ä¼šè§¦å‘Full GCï¼Œæ­¤å€¼é»˜è®¤æ²¡æœ‰é™åˆ¶ï¼Œä½†åº”å–å†³äºç³»ç»Ÿå†…å­˜çš„å¤§å°ã€‚JVMä¼šåŠ¨æ€åœ°æ”¹å˜æ­¤å€¼ã€‚</li><li>-XX:MinMetaspaceFreeRatio è¡¨ç¤ºä¸€æ¬¡GCä»¥åï¼Œä¸ºäº†é¿å…å¢åŠ å…ƒæ•°æ®ç©ºé—´çš„å¤§å°ï¼Œç©ºé—²çš„ç±»å…ƒæ•°æ®çš„å®¹é‡çš„æœ€å°æ¯”ä¾‹ï¼Œä¸å¤Ÿå°±ä¼šå¯¼è‡´åƒåœ¾å›æ”¶ã€‚</li><li>-XX:MaxMetaspaceFreeRatio è¡¨ç¤ºä¸€æ¬¡GCä»¥åï¼Œä¸ºäº†é¿å…å¢åŠ å…ƒæ•°æ®ç©ºé—´çš„å¤§å°ï¼Œç©ºé—²çš„ç±»å…ƒæ•°æ®çš„å®¹é‡çš„æœ€å¤§æ¯”ä¾‹ï¼Œä¸å¤Ÿå°±ä¼šå¯¼è‡´åƒåœ¾å›æ”¶ã€‚</li></ul><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="http://www.sczyh30.com/posts/Java/jvm-metaspace/" target="_blank" rel="noopener">æ·±å…¥æ¢ç©¶JVM | æ¢ç§˜ Metaspace </a></p><p><a href="https://www.cnblogs.com/paddix/p/5309550.html" target="_blank" rel="noopener">Java8å†…å­˜æ¨¡å‹â€”æ°¸ä¹…ä»£(PermGen)å’Œå…ƒç©ºé—´(Metaspace)</a></p><p><a href="https://stackoverflow.com/questions/20563047/jdk-8-memory-layout-and-garbage-collection" target="_blank" rel="noopener">JDK 8 Memory Layout and garbage collection</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç°åœ¨java 10 éƒ½å‡ºæ¥äº†ï¼Œå†çœ‹çœ‹è‡ªå·±ï¼Œè¿java 8 éƒ½æ²¡æå®šã€‚Stay Hungry, Stay Foolish&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Java 8 å½»åº•å°†æ°¸ä¹…ä»£(PermGen)ä»HotSpot JVMç§»é™¤ã€‚æ–¹æ³•åŒºç§»è‡³Metaspaceï¼Œå­—ç¬¦ä¸²å¸¸é‡ç§»è‡³Java Heap&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In JDK 8, classes metadata is now stored in the native heap and this space is called Metaspace.&lt;br&gt;JDK 8 å¼€å§‹æŠŠç±»çš„å…ƒæ•°æ®å­˜æ”¾åˆ°æœ¬åœ°å †å†…å­˜ï¼ˆnative heapï¼‰ä¸­ï¼Œè¿™ä¸€å—åŒºåŸŸå°±å«Metaspaceã€‚&lt;br&gt;
    
    </summary>
    
      <category term="JVM" scheme="https://hsb786.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://hsb786.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm-GC</title>
    <link href="https://hsb786.github.io/2018/04/21/jvm-GC/"/>
    <id>https://hsb786.github.io/2018/04/21/jvm-GC/</id>
    <published>2018-04-21T03:10:31.000Z</published>
    <updated>2018-04-24T06:06:39.142Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å…³é”®å­—çº¦å®š"><a href="#å…³é”®å­—çº¦å®š" class="headerlink" title="å…³é”®å­—çº¦å®š"></a>å…³é”®å­—çº¦å®š</h2><ul><li>Young generation â€“&gt;æ–°ç”Ÿä»£</li><li>Tenured / Old Generation â€“&gt;è€å¹´ä»£</li><li>Perm Area â€“&gt;æ°¸ä¹…ä»£</li></ul><p><img src="/images/JVM21.png" alt=""><br><a id="more"></a></p><h2 id="æ–°ç”Ÿä»£ï¼ˆYoung-Generationï¼‰"><a href="#æ–°ç”Ÿä»£ï¼ˆYoung-Generationï¼‰" class="headerlink" title="æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰"></a>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</h2><p>æ–°ç”Ÿä»£æ˜¯æ‰€æœ‰æ–°å¯¹è±¡äº§ç”Ÿçš„åœ°æ–¹ã€‚å½“æ–°ç”Ÿä»£å†…å­˜ç©ºé—´è¢«ç”¨å®Œæ—¶ï¼Œå°±ä¼šè§¦å‘åƒåœ¾å›æ”¶ã€‚è¿™ä¸ªåƒåœ¾å›æ”¶å«åšMinor GCã€‚æ–°ç”Ÿä»£åˆ†ä¸ºEndenã€Survivor1ã€Survivor2ã€‚</p><ul><li>å¤§å¤šæ•°æ–°å»ºçš„å¯¹è±¡éƒ½ä½äºEdenåŒºã€‚</li><li>å½“EdenåŒºè¢«å¯¹è±¡å¡«æ»¡æ—¶ï¼Œå°±ä¼šæ‰§è¡ŒMinor GCã€‚å¹¶æŠŠæ‰€æœ‰å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡è½¬ç§»åˆ°å…¶ä¸­ä¸€ä¸ªsurvivoråŒºã€‚</li><li>Minor GCåŒæ ·ä¼šæ£€æŸ¥å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ï¼Œå¦‚æœéœ€è¦ä¼šæŠŠå®ƒä»¬è½¬ç§»åˆ°å¦ä¸€ä¸ªsurvivoråŒºã€‚è¿™æ ·åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªç©ºçš„survivoråŒºã€‚</li><li>ç»è¿‡å¤šæ¬¡GCå‘¨æœŸåï¼Œä»ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£å†…å­˜ç©ºé—´ã€‚é€šå¸¸è¿™æ˜¯åœ¨æ–°ç”Ÿä»£æœ‰èµ„æ ¼æå‡åˆ°è€å¹´ä»£å‰é€šè¿‡è®¾å®šå¹´é¾„é˜ˆå€¼(<em>é»˜è®¤15</em>)æ¥å®Œæˆçš„ã€‚</li></ul><h2 id="è€å¹´ä»£ï¼ˆOld-Generationï¼‰"><a href="#è€å¹´ä»£ï¼ˆOld-Generationï¼‰" class="headerlink" title="è€å¹´ä»£ï¼ˆOld Generationï¼‰"></a>è€å¹´ä»£ï¼ˆOld Generationï¼‰</h2><p>ä¸€äº›å¤§å¯¹è±¡(<em>é•¿å­—ç¬¦ä¸²æˆ–æ•°ç»„</em>)å¯èƒ½ä¼šç›´æ¥å­˜æ”¾åˆ°è€å¹´ä»£ã€‚è€å¹´ä»£å†…å­˜é‡ŒåŒ…å«äº†é•¿æœŸå­˜æ´»çš„å¯¹è±¡å’Œç»è¿‡å¤šæ¬¡Minor GCåä¾ç„¶å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ã€‚é€šå¸¸ä¼šåœ¨è€å¹´ä»£å†…å­˜è¢«å æ»¡æ—¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è€å¹´ä»£çš„åƒåœ¾æ”¶é›†å«åšMajor GCã€‚ Major GCä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><h2 id="æ°¸ä¹…ä»£ï¼ˆPerm-Areaï¼‰"><a href="#æ°¸ä¹…ä»£ï¼ˆPerm-Areaï¼‰" class="headerlink" title="æ°¸ä¹…ä»£ï¼ˆPerm Areaï¼‰"></a>æ°¸ä¹…ä»£ï¼ˆPerm Areaï¼‰</h2><p>æ°¸ä¹…ä»£æˆ–è€…â€œPerm Genâ€åŒ…å«äº†JVMéœ€è¦çš„åº”ç”¨å…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®æè¿°äº†åœ¨åº”ç”¨é‡Œä½¿ç”¨çš„ç±»å’Œæ–¹æ³•ã€‚æ³¨æ„ï¼Œæ°¸ä¹…ä»£ä¸æ˜¯Javaå †å†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚</p><blockquote><p>java8ä¸­ç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯Metaspace(å…ƒç©ºé—´)</p></blockquote><h2 id="é‡è¦çš„ä¸œä¸œ"><a href="#é‡è¦çš„ä¸œä¸œ" class="headerlink" title="é‡è¦çš„ä¸œä¸œ"></a>é‡è¦çš„ä¸œä¸œ</h2><ul><li>åœ¨Javaä¸­ï¼Œå¯¹è±¡å®ä¾‹éƒ½æ˜¯åœ¨å †ä¸Šåˆ›å»ºã€‚ä¸€äº›ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ç­‰å­˜å‚¨åœ¨æ–¹æ³•åŒºã€‚å †å’Œæ–¹æ³•åŒºéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚</li><li>GCæœºåˆ¶æ˜¯ç”±JVMæä¾›ï¼Œç”¨æ¥æ¸…ç†éœ€è¦æ¸…é™¤çš„å¯¹è±¡ï¼Œå›æ”¶å †å†…å­˜ã€‚</li><li>GCæœºåˆ¶å°†Javaç¨‹åºå‘˜ä»å†…å­˜ç®¡ç†ä¸­è§£æ”¾äº†å‡ºæ¥ï¼Œå¯ä»¥æ›´å…³æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚</li><li>åœ¨Javaä¸­ï¼ŒGCæ˜¯ç”±ä¸€ä¸ªè¢«ç§°ä¸ºåƒåœ¾å›æ”¶å™¨çš„å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œçš„ã€‚</li><li>åœ¨ä»å†…å­˜å›æ”¶ä¸€ä¸ªå¯¹è±¡ä¹‹å‰ä¼šè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ã€‚</li><li>ä½œä¸ºä¸€ä¸ªJavaå¼€å‘è€…ä¸èƒ½å¼ºåˆ¶JVMæ‰§è¡ŒGCï¼›GCçš„è§¦å‘ç”±JVMä¾æ®å †å†…å­˜çš„å¤§å°æ¥å†³å®šã€‚</li><li>System.gc()å’ŒRuntime.gc()ä¼šå‘JVMå‘é€æ‰§è¡ŒGCçš„è¯·æ±‚ï¼Œä½†æ˜¯JVMä¸ä¿è¯ä¸€å®šä¼šæ‰§è¡ŒGCã€‚</li><li>å¦‚æœå †æ²¡æœ‰å†…å­˜åˆ›å»ºæ–°çš„å¯¹è±¡äº†ï¼Œä¼šæŠ›å‡º<code>OutOfMemoryError</code>ã€‚</li></ul><h2 id="GCé’ˆå¯¹ä»€ä¹ˆå¯¹è±¡ï¼Ÿ"><a href="#GCé’ˆå¯¹ä»€ä¹ˆå¯¹è±¡ï¼Ÿ" class="headerlink" title="GCé’ˆå¯¹ä»€ä¹ˆå¯¹è±¡ï¼Ÿ"></a>GCé’ˆå¯¹ä»€ä¹ˆå¯¹è±¡ï¼Ÿ</h2><p>äº†è§£GCæœºåˆ¶çš„ç¬¬ä¸€æ­¥å°±æ˜¯ç†è§£ä»€ä¹ˆæ ·çš„å¯¹è±¡ä¼šè¢«å›æ”¶ã€‚å½“ä¸€ä¸ªå¯¹è±¡é€šè¿‡ä¸€ç³»åˆ—æ ¹å¯¹è±¡(<em>æ¯”å¦‚ï¼šé™æ€å±æ€§å¼•ç”¨çš„å¸¸é‡</em>)éƒ½ä¸å¯è¾¾æ—¶å°±ä¼šè¢«å›æ”¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½ä¸ºnullã€‚å¾ªç¯ä¾èµ–ä¸ç®—åšå¼•ç”¨ï¼Œå¦‚æœå¯¹è±¡Aæœ‰ä¸€ä¸ªæŒ‡å‘å¯¹è±¡Bçš„å¼•ç”¨ï¼Œå¯¹è±¡Bä¹Ÿæœ‰ä¸€ä¸ªæŒ‡å‘å¯¹è±¡Açš„å¼•ç”¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬æ²¡æœ‰å…¶ä»–å¼•ç”¨ï¼Œé‚£ä¹ˆå¯¹è±¡Aå’Œå¯¹è±¡Béƒ½ã€éœ€è¦è¢«å›æ”¶(å¦‚ä¸‹å›¾,ObjAå’ŒObjBéœ€è¦è¢«å›æ”¶)ã€‚</p><p><img src="/images/GC-Object.png" alt="GCå›æ”¶å¯¹è±¡"></p><h2 id="å¼•ç”¨è®°æ•°æ³•"><a href="#å¼•ç”¨è®°æ•°æ³•" class="headerlink" title="å¼•ç”¨è®°æ•°æ³•"></a>å¼•ç”¨è®°æ•°æ³•</h2><ul><li>æ€æƒ³ï¼šç»™å¯¹è±¡è®¾ç½®å¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å¼•ç”¨è¯¥å¯¹è±¡ä¸€æ¬¡ï¼Œè®¡æ•°å™¨å°±+1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±-1ï¼Œå½“ä»»æ„æ—¶å€™å¼•ç”¨è®¡æ•°å™¨çš„å€¼éƒ½ä¸º0æ—¶ï¼Œåˆ™è¯¥å¯¹è±¡å¯è¢«å›æ”¶</li><li>Javaä¸é€‚ç”¨åŸå› ï¼šæ— æ³•è§£å†³å¯¹è±¡äº’ç›¸å¾ªç¯å¼•ç”¨çš„é—®é¢˜</li></ul><h2 id="GC-Root"><a href="#GC-Root" class="headerlink" title="GC Root"></a>GC Root</h2><p>å¯è¾¾æ€§åˆ†ææ³•, å½“ä¸€ä¸ªå¯¹è±¡é€šè¿‡ä¸€ç³»åˆ—æ ¹å¯¹è±¡(Root)éƒ½ä¸å¯è¾¾æ—¶å°±ä¼šè¢«å›æ”¶ã€‚</p><p>å¯ä½œä¸ºGC Rootçš„å¯¹è±¡æœ‰:</p><ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆNativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul><p>åœ¨å¯è¾¾æ€§åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡å¼•ç”¨ç±»å‹ä¼šå¯¹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸäº§ç”Ÿå½±å“ï¼ŒJAVAä¸­æœ‰è¿™å‡ ç§ç±»å‹çš„å¼•ç”¨ï¼š</p><ul><li>å¼ºå¼•ç”¨ï¼šåªè¦è¯¥å¼•ç”¨è¿˜æœ‰æ•ˆï¼ŒGCå°±ä¸ä¼šå›æ”¶</li><li>è½¯å¼•ç”¨ï¼šå†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ä¸è¿›è¡Œå›æ”¶ï¼Œåœ¨å†…å­˜æº¢å‡ºå‘ç”Ÿå‰è¿›è¡Œå›æ”¶ã€ç”¨SoftReferenceç±»å®ç°</li><li>å¼±å¼•ç”¨ï¼šå¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡Gcæ”¶é›†ã€ç”¨WeakReferenceç±»å®ç°</li><li>è™šå¼•ç”¨ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å¾—å¯¹è±¡å®ä¾‹ï¼Œä¹Ÿä¸ä¼šå¯¹å¯¹è±¡çš„ç”Ÿå­˜æ—¶é—´äº§ç”Ÿå½±å“ã€å”¯ä¸€ç›®çš„ï¼šå½“è¯¥å¯¹è±¡è¢«Gcæ”¶é›†æ—¶ï¼Œæ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ç”¨PhantomReferenceç±»å®ç°</li></ul><p>ä¸€ä¸ªå¯¹è±¡çœŸæ­£ä¸å¯ç”¨ï¼Œè¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p><ul><li>é¦–å…ˆè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œç­›é€‰å‡ºä¸GC Rootæ²¡ç”¨å¼•ç”¨é“¾çš„å¯¹è±¡ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°</li><li>ç¬¬ä¸€æ¬¡æ ‡è®°åï¼Œå†è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰æ¡ä»¶æ˜¯æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚è‹¥å¯¹è±¡æœ‰æ²¡æœ‰é‡å†™finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ˜¯å¦å·²è¢«jvmè°ƒç”¨è¿‡ï¼Œåˆ™æ²¡å¿…è¦æ‰§è¡Œï¼ŒGCä¼šå›æ”¶è¯¥å¯¹è±¡</li><li>è‹¥æœ‰å¿…è¦æ‰§è¡Œï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢«æ”¾å…¥F-Queueä¸­ï¼Œç”±jvmå¼€å¯ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å»æ‰§è¡Œå®ƒï¼ˆä½†ä¸ä¸€å®šç­‰å¾…finalizeæ‰§è¡Œå®Œæ¯•ï¼‰ã€‚</li><li>finalize()æ˜¯å¯¹è±¡æœ€åä¸€æ¬¡è‡ªæ•‘çš„æœºä¼šï¼Œè‹¥å¯¹è±¡åœ¨finalize()ä¸­é‡æ–°åŠ å…¥åˆ°å¼•ç”¨é“¾ä¸­ï¼Œåˆ™å®ƒä¼šè¢«ç§»å‡ºè¦å›æ”¶çš„å¯¹è±¡çš„é›†åˆã€‚å…¶ä»–å¯¹è±¡åˆ™ä¼šè¢«ç¬¬äºŒæ¬¡æ ‡è®°ï¼Œè¿›è¡Œå›æ”¶</li></ul><h2 id="GCç®—æ³•"><a href="#GCç®—æ³•" class="headerlink" title="GCç®—æ³•"></a>GCç®—æ³•</h2><ol><li>æ ‡è®°æ¸…é™¤ç®—æ³•<br> åˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µï¼š<strong>é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</strong>ã€‚è¯¥ç®—æ³•çš„ç¼ºç‚¹æ˜¯æ•ˆç‡ä¸é«˜å¹¶ä¸”ä¼šäº§ç”Ÿä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚<br><img src="/images/sweep.jpg" alt="æ ‡è®°æ¸…é™¤"></li><li>å¤åˆ¶ç®—æ³•<br> <strong>æŠŠå†…å­˜ç©ºé—´åˆ’ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåŒºåŸŸã€‚åƒåœ¾å›æ”¶æ—¶ï¼Œéå†å½“å‰ä½¿ç”¨åŒºåŸŸï¼ŒæŠŠæ­£åœ¨ä½¿ç”¨ä¸­çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªåŒºåŸŸä¸­</strong>ã€‚æ­¤ç®—æ³•æ¯æ¬¡åªå¤„ç†æ­£åœ¨ä½¿ç”¨ä¸­çš„å¯¹è±¡ï¼Œå› æ­¤å¤åˆ¶æˆæœ¬æ¯”è¾ƒå°ï¼ŒåŒæ—¶å¤åˆ¶è¿‡å»ä»¥åè¿˜èƒ½è¿›è¡Œç›¸åº”çš„å†…å­˜æ•´ç†ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚ç¼ºç‚¹ï¼šä¼šæµªè´¹ä¸€å®šçš„å†…å­˜ã€‚ä¸€èˆ¬æ–°ç”Ÿä»£é‡‡ç”¨è¿™ç§ç®—æ³•ã€‚<br><img src="/images/copy.jpg" alt="å¤åˆ¶"></li><li><p>æ ‡è®°æ•´ç†ç®—æ³•<br> <strong>æ ‡è®°é˜¶æ®µä¸æ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ã€‚ä½†åç»­å¹¶ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶çš„å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†</strong>ã€‚ä¼˜ç‚¹æ˜¯ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ã€‚<br><img src="/images/compact.jpg" alt="æ ‡è®°æ•´ç†"></p></li><li><p>åˆ†ä»£æ”¶é›†ç®—æ³•</p></li></ol><ul><li>æŠŠå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£</li><li>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•</li><li>å°†æ–°ç”Ÿä»£å†…å­˜åˆ†ä¸ºä¸€å—å¤§çš„EdenåŒºå’Œä¸¤å—å°çš„Survivorï¼›æ¯æ¬¡ä½¿ç”¨Edenå’Œä¸€ä¸ªSurvivorï¼Œå›æ”¶æ—¶å°†Edenå’ŒSurvivorå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivorï¼ˆHotSpotçš„æ¯”ä¾‹Edenï¼šSurvivor = 8ï¼š1ï¼‰</li><li>è€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…ç†æˆ–è€…æ ‡è®°-æ•´ç†</li></ul><p><img src="/images/javaè™šæ‹Ÿæœº2.png" alt=""></p><h2 id="å†…å­˜åˆ†é…è§„åˆ™"><a href="#å†…å­˜åˆ†é…è§„åˆ™" class="headerlink" title="å†…å­˜åˆ†é…è§„åˆ™"></a>å†…å­˜åˆ†é…è§„åˆ™</h2><ul><li>å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…<ul><li>å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶å°±ä¼šå‘èµ·ä¸€æ¬¡Minor GC</li></ul></li><li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£<ul><li>å…¸å‹çš„å¤§å¯¹è±¡æ˜¯å¾ˆé•¿çš„å­—ç¬¦ä¸²å’Œæ•°ç»„</li></ul></li><li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£<ul><li>æ¯ä¸ªå¯¹è±¡æœ‰å¹´é¾„è®¡æ•°å™¨ï¼Œæ¯ç»è¿‡ä¸€æ¬¡GCï¼Œè®¡æ•°å™¨å€¼åŠ ä¸€ï¼Œå½“åˆ°è¾¾ä¸€å®šç¨‹åº¦æ—¶ï¼ˆé»˜è®¤15ï¼‰ï¼Œå°±ä¼šè¿›å…¥è€å¹´ä»£</li><li>å¹´é¾„çš„é˜ˆå€¼å¯é€šè¿‡å‚æ•° -XX:MaxTenuringThresholdè®¾ç½®</li></ul></li><li>å¯¹è±¡å¹´é¾„çš„åˆ¤å®š<ul><li>Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°MaxTenuringThresholdè¦æ±‚çš„å¹´é¾„</li></ul></li><li>ç©ºé—´åˆ†é…æ‹…ä¿<ul><li>å‘ç”ŸMinor GCå‰ï¼Œjvmä¼šæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œè‹¥å¤§äºï¼Œåˆ™Minor GCæ˜¯å®‰å…¨çš„</li><li>è‹¥ä¸å¤§äºï¼Œjvmä¼šæŸ¥çœ‹HandlePromotionFailureæ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œè‹¥ä¸å…è®¸ï¼Œåˆ™æ”¹ä¸ºä¸€æ¬¡Full GC</li><li>è‹¥å…è®¸æ‹…ä¿å¤±è´¥ï¼Œåˆ™æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œè‹¥å¤§äºï¼Œåˆ™å°è¯•è¿›è¡ŒMinor GCï¼›è‹¥å°äºï¼Œåˆ™è¦æ”¹ä¸ºFull GC</li></ul></li></ul><h2 id="Javaä¸­åƒåœ¾å›æ”¶å™¨çš„ç±»å‹"><a href="#Javaä¸­åƒåœ¾å›æ”¶å™¨çš„ç±»å‹" class="headerlink" title="Javaä¸­åƒåœ¾å›æ”¶å™¨çš„ç±»å‹"></a>Javaä¸­åƒåœ¾å›æ”¶å™¨çš„ç±»å‹</h2><p>Javaæä¾›å¤šç§ç±»å‹çš„åƒåœ¾å›æ”¶å™¨ã€‚JVMä¸­çš„åƒåœ¾æ”¶é›†ä¸€èˆ¬éƒ½é‡‡ç”¨â€œåˆ†ä»£æ”¶é›†â€ï¼Œä¸åŒçš„å †å†…å­˜åŒºåŸŸé‡‡ç”¨ä¸åŒçš„æ”¶é›†ç®—æ³•ï¼Œä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å¢åŠ ååé‡æˆ–é™ä½åœé¡¿æ—¶é—´ã€‚</p><ul><li>Serialæ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒGCï¼Œä¸²è¡Œï¼Œå…¶å®ƒå·¥ä½œçº¿ç¨‹æš‚åœã€‚</li><li>ParNewæ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼ŒSerialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆï¼Œç”¨å¤šä¸ªçº¿ç¨‹è¿›è¡ŒGCï¼Œå¹¶è¡Œï¼Œå…¶å®ƒå·¥ä½œçº¿ç¨‹æš‚åœã€‚ä½¿ç”¨-XX:+UseParNewGCå¼€å…³æ¥æ§åˆ¶ä½¿ç”¨ParNew+Serial Oldæ”¶é›†å™¨ç»„åˆæ”¶é›†å†…å­˜ï¼›ä½¿ç”¨-XX:ParallelGCThreadsæ¥è®¾ç½®æ‰§è¡Œå†…å­˜å›æ”¶çš„çº¿ç¨‹æ•°ã€‚</li><li>Parallel Scavenge æ”¶é›†å™¨ï¼šååé‡ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼Œä½œç”¨åœ¨æ–°ç”Ÿä»£ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå…³æ³¨CPUååé‡ï¼Œå³è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´/æ€»æ—¶é—´ã€‚ä½¿ç”¨-XX:+UseParallelGCå¼€å…³æ§åˆ¶ä½¿ç”¨Parallel Scavenge+Serial Oldæ”¶é›†å™¨ç»„åˆå›æ”¶åƒåœ¾ã€‚</li><li>Serial Oldæ”¶é›†å™¨ï¼šè€å¹´ä»£æ”¶é›†å™¨ï¼Œå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä¸²è¡Œï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•ï¼Œä½¿ç”¨å•çº¿ç¨‹è¿›è¡ŒGCï¼Œå…¶å®ƒå·¥ä½œçº¿ç¨‹æš‚åœã€‚</li><li>Parallel Oldæ”¶é›†å™¨ï¼šååé‡ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼Œä½œç”¨åœ¨è€å¹´ä»£ï¼Œå¤šçº¿ç¨‹ï¼Œå¹¶è¡Œï¼Œå¤šçº¿ç¨‹æœºåˆ¶ä¸Parallel Scavengeå·®ä¸é”™ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•ï¼Œåœ¨Parallel Oldæ‰§è¡Œæ—¶ï¼Œä»ç„¶éœ€è¦æš‚åœå…¶å®ƒçº¿ç¨‹ã€‚</li><li>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨ï¼šè€å¹´ä»£æ”¶é›†å™¨ï¼Œè‡´åŠ›äºè·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ï¼ˆå³ç¼©çŸ­åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼‰ï¼Œä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå¤šçº¿ç¨‹ï¼Œä¼˜ç‚¹æ˜¯å¹¶å‘æ”¶é›†ï¼ˆç”¨æˆ·çº¿ç¨‹å¯ä»¥å’ŒGCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼‰ï¼Œåœé¡¿å°ã€‚ä½¿ç”¨-XX:+UseConcMarkSweepGCè¿›è¡ŒParNew+CMS+Serial Oldè¿›è¡Œå†…å­˜å›æ”¶ï¼Œä¼˜å…ˆä½¿ç”¨ParNew+CMSï¼ˆåŸå› è§Full GCå’Œå¹¶å‘åƒåœ¾å›æ”¶ä¸€èŠ‚ï¼‰ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å†…å­˜ä¸è¶³æ—¶ï¼Œé‡‡ç”¨å¤‡ç”¨æ–¹æ¡ˆSerial Oldæ”¶é›†ã€‚</li></ul><h2 id="ä¸GCæœ‰å…³çš„JVMå‚æ•°"><a href="#ä¸GCæœ‰å…³çš„JVMå‚æ•°" class="headerlink" title="ä¸GCæœ‰å…³çš„JVMå‚æ•°"></a>ä¸GCæœ‰å…³çš„JVMå‚æ•°</h2><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>-Xms</td><td>è®¾ç½®JVMå¯åŠ¨æ—¶å †çš„åˆå§‹åŒ–å¤§å°ã€‚</td></tr><tr><td>-Xmx</td><td>è®¾ç½®å †æœ€å¤§å€¼ã€‚</td></tr><tr><td>-Xmn</td><td>è®¾ç½®æ–°ç”Ÿä»£çš„ç©ºé—´å¤§å°ï¼Œå‰©ä¸‹çš„ä¸ºè€å¹´ä»£çš„ç©ºé—´å¤§å°ã€‚</td></tr><tr><td>-XX:SurvivorRatio</td><td>æä¾›EdenåŒºå’ŒsurvivoråŒºçš„ç©ºé—´æ¯”ä¾‹ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ–°ç”Ÿä»£çš„å¤§å°ä¸º10må¹¶ä¸”VMå¼€å…³æ˜¯-XX:SurvivorRatio=2ï¼Œé‚£ä¹ˆå°†ä¼šä¿ç•™5må†…å­˜ç»™EdenåŒºå’Œæ¯ä¸ªSurvivoråŒºåˆ†é…2.5må†…å­˜ã€‚é»˜è®¤æ¯”ä¾‹æ˜¯8ã€‚</td></tr><tr><td>-XX:NewRatio</td><td>æä¾›è€å¹´ä»£å’Œæ–°ç”Ÿä»£çš„æ¯”ä¾‹å¤§å°ã€‚é»˜è®¤å€¼æ˜¯2ã€‚</td></tr><tr><td>-XX:MetaspaceSize</td><td>åˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´çš„åˆå§‹å¤§å°</td></tr><tr><td>-XX:MaxMetaspaceSize</td><td>åˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´çš„æœ€å¤§å€¼</td></tr><tr><td>-XX:MinMetaspaceFreeRatio</td><td>ä¸€æ¬¡GCä»¥åï¼Œä¸ºäº†é¿å…å¢åŠ å…ƒæ•°æ®ç©ºé—´çš„å¤§å°ï¼Œç©ºé—²çš„ç±»å…ƒæ•°æ®çš„å®¹é‡çš„æœ€å°æ¯”ä¾‹ï¼Œä¸å¤Ÿå°±ä¼šå¯¼è‡´åƒåœ¾å›æ”¶ã€‚</td></tr><tr><td>-XX:MaxMetaspaceFreeRatio</td><td>ä¸€æ¬¡GCä»¥åï¼Œä¸ºäº†é¿å…å¢åŠ å…ƒæ•°æ®ç©ºé—´çš„å¤§å°ï¼Œç©ºé—²çš„ç±»å…ƒæ•°æ®çš„å®¹é‡çš„æœ€å¤§æ¯”ä¾‹ï¼Œä¸å¤Ÿå°±ä¼šå¯¼è‡´åƒåœ¾å›æ”¶ã€‚</td></tr></tbody></table><h2 id="GCç›‘æ§"><a href="#GCç›‘æ§" class="headerlink" title="GCç›‘æ§"></a>GCç›‘æ§</h2><p>å¯ä»¥ä½¿ç”¨JDKè‡ªå¸¦çš„VisualVMè¿›è¡Œç›‘æ§</p><p><img src="/images/JVM22.png" alt="Java2D"></p><p><img src="/images/JVM23.png" alt="ç›‘è§†å™¨"></p><p><img src="/images/JVM24.png" alt="çº¿ç¨‹"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>ä¸ºäº†åˆ†ä»£åƒåœ¾å›æ”¶ï¼ŒJavaå †å†…å­˜åˆ†ä¸º3ä»£ï¼šæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ°¸ä¹…ä»£ã€‚java8å¼€å§‹æ°¸ä¹…ä»£å·²ç§»å‡º</li><li>æ–°çš„å¯¹è±¡å®ä¾‹ä¼šä¼˜å…ˆåˆ†é…åœ¨æ–°ç”Ÿä»£ï¼Œåœ¨ç»å†å‡ æ¬¡Minor GCå(é»˜è®¤15æ¬¡)ï¼Œè¿˜å­˜æ´»çš„ä¼šè¢«ç§»è‡³è€å¹´ä»£(æŸäº›å¤§å¯¹è±¡ä¼šç›´æ¥åœ¨è€å¹´ä»£åˆ†é…)ã€‚</li><li>Minor GCå‘ç”Ÿåœ¨æ–°ç”Ÿä»£ï¼Œå½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ—¶ï¼Œä¼šå‘èµ·ä¸€æ¬¡Minor GCï¼Œå°†EdenåŒºä¸­çš„å­˜æ´»å¯¹è±¡ç§»è‡³SurvivoråŒºã€‚Major GCå‘ç”Ÿåœ¨è€å¹´ä»£ï¼Œå½“å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´æ—¶ä¼šå‘ç”ŸMajor GCã€‚</li><li>å‘ç”ŸMajor GCæ—¶ç”¨æˆ·çº¿ç¨‹ä¼šæš‚åœï¼Œä¼šé™ä½ç³»ç»Ÿæ€§èƒ½å’Œååé‡ã€‚</li><li>Javaä¸­ä¸èƒ½æ‰‹åŠ¨è§¦å‘GCï¼Œä½†å¯ä»¥ç”¨ä¸åŒçš„å¼•ç”¨ç±»æ¥è¾…åŠ©åƒåœ¾å›æ”¶å™¨å·¥ä½œ(æ¯”å¦‚ï¼šå¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨)ã€‚</li></ul><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://yemengying.com/2016/05/13/jvm-GC/" target="_blank" rel="noopener">ã€è¯‘ã€‘Javaä¸­çš„åƒåœ¾å›æ”¶æœºåˆ¶ </a></p><p><a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">Java HotSpot VM Options</a></p><p><a href="http://www.importnew.com/14086.html" target="_blank" rel="noopener">Javaå†…å­˜ä¸åƒåœ¾å›æ”¶è°ƒä¼˜</a></p><p><a href="http://colobu.com/2015/04/14/Java-GC-memo/" target="_blank" rel="noopener">Java GC ä¸­çš„ä¸€äº›æ¦‚å¿µ</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å…³é”®å­—çº¦å®š&quot;&gt;&lt;a href=&quot;#å…³é”®å­—çº¦å®š&quot; class=&quot;headerlink&quot; title=&quot;å…³é”®å­—çº¦å®š&quot;&gt;&lt;/a&gt;å…³é”®å­—çº¦å®š&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Young generation â€“&amp;gt;æ–°ç”Ÿä»£&lt;/li&gt;
&lt;li&gt;Tenured / Old Generation â€“&amp;gt;è€å¹´ä»£&lt;/li&gt;
&lt;li&gt;Perm Area â€“&amp;gt;æ°¸ä¹…ä»£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/images/JVM21.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="JVM" scheme="https://hsb786.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://hsb786.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Unsafe</title>
    <link href="https://hsb786.github.io/2018/04/20/Unsafe/"/>
    <id>https://hsb786.github.io/2018/04/20/Unsafe/</id>
    <published>2018-04-20T10:48:25.000Z</published>
    <updated>2018-04-20T13:19:46.046Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>sun.misc.Unsafeç±»æä¾›çš„åŸå­æ“ä½œæ˜¯åŸºäºæ“ä½œç³»ç»Ÿç›´æ¥å¯¹CPUè¿›è¡Œæ“ä½œ</p></blockquote><p>Unsafeç±»åŒ…è£…äº†å¾ˆå¤šä½çº§åˆ«çš„éå®‰å…¨æ€§æ“ä½œï¼Œå¯ä»¥ç›´æ¥æ“ä½œä»»æ„çš„å†…å­˜ã€‚è™½ç„¶è¯¥ç±»çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯publicçš„ï¼Œä½†æ˜¯å®ƒåªèƒ½è¢«å—ä¿¡ä»»çš„ä»£ç ä½¿ç”¨ï¼ˆjdkä¸­çš„ä»£ç ï¼‰<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public final class Unsafe &#123;</span><br><span class="line"></span><br><span class="line">    private static native void registerNatives();</span><br><span class="line">    static &#123;</span><br><span class="line">        registerNatives();</span><br><span class="line">        sun.reflect.Reflection.registerMethodsToFilter(Unsafe.class, &quot;getUnsafe&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //é¥¿æ±‰å¼å•ä¾‹</span><br><span class="line">    private Unsafe() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    private static final Unsafe theUnsafe = new Unsafe();</span><br><span class="line"></span><br><span class="line">    @CallerSensitive</span><br><span class="line">    public static Unsafe getUnsafe() &#123;</span><br><span class="line">        //è·å–è°ƒç”¨è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ä¿¡æ¯</span><br><span class="line">        Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">        //åˆ¤æ–­ç±»åŠ è½½å™¨æ˜¯å¦æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨</span><br><span class="line">        if (!VM.isSystemDomainLoader(caller.getClassLoader()))</span><br><span class="line">            throw new SecurityException(&quot;Unsafe&quot;);</span><br><span class="line">        return theUnsafe;</span><br><span class="line">    &#125;</span><br><span class="line">    .............</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//VM.class</span><br><span class="line"> public static boolean isSystemDomainLoader(ClassLoader loader) &#123;</span><br><span class="line">        return loader == null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Unsafe.getUnsafe()åªèƒ½è¢«boostrap classloaderåŠ è½½çš„ç±»ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨javaåå°„æ¥è·å–Unsafeçš„å®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//è·å–Unsafeç±»ä¸­çš„theUnsafeå­—æ®µ</span><br><span class="line">Field f = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;);</span><br><span class="line">//ç”±äºtheUnsafeè¢«privateä¿®é¥°ï¼Œæ‰€ä»¥è¦è·³è¿‡å®‰å…¨æ£€æŸ¥</span><br><span class="line">f.setAccessible(true);</span><br><span class="line">//è·å–å½“å‰fçš„å€¼ï¼Œä¹Ÿå°±æ˜¯Unsafeçš„å®ä¾‹</span><br><span class="line">Unsafe unsafe = (Unsafe) f.get(null);</span><br></pre></td></tr></table></figure><p><code>public native long objectFieldOffset(Field f)</code>å’Œ<code>public native long staticFieldOffset(Field f)</code>ï¼šç”¨äºè¿”å›ç±»å®šä¹‰ä¸­æŸä¸ªå±æ€§åœ¨ä¸»å†…å­˜ä¸­è®¾å®šçš„åç§»é‡ã€‚ç›¸å½“äºCASä¸­çš„Vã€‚</p><p><code>public final native boolean compareAndSwapInt(Object o, long offset, int expected, int x);</code>ï¼šå¯¹å±æ€§è¿›è¡Œæ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆCASè¿‡ç¨‹â€”â€”Compare And Swapï¼‰ã€‚offectï¼šVï¼Œexpectedï¼šAï¼Œxï¼šB </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//java8</span><br><span class="line">public final int getAndAddInt(Object o, long offset, int delta) &#123;</span><br><span class="line">    int v;</span><br><span class="line">    do &#123;</span><br><span class="line">        //è‡ªæ—‹ï¼Œä¸€ç›´å¾ªç¯ç›´åˆ°compareAndSwapIntæ‰§è¡ŒæˆåŠŸ</span><br><span class="line">        v = getIntVolatile(o, offset);</span><br><span class="line">    &#125; while (!compareAndSwapInt(o, offset, v, v + delta));</span><br><span class="line">    return v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public native int     getIntVolatile(Object o, long offset);</span><br></pre></td></tr></table></figure><p><code>getAndAddInt()</code>é‡‡ç”¨çš„æ˜¯åŸºäºUnsafeçš„â€ä¹è§‚é”â€è¿›è¡Œå®ç°çš„ï¼Œä¹è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸é‚£ä¹ˆä¸¥é‡ï¼Œæ‰€ä»¥è®©çº¿ç¨‹ä¸æ–­å»å°è¯•æ›´æ–°ã€‚é€‚åˆå¹¶å‘é‡ä¸é«˜çš„æƒ…å†µã€‚</p><hr><h2 id="CallerSensitive"><a href="#CallerSensitive" class="headerlink" title="@CallerSensitive"></a>@CallerSensitive</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//sun.reflect.CallerSensitive</span><br><span class="line">/**</span><br><span class="line"> * A method annotated @CallerSensitive is sensitive to its calling class,</span><br><span class="line"> * via &#123;@link sun.reflect.Reflection#getCallerClass Reflection.getCallerClass&#125;,</span><br><span class="line"> * or via some equivalent.</span><br><span class="line"> *</span><br><span class="line"> * @author John R. Rose</span><br><span class="line"> */</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(&#123;METHOD&#125;)</span><br><span class="line">public @interface CallerSensitive &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//sun.reflect.Reflection</span><br><span class="line">/** Returns the class of the caller of the method calling this method,</span><br><span class="line">    ignoring frames associated with java.lang.reflect.Method.invoke()</span><br><span class="line">    and its implementation. */</span><br><span class="line">@CallerSensitive</span><br><span class="line">public static native Class&lt;?&gt; getCallerClass();</span><br></pre></td></tr></table></figure><blockquote><p>ç”¨@CallerSensitiveæ³¨è§£ä¿®é¥°çš„æ–¹æ³•ä»ä¸€å¼€å§‹å°±çŸ¥é“å…·ä½“è°ƒç”¨å®ƒçš„å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸ç”¨å†ç»è¿‡ä¸€ç³»åˆ—çš„æ£€æŸ¥æ‰èƒ½ç¡®å®šå…·ä½“è°ƒç”¨å®ƒçš„å¯¹è±¡äº†ã€‚å®ƒå®é™…ä¸Šæ˜¯è°ƒç”¨sun.reflect.Reflection.getCallerClassæ–¹æ³•ã€‚</p></blockquote><p>Reflectionç±»ä½äºè°ƒç”¨æ ˆä¸­çš„0å¸§ä½ç½®ï¼Œsun.reflect.Reflection.getCallerClass()æ–¹æ³•è¿”å›è°ƒç”¨æ ˆä¸­ä»0å¸§å¼€å§‹çš„ç¬¬xå¸§ä¸­çš„ç±»å®ä¾‹ã€‚è¯¥æ–¹æ³•æä¾›çš„æœºåˆ¶å¯ç”¨äºç¡®å®šè°ƒç”¨è€…ç±»ï¼Œä»è€Œå®ç°â€œæ„ŸçŸ¥è°ƒç”¨è€…ï¼ˆCaller Sensitiveï¼‰â€çš„è¡Œä¸ºï¼Œå³å…è®¸åº”ç”¨ç¨‹åºæ ¹æ®è°ƒç”¨ç±»æˆ–è°ƒç”¨æ ˆä¸­çš„å…¶å®ƒç±»æ¥æ”¹å˜å…¶è‡ªèº«çš„è¡Œä¸ºã€‚</p><p><em>æ„Ÿè§‰ä¸å¤ªæ‡‚ï¼Œåšä¸ªæ ‡è®°ï¼Œä»¥åå†æ¥çœ‹å§</em></p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://blog.csdn.net/yinwenjie/article/details/72909981" target="_blank" rel="noopener">çº¿ç¨‹è¿›é˜¶ï¼šå¤šä»»åŠ¡å¤„ç†ï¼ˆ17ï¼‰â€”â€”Javaä¸­çš„é”ï¼ˆUnsafeåŸºç¡€ï¼‰ </a></p><p><a href="https://juejin.im/post/5921927c44d904006cca9720" target="_blank" rel="noopener">è·Ÿæˆ‘ä¸€èµ·å‰–æ Java å¹¶å‘æºç ä¹‹ Unsafe</a></p><p><a href="https://blog.csdn.net/aguda_king/article/details/72355807" target="_blank" rel="noopener">JDK8çš„@CallerSensitive</a></p><p><a href="https://blog.csdn.net/HEL_WOR/article/details/50199797" target="_blank" rel="noopener">JVMæ³¨è§£@CallSensitive</a></p><p><a href="http://www.sczyh30.com/posts/Java/java-reflection-2/" target="_blank" rel="noopener">æ·±å…¥è§£æJavaåå°„ï¼ˆ2ï¼‰ - invokeæ–¹æ³• </a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;sun.misc.Unsafeç±»æä¾›çš„åŸå­æ“ä½œæ˜¯åŸºäºæ“ä½œç³»ç»Ÿç›´æ¥å¯¹CPUè¿›è¡Œæ“ä½œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Unsafeç±»åŒ…è£…äº†å¾ˆå¤šä½çº§åˆ«çš„éå®‰å…¨æ€§æ“ä½œï¼Œå¯ä»¥ç›´æ¥æ“ä½œä»»æ„çš„å†…å­˜ã€‚è™½ç„¶è¯¥ç±»çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯publicçš„ï¼Œä½†æ˜¯å®ƒåªèƒ½è¢«å—ä¿¡ä»»çš„ä»£ç ä½¿ç”¨ï¼ˆjdkä¸­çš„ä»£ç ï¼‰&lt;br&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹åŸºç¡€2</title>
    <link href="https://hsb786.github.io/2018/04/20/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%802/"/>
    <id>https://hsb786.github.io/2018/04/20/å¤šçº¿ç¨‹åŸºç¡€2/</id>
    <published>2018-04-20T05:28:33.000Z</published>
    <updated>2018-04-24T06:20:42.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>çº¿ç¨‹æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº§åˆ«çš„æ¦‚å¿µã€‚JAVAè¯­è¨€ï¼ˆåŒ…æ‹¬å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼‰æœ¬èº«ä¸åˆ›å»ºçº¿ç¨‹ï¼›è€Œæ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿå±‚æä¾›çš„æ¥å£åˆ›å»ºã€æ§åˆ¶ã€é”€æ¯çº¿ç¨‹å®ä¾‹ã€‚</p></blockquote><a id="more"></a><p>æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼ˆWindows/Unix/Linux/å…¶ä»–ï¼‰ï¼Œä»–ä»¬æ‰€æ”¯æŒçš„çº¿ç¨‹åº•å±‚å®ç°å’Œæ“ä½œæ•ˆæœä¹Ÿæ˜¯ä¸å°½ç›¸åŒçš„ã€‚ä¸è¿‡ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ”¯æŒçš„çº¿ç¨‹è‡³å°‘ä¼šæœ‰å››ç§çŠ¶æ€ï¼šå°±ç»ªã€è¿è¡Œã€é˜»å¡å’Œç»ˆæ­¢ã€‚<strong>çº¿ç¨‹åœ¨å››ç§çŠ¶æ€ä¸‹è¿›è¡Œåˆ‡æ¢ï¼Œéƒ½æ˜¯è¦æ¶ˆè€—ä¸å°‘çš„CPUè®¡ç®—èƒ½åŠ›çš„ã€‚</strong></p><p>æ ¹æ®æ“ä½œç³»ç»Ÿä½¿ç”¨çº¿ç¨‹çš„è¿›ç¨‹çš„ä¸ä¸€æ ·ï¼Œçº¿ç¨‹è¿˜åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ˆå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œæ˜¯æŒ‡æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºäº†å®Œæˆç¡¬ä»¶æ¥å£å±‚æ“ä½œï¼Œ<strong>ç”±æ“ä½œç³»ç»Ÿå†…æ ¸åˆ›å»ºçš„çº¿ç¨‹</strong>ï¼šä¾‹å¦‚I/Oæ“ä½œçš„å†…æ ¸çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹åº”ç”¨ç¨‹åºæ˜¯ä¸èƒ½å¹²é¢„çš„ï¼›ç”¨æˆ·çº¿ç¨‹ï¼Œæ˜¯æŒ‡ç”¨æˆ·å®‰è£…/ç®¡ç†çš„åº”ç”¨ç¨‹åºï¼Œä¸ºæ‰§è¡ŒæŸä¸€ç§æ“ä½œï¼Œè€Œ<strong>ç”±è¿™ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹</strong>ã€‚</p><p><img src="/images/Thread01.jpg" alt=""></p><p>é»„è‰²é’¥åŒ™ä»£è¡¨å¯¹è±¡é”</p><h2 id="thread-interrupt-ï¼ŒThread-interrupted-ï¼Œthread-isInterrupted"><a href="#thread-interrupt-ï¼ŒThread-interrupted-ï¼Œthread-isInterrupted" class="headerlink" title="thread.interrupt()ï¼ŒThread.interrupted()ï¼Œthread.isInterrupted()"></a>thread.interrupt()ï¼ŒThread.interrupted()ï¼Œthread.isInterrupted()</h2><p><img src="/images/Thread02.png" alt=""></p><p><img src="/images/Thread03.png" alt=""></p><p>å½“Threadæ”¶åˆ°interruptä¿¡å·æ˜¯ï¼Œå¯èƒ½çš„ä¸¤ç§ç»“æœ:</p><ol><li>çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œçº¿ç¨‹å¯¹è±¡çš„isInterruptå±æ€§è¢«ç½®ä¸ºtrue</li><li>å¤„äºé˜»å¡çŠ¶æ€æ˜¯ï¼ŒæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œå…¶isInterruptä¸ä¼šè¢«ç½®ä¸ºtrueã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * Tests whether the current thread has been interrupted.  The</span><br><span class="line">     * &lt;i&gt;interrupted status&lt;/i&gt; of the thread is cleared by this method.  In</span><br><span class="line">     * other words, if this method were to be called twice in succession, the</span><br><span class="line">     * second call would return false (unless the current thread were</span><br><span class="line">     * interrupted again, after the first call had cleared its interrupted</span><br><span class="line">     * status and before the second call had examined it).</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;A thread interruption ignored because a thread was not alive</span><br><span class="line">     * at the time of the interrupt will be reflected by this method</span><br><span class="line">     * returning false.</span><br><span class="line">     *</span><br><span class="line">     * @return  &lt;code&gt;true&lt;/code&gt; if the current thread has been interrupted;</span><br><span class="line">     *          &lt;code&gt;false&lt;/code&gt; otherwise.</span><br><span class="line">     * @see #isInterrupted()</span><br><span class="line">     * @revised 6.0</span><br><span class="line">     */</span><br><span class="line">    public static boolean interrupted() &#123;</span><br><span class="line">        return currentThread().isInterrupted(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Tests whether this thread has been interrupted.  The &lt;i&gt;interrupted</span><br><span class="line">     * status&lt;/i&gt; of the thread is unaffected by this method.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;A thread interruption ignored because a thread was not alive</span><br><span class="line">     * at the time of the interrupt will be reflected by this method</span><br><span class="line">     * returning false.</span><br><span class="line">     *</span><br><span class="line">     * @return  &lt;code&gt;true&lt;/code&gt; if this thread has been interrupted;</span><br><span class="line">     *          &lt;code&gt;false&lt;/code&gt; otherwise.</span><br><span class="line">     * @see     #interrupted()</span><br><span class="line">     * @revised 6.0</span><br><span class="line">     */</span><br><span class="line">    public boolean isInterrupted() &#123;</span><br><span class="line">        return isInterrupted(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Tests if some Thread has been interrupted.  The interrupted state</span><br><span class="line">     * is reset or not based on the value of ClearInterrupted that is</span><br><span class="line">     * passed.</span><br><span class="line">     */</span><br><span class="line">    private native boolean isInterrupted(boolean ClearInterrupted);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºinterruptedå’ŒisInterruptedåŒºåˆ«åœ¨äºä¼ ç»™ClearInterruptedçš„å‚æ•°æ˜¯trueè¿˜æ˜¯falseã€‚</p><p><strong>ClearInterruptedå‚æ•°å‘æ“ä½œç³»ç»ŸæŒ‡æ˜æ˜¯å¦åœ¨è·å–çŠ¶æ€åå°†å½“å‰çº¿ç¨‹çš„interruptedçŠ¶æ€é‡ç½®ä¸ºfalseã€‚</strong></p><p>è¿™å°±æ„å‘³ç€å½“æŸä¸ªçº¿ç¨‹çš„isInterruptå±æ€§æˆåŠŸè¢«ç½®ä¸ºtrueåï¼Œå¦‚æœæ‚¨ä½¿ç”¨å¯¹è±¡æ–¹æ³•thread.isInterrupted()è·å–å€¼ï¼Œæ— è®ºæ‚¨è·å–å¤šå°‘æ¬¡å¾—åˆ°çš„è¿”å›å€¼éƒ½æ˜¯trueï¼›ä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨é™æ€æ–¹æ³•Thread.interrupted()è·å–å€¼ï¼Œé‚£ä¹ˆåªæœ‰ç¬¬ä¸€æ¬¡è·å–çš„ç»“æœæ˜¯trueï¼Œéšåçº¿ç¨‹çš„isInterruptå±æ€§å°†è¢«æ¢å¤æˆfalseï¼Œåç»­æ— è®ºä½¿ç”¨Thread.interrupted()è°ƒç”¨è¿˜æ˜¯ä½¿ç”¨thread.isInterrupted()è°ƒç”¨ï¼Œè·å–çš„ç»“æœéƒ½æ˜¯falseã€‚</p><p>waitå’Œsleepéƒ½æ˜¯è®©<strong>å½“å‰çº¿ç¨‹</strong>è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œyieldæ˜¯è®©ä¸»çº¿ç¨‹ç­‰å¾…è°ƒç”¨yieldçš„çº¿ç¨‹æ‰§è¡Œå®Œã€‚</p><p>sleepå’Œyieldéƒ½æ˜¯public static native voidæ–¹æ³•</p><hr><p>Javaè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§åŸºç¡€çº¿ç¨‹æ± çš„é€‰æ‹©ï¼šScheduledThreadPoolExecutorå’ŒThreadPoolExecutorã€‚å®ƒä»¬éƒ½å®ç°äº†ExecutorServiceæ¥å£ï¼ˆæ³¨æ„ï¼ŒExecutorServiceæ¥å£æœ¬èº«å’Œâ€œçº¿ç¨‹æ± â€å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒçš„å®šä¹‰æ›´æ¥è¿‘â€œæ‰§è¡Œå™¨â€ï¼Œè€Œâ€œä½¿ç”¨çº¿ç¨‹ç®¡ç†çš„æ–¹å¼è¿›è¡Œå®ç°â€åªæ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°æ–¹å¼ï¼‰ã€‚</p><h2 id="JAVAä¸»è¦çº¿ç¨‹æ± çš„ç»§æ‰¿ç»“æ„"><a href="#JAVAä¸»è¦çº¿ç¨‹æ± çš„ç»§æ‰¿ç»“æ„" class="headerlink" title="JAVAä¸»è¦çº¿ç¨‹æ± çš„ç»§æ‰¿ç»“æ„"></a>JAVAä¸»è¦çº¿ç¨‹æ± çš„ç»§æ‰¿ç»“æ„</h2><p><img src="/images/Thread04.png" alt=""></p><ul><li>ThreadPoolExecutorï¼šå¯¹äºä»»åŠ¡çš„æ‰§è¡Œæ˜¯ç«‹å³çš„ã€ä¸€æ¬¡æ€§çš„ã€‚</li><li>ScheduledThreadPoolExecutorï¼šä¸€ä¸ªç”¨æ¥æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡æˆ–è€…å‘¨æœŸæ€§ä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨å®ƒå¯ä»¥å¤„ç†å®šæ—¶è®¡ç®—ã€å‘¨æœŸæ€§ç»Ÿè®¡ä¸€ç±»çš„ä»»åŠ¡ã€‚</li><li>ForkJoinPoolï¼šScheduledThreadPoolExecutorå’ŒThreadPoolExecutoréƒ½æ˜¯åœ¨JDK1.5ç‰ˆæœ¬ä¸­æä¾›çš„ã€‚åœ¨JDK1.7ä¸­ï¼ŒJAVAä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æ–°çš„çº¿ç¨‹æ± ForkJoinPoolä»¥åŠé…å¥—çš„ä»»åŠ¡å®šä¹‰ForkJoinTaskã€‚é™¤äº†å¯ä»¥æ‰§è¡Œå®ç°äº†Runnableæ¥å£æˆ–è€…Callableæ¥å£çš„ä»»åŠ¡ä»¥å¤–ï¼ŒForkJoinPoolè¿˜å¯ä»¥æ‰§è¡Œé›†æˆäº†ForkJoinTaskå®šä¹‰çš„ä»»åŠ¡ã€‚ForkJoinPoolçš„æ‰§è¡ŒåŸç†å’ŒThreadPoolExecutorçš„æ‰§è¡ŒåŸç†æ˜¯ä¸ä¸€æ ·çš„</li></ul><h2 id="ThreadFactory"><a href="#ThreadFactory" class="headerlink" title="ThreadFactory"></a>ThreadFactory</h2><p>çº¿ç¨‹æ± æœ€ä¸»è¦çš„ä¸€é¡¹å·¥ä½œï¼Œå°±æ˜¯åœ¨æ»¡è¶³æŸäº›æ¡ä»¶çš„æƒ…å†µä¸‹åˆ›å»ºçº¿ç¨‹ã€‚è€Œåœ¨ThreadPoolExecutorçº¿ç¨‹æ± ä¸­ï¼Œåˆ›å»ºçº¿ç¨‹çš„å·¥ä½œäº¤ç»™ThreadFactoryæ¥å®Œæˆã€‚è¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå°±å¿…é¡»è¦æŒ‡å®šThreadFactoryã€‚</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ„é€ å‡½æ•°æ—¶å¹¶æ²¡æœ‰æŒ‡å®šä½¿ç”¨çš„ThreadFactoryï¼Œè¿™ä¸ªæ—¶å€™ThreadPoolExecutorä¼šä½¿ç”¨ä¸€ä¸ªé»˜è®¤çš„ThreadFactoryï¼šDefaultThreadFactoryã€‚ï¼ˆè¿™ä¸ªç±»åœ¨Executorså·¥å…·ç±»ä¸­ï¼‰</p><p><strong>Executorså·¥å…·ç±»å’ŒThreadPoolExecutorç±»å­˜åœ¨å¾ªç¯ä¾èµ–ï¼šThreadPoolExecutorä¸­ä½¿ç”¨äº†Executorså·¥å…·ç±»ä¸­å®šä¹‰çš„DefaultThreadFactoryï¼›è€Œåœ¨Executorså·¥å…·ç±»ä¸­å´åˆåœ¨åˆ›å»ºThreadPoolExecutorçš„å¯¹è±¡å®ä¾‹ã€‚</strong></p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://blog.csdn.net/column/details/yinwenjiethread.html" target="_blank" rel="noopener">å¤šçº¿ç¨‹åŸºç¡€</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;çº¿ç¨‹æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº§åˆ«çš„æ¦‚å¿µã€‚JAVAè¯­è¨€ï¼ˆåŒ…æ‹¬å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼‰æœ¬èº«ä¸åˆ›å»ºçº¿ç¨‹ï¼›è€Œæ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿå±‚æä¾›çš„æ¥å£åˆ›å»ºã€æ§åˆ¶ã€é”€æ¯çº¿ç¨‹å®ä¾‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å¤šçº¿ç¨‹" scheme="https://hsb786.github.io/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
    
      <category term="å¤šçº¿ç¨‹" scheme="https://hsb786.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>CAS</title>
    <link href="https://hsb786.github.io/2018/04/19/CAS/"/>
    <id>https://hsb786.github.io/2018/04/19/CAS/</id>
    <published>2018-04-19T09:41:51.000Z</published>
    <updated>2018-04-24T06:25:08.055Z</updated>
    
    <content type="html"><![CDATA[<p><strong>CASï¼ˆCompare And Swapï¼‰ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ¯”è¾ƒå’Œæ›¿æ¢ã€‚</strong></p><p><strong>CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚</strong></p><p><strong>æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹æˆBã€‚</strong></p><a id="more"></a><p>ä¸¾ä¸ªæ —å­ğŸ‚</p><ol><li>åœ¨å†…å­˜åœ°å€Vå½“ä¸­ï¼Œå­˜å‚¨ç€å€¼ä¸º10çš„å˜é‡ã€‚</li></ol><p><img src="/images/CAS01.png" alt=""></p><ol start="2"><li>æ­¤æ—¶çº¿ç¨‹1æƒ³è¦æŠŠå˜é‡çš„å€¼å¢åŠ 1ã€‚å¯¹çº¿ç¨‹1æ¥è¯´ï¼Œæ—§çš„é¢„æœŸå€¼A=10ï¼Œè¦ä¿®æ”¹çš„æ–°å€¼B=11ã€‚</li></ol><p><img src="/images/CAS02.png" alt=""></p><ol start="3"><li>åœ¨çº¿ç¨‹1è¦æäº¤æ›´æ–°ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹2æŠ¢å…ˆä¸€æ­¥ï¼ŒæŠŠå†…å­˜åœ°å€Vä¸­çš„å˜é‡å€¼ç‡å…ˆæ›´æ–°æˆäº†11</li></ol><p><img src="/images/CAS03.png" alt=""></p><ol start="4"><li>çº¿ç¨‹1å¼€å§‹æäº¤æ›´æ–°ï¼Œé¦–å…ˆè¿›è¡ŒAå’Œåœ°å€Vçš„å®é™…å€¼æ¯”è¾ƒï¼ˆCompareï¼‰ï¼Œå‘ç°Aä¸ç­‰äºVçš„å®é™…å€¼ï¼Œæäº¤å¤±è´¥ã€‚</li></ol><p><img src="/images/CAS04.png" alt=""></p><ol start="5"><li>çº¿ç¨‹1é‡æ–°è·å–å†…å­˜åœ°å€Vçš„å½“å‰å€¼ï¼Œå¹¶é‡æ–°è®¡ç®—æƒ³è¦ä¿®æ”¹çš„æ–°å€¼ã€‚æ­¤æ—¶å¯¹çº¿ç¨‹1æ¥è¯´ï¼ŒA=11ï¼ŒB=12ã€‚è¿™ä¸ªé‡æ–°å°è¯•çš„è¿‡ç¨‹è¢«ç§°ä¸ºè‡ªæ—‹ã€‚</li></ol><p><img src="/images/CAS05.png" alt=""></p><ol start="6"><li>è¿™ä¸€æ¬¡æ¯”è¾ƒå¹¸è¿ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜åœ°å€Vçš„å€¼ã€‚çº¿ç¨‹1è¿›è¡ŒCompareï¼Œå‘ç°Aå’Œåœ°å€Vçš„å®é™…å€¼æ˜¯ç›¸ç­‰çš„ã€‚</li></ol><p><img src="/images/CAS06.png" alt=""></p><ol start="7"><li>çº¿ç¨‹1è¿›è¡ŒSWAPï¼ŒæŠŠåœ°å€Vçš„å€¼æ›¿æ¢ä¸ºBï¼Œä¹Ÿå°±æ˜¯12ã€‚</li></ol><p><img src="/images/CAS07.png" alt=""></p><hr><h2 id="synchronizedä¸CAS"><a href="#synchronizedä¸CAS" class="headerlink" title="synchronizedä¸CAS"></a>synchronizedä¸CAS</h2><p><strong>synchronizedå…³é”®å­—ä¼šè®©æ²¡æœ‰å¾—åˆ°çº¿ç¨‹é”èµ„æºçš„çº¿ç¨‹è¿›å…¥BLOCKEDçŠ¶æ€ï¼Œè€Œååœ¨äº‰å¤ºåˆ°é”èµ„æºåæ¢å¤ä¸ºRUNNABLEçŠ¶æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼çš„åˆ‡æ¢ï¼Œä»£ä»·æ¯”è¾ƒé«˜ã€‚</strong></p><p>ä»æ€æƒ³ä¸Šæ¥è¯´ï¼ŒSynchronizedå±äºæ‚²è§‚é”ï¼Œæ‚²è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸¥é‡ï¼Œæ‰€ä»¥ä¸¥é˜²æ­»å®ˆã€‚CASå±äºä¹è§‚é”ï¼Œä¹è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸é‚£ä¹ˆä¸¥é‡ï¼Œæ‰€ä»¥è®©çº¿ç¨‹ä¸æ–­å»å°è¯•æ›´æ–°ã€‚</p><h2 id="åŸå­æ“ä½œç±»"><a href="#åŸå­æ“ä½œç±»" class="headerlink" title="åŸå­æ“ä½œç±»"></a>åŸå­æ“ä½œç±»</h2><p>æŒ‡çš„æ˜¯<code>java.util.concurrent.atomic</code>åŒ…ä¸‹ï¼Œä¸€ç³»åˆ—ä»¥Atomicå¼€å¤´çš„åŒ…è£…ç±»ã€‚ä¾‹å¦‚<code>AtomicBoolean</code>ï¼Œ<code>AtomicInteger</code>ï¼Œ<code>AtomicLong</code>ã€‚</p><h2 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private volatile int value;</span><br><span class="line">private static final Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line">private static final long valueOffset;</span><br><span class="line"></span><br><span class="line">static &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        valueOffset = unsafe.objectFieldOffset</span><br><span class="line">            (AtomicInteger.class.getDeclaredField(&quot;value&quot;));</span><br><span class="line">    &#125; catch (Exception ex) &#123; throw new Error(ex); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>unsafe</strong>ï¼šJavaè¯­è¨€ä¸åƒCï¼ŒC++é‚£æ ·å¯ä»¥ç›´æ¥è®¿é—®åº•å±‚æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯JVMä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåé—¨ï¼Œè¿™ä¸ªåé—¨å°±æ˜¯unsafeã€‚<strong>unsafeä¸ºæˆ‘ä»¬æä¾›äº†ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œã€‚</strong></p><p><strong>valueOffset</strong>ï¼šè‡³äºvalueOffsetå¯¹è±¡ï¼Œæ˜¯é€šè¿‡unsafe.objectFieldOffsetæ–¹æ³•å¾—åˆ°ï¼Œæ‰€ä»£è¡¨çš„æ˜¯AtomicIntegerå¯¹è±¡valueæˆå‘˜å˜é‡åœ¨å†…å­˜ä¸­çš„åç§»é‡ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŠŠvalueOffsetç†è§£ä¸ºvalueå˜é‡çš„å†…å­˜åœ°å€ã€‚</p><p>getAndIncrement ç›¸å½“äºi++ï¼Œå…ˆè¿”å›å€¼å†åŠ 1</p><p>åœ¨java7ä¸­æ˜¯è¿™æ ·å®ç°çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//AtomicInteger.class</span><br><span class="line">public final int getAndIncrement() &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int current = get();</span><br><span class="line">        int next = current + 1;</span><br><span class="line">        if (compareAndSet(current, next))</span><br><span class="line">            return current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public final boolean compareAndSet(int expect, int update) &#123;</span><br><span class="line">    return unsafe.compareAndSwapInt(this, valueOffset, expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>getAndIncrementæ–¹æ³•å†…éƒ¨ä¼šä¸åœçš„å¾ªç¯ï¼Œç›´åˆ°unsafe.comparAndSwapIntæ–¹æ³•æ‰§è¡ŒæˆåŠŸã€‚<br>valueOffsetç›¸å½“äºå‰é¢è®²çš„Vï¼Œexpectï¼šæ—§çš„é¢„æœŸå€¼Aï¼Œupdateï¼šæ–°çš„é¢„æœŸå€¼B</p><hr><p>java8ä¸­çš„å®ç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//AtomicInteger.class</span><br><span class="line">public final int getAndIncrement() &#123;</span><br><span class="line">    return unsafe.getAndAddInt(this, valueOffset, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><em>è¿™æ—¶éœ€è¦æŸ¥çœ‹Unsafeçš„æºç ï¼Œå¯ä»¥ä¸‹è½½openjdkï¼Œopenjdkä¸­æœ‰å…³äº<code>sun.misc</code>åŒ…ä¸­çš„æºç </em>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¯¼è‡´è·Ÿä»£ç çš„æ—¶å€™ä¼šä¸å‡†ç¡®ã€‚è€Œä¸”æˆ‘å‘ç°åŒæ ·æ˜¯java8ï¼Œä»£ç è¿˜æœ‰äº›ä¸ä¸€æ ·ï¼Œå¯èƒ½æ˜¯java8çš„ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//Unsafe.class</span><br><span class="line">public final int getAndAddInt(Object o, long offset, int delta) &#123;</span><br><span class="line">    int v;</span><br><span class="line">    do &#123;</span><br><span class="line">        v = getIntVolatile(o, offset);</span><br><span class="line">    &#125; while (!compareAndSwapInt(o, offset, v, v + delta));</span><br><span class="line">    return v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public native int     getIntVolatile(Object o, long offset);</span><br><span class="line"></span><br><span class="line">public final native boolean compareAndSwapInt(Object o, long offset,</span><br><span class="line">                                                  int expected,</span><br><span class="line">                                                  int x);</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰è·Ÿjdk7å·®ä¸å¤šï¼Œåªæ˜¯æŠŠè‡ªæ—‹éƒ¨åˆ†çš„ä»£ç ä»AtomicIntegerç§»åŠ¨åˆ°äº†Unsafeä¸­ã€‚</p><p>Javaè¯­è¨€CASåº•å±‚å°±æ˜¯åˆ©ç”¨unsafeæä¾›çš„åŸå­æ€§æ“ä½œæ–¹æ³•æ¥å®ç°çš„ã€‚</p><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p><strong>1. CPUå¼€é”€è¾ƒå¤§</strong></p><p>åœ¨å¹¶å‘é‡æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¸å¤šçº¿ç¨‹åå¤å°è¯•æ›´æ–°æŸä¸€ä¸ªå˜é‡ï¼Œå´åˆä¸€ç›´æ›´æ–°ä¸æˆåŠŸï¼Œå¾ªç¯å¾€å¤ï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</p><p><strong>2. ä¸èƒ½ä¿è¯ä»£ç å—çš„åŸå­æ€§</strong></p><p>CASæœºåˆ¶æ‰€ä¿è¯çš„åªæ˜¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œè€Œä¸èƒ½ä¿è¯æ•´ä¸ªä»£ç å—çš„åŸå­æ€§ã€‚æ¯”å¦‚éœ€è¦ä¿è¯3ä¸ªå˜é‡å…±åŒè¿›è¡ŒåŸå­æ€§çš„æ›´æ–°ï¼Œå°±ä¸å¾—ä¸ä½¿ç”¨Synchronizedäº†ã€‚</p><p><strong>3. ABAé—®é¢˜</strong></p><p>å½“ä¸€ä¸ªå€¼ä»Aæ›´æ–°æˆBï¼Œåˆæ›´æ–°ä¼šAï¼Œæ™®é€šCASæœºåˆ¶ä¼šè¯¯åˆ¤é€šè¿‡æ£€æµ‹ã€‚åˆ©ç”¨ç‰ˆæœ¬å·æ¯”è¾ƒå¯ä»¥æœ‰æ•ˆè§£å†³ABAé—®é¢˜ã€‚</p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="http://mp.weixin.qq.com/s/f9PYMnpAgS1gAQYPDuCq-w" target="_blank" rel="noopener">æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯CASæœºåˆ¶ï¼Ÿ</a></p><p><a href="http://mp.weixin.qq.com/s/nRnQKhiSUrDKu3mz3vItWg" target="_blank" rel="noopener">æ¼«ç”»ï¼šä»€ä¹ˆæ˜¯CASæœºåˆ¶ï¼Ÿï¼ˆè¿›é˜¶ç¯‡ï¼‰</a></p><p><a href="https://blog.csdn.net/yinwenjie/article/details/72909981" target="_blank" rel="noopener">çº¿ç¨‹è¿›é˜¶ï¼šå¤šä»»åŠ¡å¤„ç†ï¼ˆ17ï¼‰â€”â€”Javaä¸­çš„é”ï¼ˆUnsafeåŸºç¡€ï¼‰ </a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;CASï¼ˆCompare And Swapï¼‰ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯æ¯”è¾ƒå’Œæ›¿æ¢ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹æˆBã€‚&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/categories/%E7%88%AA%E5%93%87/"/>
    
    
      <category term="çˆªå“‡" scheme="https://hsb786.github.io/tags/%E7%88%AA%E5%93%87/"/>
    
  </entry>
  
  <entry>
    <title>RESTful</title>
    <link href="https://hsb786.github.io/2018/04/18/RESTful/"/>
    <id>https://hsb786.github.io/2018/04/18/RESTful/</id>
    <published>2018-04-18T05:37:06.000Z</published>
    <updated>2018-04-24T06:26:40.095Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h2><p>RESTè¿™ä¸ªè¯ï¼Œæ˜¯Roy Thomas Fieldingåœ¨ä»–2000å¹´çš„åšå£«è®ºæ–‡ä¸­æå‡ºçš„ã€‚Fieldingæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äººï¼Œä»–æ˜¯HTTPåè®®ï¼ˆ1.0ç‰ˆå’Œ1.1ç‰ˆï¼‰çš„ä¸»è¦è®¾è®¡è€…ã€ApacheæœåŠ¡å™¨è½¯ä»¶çš„ä½œè€…ä¹‹ä¸€ã€ApacheåŸºé‡‘ä¼šçš„ç¬¬ä¸€ä»»ä¸»å¸­ã€‚æ‰€ä»¥ï¼Œä»–çš„è¿™ç¯‡è®ºæ–‡ä¸€ç»å‘è¡¨ï¼Œå°±å¼•èµ·äº†å…³æ³¨ï¼Œå¹¶ä¸”ç«‹å³å¯¹äº’è”ç½‘å¼€å‘äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚</p><p>ä»–åœ¨è®ºæ–‡ä¸­æåˆ°ï¼š</p><blockquote><p>â€œæœ¬æ–‡ç ”ç©¶è®¡ç®—æœºç§‘å­¦ä¸¤å¤§å‰æ²¿â€”-è½¯ä»¶å’Œç½‘ç»œâ€”-çš„äº¤å‰ç‚¹ã€‚é•¿æœŸä»¥æ¥ï¼Œè½¯ä»¶ç ”ç©¶ä¸»è¦å…³æ³¨è½¯ä»¶è®¾è®¡çš„åˆ†ç±»ã€è®¾è®¡æ–¹æ³•çš„æ¼”åŒ–ï¼Œå¾ˆå°‘å®¢è§‚åœ°è¯„ä¼°ä¸åŒçš„è®¾è®¡é€‰æ‹©å¯¹ç³»ç»Ÿè¡Œä¸ºçš„å½±å“ã€‚è€Œç›¸ååœ°ï¼Œç½‘ç»œç ”ç©¶ä¸»è¦å…³æ³¨ç³»ç»Ÿä¹‹é—´é€šä¿¡è¡Œä¸ºçš„ç»†èŠ‚ã€å¦‚ä½•æ”¹è¿›ç‰¹å®šé€šä¿¡æœºåˆ¶çš„è¡¨ç°ï¼Œå¸¸å¸¸å¿½è§†äº†ä¸€ä¸ªäº‹å®ï¼Œé‚£å°±æ˜¯æ”¹å˜åº”ç”¨ç¨‹åºçš„äº’åŠ¨é£æ ¼æ¯”æ”¹å˜äº’åŠ¨åè®®ï¼Œå¯¹æ•´ä½“è¡¨ç°æœ‰æ›´å¤§çš„å½±å“ã€‚æˆ‘è¿™ç¯‡æ–‡ç« çš„å†™ä½œç›®çš„ï¼Œå°±æ˜¯æƒ³åœ¨ç¬¦åˆæ¶æ„åŸç†çš„å‰æä¸‹ï¼Œç†è§£å’Œè¯„ä¼°ä»¥ç½‘ç»œä¸ºåŸºç¡€çš„åº”ç”¨è½¯ä»¶çš„æ¶æ„è®¾è®¡ï¼Œå¾—åˆ°ä¸€ä¸ªåŠŸèƒ½å¼ºã€æ€§èƒ½å¥½ã€é€‚å®œé€šä¿¡çš„æ¶æ„ã€‚â€<br><a id="more"></a></p></blockquote><h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><p>Fieldingå°†ä»–å¯¹äº’è”ç½‘è½¯ä»¶çš„æ¶æ„åŸåˆ™ï¼Œå®šåä¸ºRESTï¼Œå³Representational State Transferï¼ˆè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–ï¼‰çš„ç¼©å†™ã€‚</p><p>å¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆRESTåŸåˆ™ï¼Œå°±ç§°å®ƒä¸ºRESTfulæ¶æ„ã€‚</p><h2 id="èµ„æºï¼ˆResourcesï¼‰"><a href="#èµ„æºï¼ˆResourcesï¼‰" class="headerlink" title="èµ„æºï¼ˆResourcesï¼‰"></a>èµ„æºï¼ˆResourcesï¼‰</h2><p>RESTçš„åç§°â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ä¸­ï¼Œçœç•¥äº†ä¸»è¯­ã€‚â€è¡¨ç°å±‚â€å…¶å®æŒ‡çš„æ˜¯â€èµ„æºâ€ï¼ˆResourcesï¼‰çš„â€è¡¨ç°å±‚â€ã€‚</p><p><strong>æ‰€è°“â€èµ„æºâ€ï¼Œå°±æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå®ä½“ï¼Œæˆ–è€…è¯´æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå…·ä½“ä¿¡æ¯</strong>ã€‚å®ƒå¯ä»¥æ˜¯ä¸€æ®µæ–‡æœ¬ã€ä¸€å¼ å›¾ç‰‡ã€ä¸€é¦–æ­Œæ›²ã€ä¸€ç§æœåŠ¡ï¼Œæ€»ä¹‹å°±æ˜¯ä¸€ä¸ªå…·ä½“çš„å®åœ¨ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªURIï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰æŒ‡å‘å®ƒï¼Œæ¯ç§èµ„æºå¯¹åº”ä¸€ä¸ªç‰¹å®šçš„URIã€‚è¦è·å–è¿™ä¸ªèµ„æºï¼Œè®¿é—®å®ƒçš„URIå°±å¯ä»¥ï¼Œå› æ­¤URIå°±æˆäº†æ¯ä¸€ä¸ªèµ„æºçš„åœ°å€æˆ–ç‹¬ä¸€æ— äºŒçš„è¯†åˆ«ç¬¦ã€‚</p><p>æ‰€è°“â€ä¸Šç½‘â€ï¼Œå°±æ˜¯ä¸äº’è”ç½‘ä¸Šä¸€ç³»åˆ—çš„â€èµ„æºâ€äº’åŠ¨ï¼Œè°ƒç”¨å®ƒçš„URIã€‚</p><h2 id="è¡¨ç°å±‚ï¼ˆRepresentationï¼‰"><a href="#è¡¨ç°å±‚ï¼ˆRepresentationï¼‰" class="headerlink" title="è¡¨ç°å±‚ï¼ˆRepresentationï¼‰"></a>è¡¨ç°å±‚ï¼ˆRepresentationï¼‰</h2><p>â€œèµ„æºâ€æ˜¯ä¸€ç§ä¿¡æ¯å®ä½“ï¼Œå®ƒå¯ä»¥æœ‰å¤šç§å¤–åœ¨è¡¨ç°å½¢å¼ã€‚<strong>æˆ‘ä»¬æŠŠâ€èµ„æºâ€å…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼ï¼Œå«åšå®ƒçš„â€è¡¨ç°å±‚â€ï¼ˆRepresentationï¼‰</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œæ–‡æœ¬å¯ä»¥ç”¨txtæ ¼å¼è¡¨ç°ï¼Œä¹Ÿå¯ä»¥ç”¨HTMLæ ¼å¼ã€XMLæ ¼å¼ã€JSONæ ¼å¼è¡¨ç°ï¼Œç”šè‡³å¯ä»¥é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼›å›¾ç‰‡å¯ä»¥ç”¨JPGæ ¼å¼è¡¨ç°ï¼Œä¹Ÿå¯ä»¥ç”¨PNGæ ¼å¼è¡¨ç°ã€‚</p><p>URIåªä»£è¡¨èµ„æºçš„å®ä½“ï¼Œä¸ä»£è¡¨å®ƒçš„å½¢å¼ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œæœ‰äº›ç½‘å€æœ€åçš„â€.htmlâ€åç¼€åæ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºè¿™ä¸ªåç¼€åè¡¨ç¤ºæ ¼å¼ï¼Œå±äºâ€è¡¨ç°å±‚â€èŒƒç•´ï¼Œè€ŒURIåº”è¯¥åªä»£è¡¨â€èµ„æºâ€çš„ä½ç½®ã€‚å®ƒçš„å…·ä½“è¡¨ç°å½¢å¼ï¼Œåº”è¯¥åœ¨HTTPè¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ç”¨Acceptå’ŒContent-Typeå­—æ®µæŒ‡å®šï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ‰æ˜¯å¯¹â€è¡¨ç°å±‚â€çš„æè¿°ã€‚</p><h2 id="çŠ¶æ€è½¬åŒ–ï¼ˆState-Transferï¼‰"><a href="#çŠ¶æ€è½¬åŒ–ï¼ˆState-Transferï¼‰" class="headerlink" title="çŠ¶æ€è½¬åŒ–ï¼ˆState Transferï¼‰"></a>çŠ¶æ€è½¬åŒ–ï¼ˆState Transferï¼‰</h2><p>è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œå°±ä»£è¡¨äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ä¸€ä¸ªäº’åŠ¨è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°æ•°æ®å’ŒçŠ¶æ€çš„å˜åŒ–ã€‚</p><p>äº’è”ç½‘é€šä¿¡åè®®HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚å› æ­¤ï¼Œ<strong>å¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ“ä½œæœåŠ¡å™¨ï¼Œå¿…é¡»é€šè¿‡æŸç§æ‰‹æ®µï¼Œè®©æœåŠ¡å™¨ç«¯å‘ç”Ÿâ€çŠ¶æ€è½¬åŒ–â€ï¼ˆState Transferï¼‰ã€‚è€Œè¿™ç§è½¬åŒ–æ˜¯å»ºç«‹åœ¨è¡¨ç°å±‚ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å°±æ˜¯â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚</strong></p><hr><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><h3 id="HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€"><a href="#HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€" class="headerlink" title="HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€"></a>HTTPåè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€</h3><h4 id="å›ç­”1"><a href="#å›ç­”1" class="headerlink" title="å›ç­”1"></a>å›ç­”1</h4><p>æœ‰çŠ¶æ€ï¼š<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å•¥ï¼Ÿ<br>Bï¼šåƒçš„å¤§ç›˜é¸¡ã€‚<br>Aï¼šå‘³é“æ€ä¹ˆæ ·å‘€ï¼Ÿ<br>Bï¼šè¿˜ä¸é”™ï¼ŒæŒºå¥½åƒçš„ã€‚  </p><p>æ— çŠ¶æ€ï¼š<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å•¥ï¼Ÿ<br>Bï¼šåƒçš„å¤§ç›˜é¸¡ã€‚<br>Aï¼šå‘³é“æ€ä¹ˆæ ·å‘€ï¼Ÿ<br>Bï¼šï¼Ÿï¼Ÿï¼Ÿå•Šï¼Ÿå•¥ï¼Ÿå•¥å‘³é“æ€ä¹ˆæ ·ï¼Ÿ</p><p>æ‰€ä»¥éœ€è¦cookieè¿™ç§ä¸œè¥¿ï¼š<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å•¥ï¼Ÿ<br>Bï¼šåƒçš„å¤§ç›˜é¸¡ã€‚<br>Aï¼šä½ ä»Šå¤©ä¸­åˆåƒçš„å¤§ç›˜é¸¡å‘³é“æ€ä¹ˆæ ·å‘€ï¼Ÿ<br>Bï¼šè¿˜ä¸é”™ï¼ŒæŒºå¥½åƒçš„ã€‚</p><h4 id="å›ç­”2"><a href="#å›ç­”2" class="headerlink" title="å›ç­”2"></a>å›ç­”2</h4><ul><li>åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›</li><li>å¯¹åŒä¸€ä¸ªurlè¯·æ±‚æ²¡æœ‰ä¸Šä¸‹æ–‡å…³ç³»</li><li>æ¯æ¬¡çš„è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå®ƒçš„æ‰§è¡Œæƒ…å†µå’Œç»“æœä¸å‰é¢çš„è¯·æ±‚å’Œä¹‹åçš„è¯·æ±‚æ˜¯æ— ç›´æ¥å…³ç³»çš„ï¼Œå®ƒä¸ä¼šå—å‰é¢çš„è¯·æ±‚åº”ç­”æƒ…å†µç›´æ¥å½±å“ï¼Œä¹Ÿä¸ä¼šç›´æ¥å½±å“åé¢çš„è¯·æ±‚åº”ç­”æƒ…å†µ</li><li>æœåŠ¡å™¨ä¸­æ²¡æœ‰ä¿å­˜å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ¯æ¬¡å¸¦ä¸Šè‡ªå·±çš„çŠ¶æ€å»è¯·æ±‚æœåŠ¡å™¨</li><li>äººç”Ÿè‹¥åªå¦‚åˆè§</li></ul><p>ã€çŠ¶æ€ã€‘çš„å«ä¹‰å°±æ˜¯ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨æŸæ¬¡ä¼šè¯ä¸­äº§ç”Ÿçš„æ•°æ®ï¼Œä»è€Œã€æ— çŠ¶æ€ã€‘å°±æ„å‘³ç€ï¼Œè¿™äº›æ•°æ®ä¸ä¼šè¢«ä¿ç•™</p><p>ä½†æ˜¯ï¼š</p><ul><li>é€šè¿‡å¢åŠ cookieå’Œsessionæœºåˆ¶ï¼Œç°åœ¨çš„ç½‘ç»œè¯·æ±‚å…¶å®æ˜¯æœ‰çŠ¶æ€çš„</li><li>åœ¨æ²¡æœ‰çŠ¶æ€çš„httpåè®®ä¸‹ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸€å®šä¼šä¿ç•™ä½ æ¯æ¬¡ç½‘ç»œè¯·æ±‚å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œä½†è¿™è·Ÿä¿ç•™æ¯æ¬¡è®¿é—®çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¿ç•™çš„åªæ˜¯ä¼šè¯äº§ç”Ÿçš„ç»“æœï¼Œè€Œæ²¡æœ‰ä¿ç•™ä¼šè¯</li></ul><h2 id="è·¯å¾„ï¼ˆEndpointï¼‰"><a href="#è·¯å¾„ï¼ˆEndpointï¼‰" class="headerlink" title="è·¯å¾„ï¼ˆEndpointï¼‰"></a>è·¯å¾„ï¼ˆEndpointï¼‰</h2><p>è·¯å¾„åˆç§°â€ç»ˆç‚¹â€ï¼ˆendpointï¼‰ï¼Œè¡¨ç¤ºAPIçš„å…·ä½“ç½‘å€ã€‚</p><p><strong>åœ¨RESTfulæ¶æ„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„â€é›†åˆâ€ï¼ˆcollectionï¼‰ï¼Œæ‰€ä»¥APIä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚</strong></p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªAPIæä¾›åŠ¨ç‰©å›­ï¼ˆzooï¼‰çš„ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬å„ç§åŠ¨ç‰©å’Œé›‡å‘˜çš„ä¿¡æ¯ï¼Œåˆ™å®ƒçš„è·¯å¾„åº”è¯¥è®¾è®¡æˆä¸‹é¢è¿™æ ·ã€‚</p><ul><li><a href="https://api.example.com/v1/zoos" target="_blank" rel="noopener">https://api.example.com/v1/zoos</a></li><li><a href="https://api.example.com/v1/animals" target="_blank" rel="noopener">https://api.example.com/v1/animals</a></li><li><a href="https://api.example.com/v1/employees" target="_blank" rel="noopener">https://api.example.com/v1/employees</a></li></ul><h2 id="HTTPåŠ¨è¯"><a href="#HTTPåŠ¨è¯" class="headerlink" title="HTTPåŠ¨è¯"></a>HTTPåŠ¨è¯</h2><p>å¯¹äºèµ„æºçš„å…·ä½“æ“ä½œç±»å‹ï¼Œç”±HTTPåŠ¨è¯è¡¨ç¤ºã€‚</p><p>å¸¸ç”¨çš„HTTPåŠ¨è¯æœ‰ä¸‹é¢äº”ä¸ªï¼ˆæ‹¬å·é‡Œæ˜¯å¯¹åº”çš„SQLå‘½ä»¤ï¼‰ã€‚</p><ul><li>GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰ã€‚</li><li>POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚</li><li>PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚</li><li>PATCHï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰ã€‚</li><li>DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚</li></ul><p>ä¾‹å­</p><ul><li>GET /zoosï¼šåˆ—å‡ºæ‰€æœ‰åŠ¨ç‰©å›­</li><li>POST /zoosï¼šæ–°å»ºä¸€ä¸ªåŠ¨ç‰©å›­</li><li>GET /zoos/IDï¼šè·å–æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯</li><li>PUT /zoos/IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„å…¨éƒ¨ä¿¡æ¯ï¼‰</li><li>PATCH /zoos/IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰</li><li>DELETE /zoos/IDï¼šåˆ é™¤æŸä¸ªåŠ¨ç‰©å›­</li><li>GET /zoos/ID/animalsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æ‰€æœ‰åŠ¨ç‰©</li><li>DELETE /zoos/ID/animals/IDï¼šåˆ é™¤æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æŒ‡å®šåŠ¨ç‰©</li></ul><h2 id="è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰"><a href="#è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰" class="headerlink" title="è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰"></a>è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰</h2><p>å¦‚æœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·ã€‚APIåº”è¯¥æä¾›å‚æ•°ï¼Œè¿‡æ»¤è¿”å›ç»“æœã€‚</p><ul><li>?limit=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡</li><li>?offset=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®ã€‚</li><li>?page=2&amp;per_page=100ï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°ã€‚</li><li>?sortby=name&amp;order=ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåºã€‚</li><li>?animal_type_id=1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶</li></ul><h2 id="çŠ¶æ€ç ï¼ˆStatus-Codesï¼‰"><a href="#çŠ¶æ€ç ï¼ˆStatus-Codesï¼‰" class="headerlink" title="çŠ¶æ€ç ï¼ˆStatus Codesï¼‰"></a>çŠ¶æ€ç ï¼ˆStatus Codesï¼‰</h2><p>æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„çŠ¶æ€ç å’Œæç¤ºä¿¡æ¯ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹ä¸€äº›ï¼ˆæ–¹æ‹¬å·ä¸­æ˜¯è¯¥çŠ¶æ€ç å¯¹åº”çš„HTTPåŠ¨è¯ï¼‰ã€‚</p><ul><li>200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ˆIdempotentï¼‰ã€‚</li><li>201 CREATED - [POST/PUT/PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚</li><li>202 Accepted - [*]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</li><li>204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚</li><li>400 INVALID REQUEST - [POST/PUT/PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</li><li>401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚</li><li>403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚</li><li>404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</li><li>406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚</li><li>410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚</li><li>422 Unprocesable entity - [POST/PUT/PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚</li><li>500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚</li></ul><h2 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ"></a>è¿”å›ç»“æœ</h2><p>é’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒã€‚</p><ul><li>GET /collectionï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰</li><li>GET /collection/resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡</li><li>POST /collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡</li><li>PUT /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</li><li>PATCH /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</li><li>DELETE /collection/resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>æ¯ä¸€ä¸ªURIä»£è¡¨ä¸€ç§èµ„æºï¼›</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¼ é€’è¿™ç§èµ„æºçš„æŸç§è¡¨ç°å±‚ï¼›</li><li>å®¢æˆ·ç«¯é€šè¿‡HTTPåŠ¨è¯ï¼Œå¯¹æœåŠ¡å™¨ç«¯èµ„æºè¿›è¡Œæ“ä½œï¼Œå®ç°â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚</li></ul><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="http://www.ruanyifeng.com/blog/2011/09/restful.html" target="_blank" rel="noopener">ç†è§£RESTfulæ¶æ„</a></p><p><a href="https://www.zhihu.com/question/23202402" target="_blank" rel="noopener">HTTPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ã€‚è¿™å¥è¯é‡Œçš„æ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</a></p><p><a href="http://www.cnblogs.com/bellkosmos/p/5237146.html" target="_blank" rel="noopener">httpåè®®æ— çŠ¶æ€ä¸­çš„ â€œçŠ¶æ€â€ åˆ°åº•æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼</a></p><p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api" target="_blank" rel="noopener">RESTful API è®¾è®¡æŒ‡å—</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èµ·æº&quot;&gt;&lt;a href=&quot;#èµ·æº&quot; class=&quot;headerlink&quot; title=&quot;èµ·æº&quot;&gt;&lt;/a&gt;èµ·æº&lt;/h2&gt;&lt;p&gt;RESTè¿™ä¸ªè¯ï¼Œæ˜¯Roy Thomas Fieldingåœ¨ä»–2000å¹´çš„åšå£«è®ºæ–‡ä¸­æå‡ºçš„ã€‚Fieldingæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äººï¼Œä»–æ˜¯HTTPåè®®ï¼ˆ1.0ç‰ˆå’Œ1.1ç‰ˆï¼‰çš„ä¸»è¦è®¾è®¡è€…ã€ApacheæœåŠ¡å™¨è½¯ä»¶çš„ä½œè€…ä¹‹ä¸€ã€ApacheåŸºé‡‘ä¼šçš„ç¬¬ä¸€ä»»ä¸»å¸­ã€‚æ‰€ä»¥ï¼Œä»–çš„è¿™ç¯‡è®ºæ–‡ä¸€ç»å‘è¡¨ï¼Œå°±å¼•èµ·äº†å…³æ³¨ï¼Œå¹¶ä¸”ç«‹å³å¯¹äº’è”ç½‘å¼€å‘äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä»–åœ¨è®ºæ–‡ä¸­æåˆ°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæœ¬æ–‡ç ”ç©¶è®¡ç®—æœºç§‘å­¦ä¸¤å¤§å‰æ²¿â€”-è½¯ä»¶å’Œç½‘ç»œâ€”-çš„äº¤å‰ç‚¹ã€‚é•¿æœŸä»¥æ¥ï¼Œè½¯ä»¶ç ”ç©¶ä¸»è¦å…³æ³¨è½¯ä»¶è®¾è®¡çš„åˆ†ç±»ã€è®¾è®¡æ–¹æ³•çš„æ¼”åŒ–ï¼Œå¾ˆå°‘å®¢è§‚åœ°è¯„ä¼°ä¸åŒçš„è®¾è®¡é€‰æ‹©å¯¹ç³»ç»Ÿè¡Œä¸ºçš„å½±å“ã€‚è€Œç›¸ååœ°ï¼Œç½‘ç»œç ”ç©¶ä¸»è¦å…³æ³¨ç³»ç»Ÿä¹‹é—´é€šä¿¡è¡Œä¸ºçš„ç»†èŠ‚ã€å¦‚ä½•æ”¹è¿›ç‰¹å®šé€šä¿¡æœºåˆ¶çš„è¡¨ç°ï¼Œå¸¸å¸¸å¿½è§†äº†ä¸€ä¸ªäº‹å®ï¼Œé‚£å°±æ˜¯æ”¹å˜åº”ç”¨ç¨‹åºçš„äº’åŠ¨é£æ ¼æ¯”æ”¹å˜äº’åŠ¨åè®®ï¼Œå¯¹æ•´ä½“è¡¨ç°æœ‰æ›´å¤§çš„å½±å“ã€‚æˆ‘è¿™ç¯‡æ–‡ç« çš„å†™ä½œç›®çš„ï¼Œå°±æ˜¯æƒ³åœ¨ç¬¦åˆæ¶æ„åŸç†çš„å‰æä¸‹ï¼Œç†è§£å’Œè¯„ä¼°ä»¥ç½‘ç»œä¸ºåŸºç¡€çš„åº”ç”¨è½¯ä»¶çš„æ¶æ„è®¾è®¡ï¼Œå¾—åˆ°ä¸€ä¸ªåŠŸèƒ½å¼ºã€æ€§èƒ½å¥½ã€é€‚å®œé€šä¿¡çš„æ¶æ„ã€‚â€&lt;br&gt;
    
    </summary>
    
      <category term="HTTP" scheme="https://hsb786.github.io/categories/HTTP/"/>
    
    
      <category term="HTTP" scheme="https://hsb786.github.io/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>åŸºæœ¬æ’åºç®—æ³•</title>
    <link href="https://hsb786.github.io/2018/04/18/%E5%9F%BA%E6%9C%AC%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
    <id>https://hsb786.github.io/2018/04/18/åŸºæœ¬æ’åºç®—æ³•/</id>
    <published>2018-04-18T04:27:50.000Z</published>
    <updated>2018-04-20T13:21:43.798Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><p>åŸºæœ¬æ€æƒ³ï¼š<strong>é€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—</strong><br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">static void quickSort(int[] array) &#123;</span><br><span class="line">    quickSort(array, 0, array.length - 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void quickSort(int[] array, int left, int right) &#123;</span><br><span class="line">    if (left &gt;= right) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    int mid = partion(array, left, right);</span><br><span class="line">    quickSort(array, left, mid - 1);</span><br><span class="line">    quickSort(array, mid + 1, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int partion(int[] array, int left, int right) &#123;</span><br><span class="line">    // å–ç¬¬ä¸€ä¸ªæ•°ä¸ºåŸºå‡†å…ƒç´ </span><br><span class="line">    int tmp = array[left];</span><br><span class="line">    while (left &lt; right) &#123;</span><br><span class="line">        while (left &lt; right &amp;&amp; array[right] &gt;= tmp) &#123;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        // æ¯”åŸºå‡†å…ƒç´ å°çš„ç§»åŠ¨åˆ°ä½ç«¯</span><br><span class="line">        array[left] = array[right];</span><br><span class="line">        while (left &lt; right &amp;&amp; array[left] &lt;= tmp) &#123;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        // æ¯”åŸºå‡†å…ƒç´ å¤§çš„ç§»åŠ¨åˆ°é«˜ç«¯</span><br><span class="line">        array[right] = array[left];</span><br><span class="line">    &#125;</span><br><span class="line">    // æ’å…¥åŸºå‡†å…ƒç´ </span><br><span class="line">    array[left] = tmp;</span><br><span class="line">    return left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><p>åŸºæœ¬æ€æƒ³ï¼š<strong>å½’å¹¶æ’åºï¼ˆMERGE-SORTï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•,è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚å°†å·²æœ‰åºçš„å­åºåˆ—åˆå¹¶ï¼Œå¾—åˆ°å®Œå…¨æœ‰åºçš„åºåˆ—</strong></p><p><img src="/images/sort-merge.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">static void mergeSort(int[] arr) &#123;</span><br><span class="line">int[] temp = new int[arr.length];</span><br><span class="line">mergeSort(arr, 0, arr.length - 1, temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void mergeSort(int[] arr, int left, int right, int[] temp) &#123;</span><br><span class="line">if (left &lt; right) &#123;</span><br><span class="line">int mid = (left + right) / 2;</span><br><span class="line">mergeSort(arr, left, mid, temp);// å·¦è¾¹å½’å¹¶æ’åºï¼Œä½¿å¾—å·¦å­åºåˆ—æœ‰åº</span><br><span class="line">mergeSort(arr, mid + 1, right, temp);// å³è¾¹å½’å¹¶æ’åºï¼Œä½¿å¾—å³å­åºåˆ—æœ‰åº</span><br><span class="line">merge(arr, left, mid, right, temp);// å°†ä¸¤ä¸ªæœ‰åºå­æ•°ç»„åˆå¹¶æ“ä½œ</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void merge(int[] arr, int left, int mid, int right, int[] temp) &#123;</span><br><span class="line">int i = left;// å·¦åºåˆ—æŒ‡é’ˆ</span><br><span class="line">int j = mid + 1;// å³åºåˆ—æŒ‡é’ˆ</span><br><span class="line">int t = 0;// ä¸´æ—¶æ•°ç»„æŒ‡é’ˆ</span><br><span class="line">while (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line">if (arr[i] &lt;= arr[j]) &#123;</span><br><span class="line">temp[t++] = arr[i++];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">temp[t++] = arr[j++];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">while (i &lt;= mid) &#123;// å°†å·¦è¾¹å‰©ä½™å…ƒç´ å¡«å……è¿›tempä¸­</span><br><span class="line">temp[t++] = arr[i++];</span><br><span class="line">&#125;</span><br><span class="line">while (j &lt;= right) &#123;// å°†å³åºåˆ—å‰©ä½™å…ƒç´ å¡«å……è¿›tempä¸­</span><br><span class="line">temp[t++] = arr[j++];</span><br><span class="line">&#125;</span><br><span class="line">t = 0;</span><br><span class="line">// å°†tempä¸­çš„å…ƒç´ å…¨éƒ¨æ‹·è´åˆ°åŸæ•°ç»„ä¸­</span><br><span class="line">while (left &lt;= right) &#123;</span><br><span class="line">arr[left++] = temp[t++];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¿«é€Ÿæ’åº&quot;&gt;&lt;a href=&quot;#å¿«é€Ÿæ’åº&quot; class=&quot;headerlink&quot; title=&quot;å¿«é€Ÿæ’åº&quot;&gt;&lt;/a&gt;å¿«é€Ÿæ’åº&lt;/h2&gt;&lt;p&gt;åŸºæœ¬æ€æƒ³ï¼š&lt;strong&gt;é€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://hsb786.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="https://hsb786.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç†æ¨¡å¼</title>
    <link href="https://hsb786.github.io/2018/04/17/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    <id>https://hsb786.github.io/2018/04/17/ä»£ç†æ¨¡å¼/</id>
    <published>2018-04-17T10:21:28.000Z</published>
    <updated>2018-04-20T13:20:26.051Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®<br><a id="more"></a><br><img src="/images/design-pattern-proxy.png" alt=""></p></blockquote><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li><p>ä»£ç†å¯¹è±¡å¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡å®ç°çš„åŸºç¡€ä¸Š,å¢å¼ºé¢å¤–çš„åŠŸèƒ½æ“ä½œ,å³æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼Œç¬¦åˆå¼€é—­åŸåˆ™</p></li><li><p>ä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ï¼Œè¿™æ ·èµ·åˆ°äº†ä¸­ä»‹çš„ä½œç”¨å’Œä¿æŠ¤äº†ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚</p></li></ul><h2 id="ä»£ç†ç±»åˆ†ç±»"><a href="#ä»£ç†ç±»åˆ†ç±»" class="headerlink" title="ä»£ç†ç±»åˆ†ç±»"></a>ä»£ç†ç±»åˆ†ç±»</h2><ul><li><p>é™æ€ä»£ç†:é™æ€å®šä¹‰ä»£ç†ç±»ï¼Œæˆ‘ä»¬è‡ªå·±é™æ€å®šä¹‰çš„ä»£ç†ç±»ã€‚</p></li><li><p>åŠ¨æ€ä»£ç†:é€šè¿‡ç¨‹åºåŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œè¯¥ä»£ç†ç±»ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œè€Œæ˜¯ç”±ç¨‹åºè‡ªåŠ¨ç”Ÿæˆï¼Œå¸¸ç”¨çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æœ‰JDKè‡ªå¸¦çš„åŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ã€‚</p></li></ul><hr><p>*å‚è€ƒ</p><blockquote><p><a href="https://lujunqiu.github.io/2017/11/30/ä»£ç†æ¨¡å¼/" target="_blank" rel="noopener">ä»£ç†æ¨¡å¼</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®&lt;br&gt;
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç­–ç•¥æ¨¡å¼</title>
    <link href="https://hsb786.github.io/2018/04/17/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/"/>
    <id>https://hsb786.github.io/2018/04/17/ç­–ç•¥æ¨¡å¼/</id>
    <published>2018-04-17T10:07:27.000Z</published>
    <updated>2018-04-20T13:20:07.750Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç­–ç•¥æ¨¡å¼(Strategy Pattern)ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ï¼Œä¹Ÿç§°ä¸ºæ”¿ç­–æ¨¡å¼(Policy)ã€‚</p></blockquote><p>æ ¹æ®æ¡ä»¶çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ç­–ç•¥<br><a id="more"></a></p><p><img src="/images/design-pattern-strategy01.png" alt=""></p><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ol><li>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹â€œå¼€é—­åŸåˆ™â€çš„å®Œç¾æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©ç®—æ³•æˆ–è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥çµæ´»åœ°å¢åŠ æ–°çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚</li><li>ç­–ç•¥æ¨¡å¼æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„åŠæ³•ã€‚ç­–ç•¥ç±»çš„ç­‰çº§ç»“æ„å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æˆ–è¡Œä¸ºæ—ã€‚æ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠå…¬å…±çš„ä»£ç ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…ä»£ç é‡å¤ã€‚</li><li>ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶(if-else)è¯­å¥ã€‚å¤šé‡æ¡ä»¶è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œå®ƒæŠŠé‡‡å–å“ªä¸€ç§ç®—æ³•æˆ–é‡‡å–å“ªä¸€ç§è¡Œä¸ºçš„é€»è¾‘ä¸ç®—æ³•æˆ–è¡Œä¸ºçš„é€»è¾‘æ··åˆåœ¨ä¸€èµ·ï¼Œç»Ÿç»Ÿåˆ—åœ¨ä¸€ä¸ªå¤šé‡æ¡ä»¶è¯­å¥é‡Œé¢ï¼Œæ¯”ä½¿ç”¨ç»§æ‰¿çš„åŠæ³•è¿˜è¦åŸå§‹å’Œè½åã€‚</li></ol><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ol><li>å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚è¿™å°±æ„å‘³ç€å®¢æˆ·ç«¯å¿…é¡»ç†è§£è¿™äº›ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ã€‚</li><li>ç”±äºç­–ç•¥æ¨¡å¼æŠŠæ¯ä¸ªå…·ä½“çš„ç­–ç•¥å®ç°éƒ½å•ç‹¬å°è£…æˆä¸ºç±»ï¼Œå¦‚æœå¤‡é€‰çš„ç­–ç•¥å¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ•°ç›®å°±ä¼šå¾ˆå¯è§‚ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚</li></ol><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="http://www.hollischuang.com/archives/1691" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼ˆåäºŒï¼‰â€”â€”ç­–ç•¥æ¨¡å¼</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç­–ç•¥æ¨¡å¼(Strategy Pattern)ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ï¼Œä¹Ÿç§°ä¸ºæ”¿ç­–æ¨¡å¼(Policy)ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ ¹æ®æ¡ä»¶çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ç­–ç•¥&lt;br&gt;
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>æŠ½è±¡å·¥å‚</title>
    <link href="https://hsb786.github.io/2018/04/17/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82/"/>
    <id>https://hsb786.github.io/2018/04/17/æŠ½è±¡å·¥å‚/</id>
    <published>2018-04-17T09:17:08.000Z</published>
    <updated>2018-04-20T13:20:15.747Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼åˆç§°ä¸ºKitæ¨¡å¼ï¼Œå±äºå¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚</p></blockquote><p>å°†åŒä¸€äº§å“æ—çš„å•ç‹¬çš„å·¥å‚å°è£…èµ·æ¥ã€‚é€šè¿‡åˆ›å»ºæŠ½è±¡å·¥å‚çš„å…·ä½“å®ç°ï¼Œç„¶åä½¿ç”¨æŠ½è±¡å·¥å‚åšä¸ºæ¥å£æ¥åˆ›å»ºè¿™ä¸€äº§å“æ—çš„å…·ä½“å¯¹è±¡ã€‚<br><a id="more"></a><br><img src="/images/design-pattern-factory02.png" alt=""></p><hr><h2 id="äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—"><a href="#äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—" class="headerlink" title="äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—"></a>äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—</h2><p>äº§å“ç­‰çº§ç»“æ„ï¼š <strong>äº§å“ç­‰çº§ç»“æ„å³äº§å“çš„ç»§æ‰¿ç»“æ„ï¼ŒåŒä¸€ç±»äº§å“</strong>ï¼Œå¦‚ä¸€ä¸ªæŠ½è±¡ç±»æ˜¯ç”µè§†æœºï¼Œå…¶å­ç±»æœ‰æµ·å°”ç”µè§†æœºã€æµ·ä¿¡ç”µè§†æœºã€TCLç”µè§†æœºï¼Œåˆ™æŠ½è±¡ç”µè§†æœºä¸å…·ä½“å“ç‰Œçš„ç”µè§†æœºä¹‹é—´æ„æˆäº†ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ï¼ŒæŠ½è±¡ç”µè§†æœºæ˜¯çˆ¶ç±»ï¼Œè€Œå…·ä½“å“ç‰Œçš„ç”µè§†æœºæ˜¯å…¶å­ç±»ã€‚</p><p>äº§å“æ—ï¼šåœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œ<strong>äº§å“æ—æ˜¯æŒ‡ç”±åŒä¸€ä¸ªå·¥å‚ç”Ÿäº§çš„ï¼ŒåŒä¸€ä¸ªå“ç‰Œäº§å“</strong>ï¼Œä½äºä¸åŒäº§å“ç­‰çº§ç»“æ„ä¸­çš„ä¸€ç»„äº§å“ï¼Œå¦‚æµ·å°”ç”µå™¨å·¥å‚ç”Ÿäº§çš„æµ·å°”ç”µè§†æœºã€æµ·å°”ç”µå†°ç®±ï¼Œæµ·å°”ç”µè§†æœºä½äºç”µè§†æœºäº§å“ç­‰çº§ç»“æ„ä¸­ï¼Œæµ·å°”ç”µå†°ç®±ä½äºç”µå†°ç®±äº§å“ç­‰çº§ç»“æ„ä¸­ã€‚</p><h2 id="æŠ½è±¡å·¥å‚ä¸å·¥å‚æ–¹æ³•"><a href="#æŠ½è±¡å·¥å‚ä¸å·¥å‚æ–¹æ³•" class="headerlink" title="æŠ½è±¡å·¥å‚ä¸å·¥å‚æ–¹æ³•"></a>æŠ½è±¡å·¥å‚ä¸å·¥å‚æ–¹æ³•</h2><p>æŠ½è±¡å·¥å‚å’Œå·¥å‚æ–¹æ³•æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå·¥å‚æ–¹æ³•é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼åˆ™éœ€è¦é¢å¯¹å¤šä¸ªäº§å“ç­‰çº§ç»“æ„ã€‚</p><p>å·¥å‚æ–¹æ³•ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„å›ºå®šäº§å“ï¼ˆæ”¯æŒå¢åŠ ä»»æ„äº§å“ï¼Œæ–°å¢äº§å“æ˜¯ä¸éœ€è¦æ›´æ”¹å·²æœ‰çš„å·¥ç¨‹ï¼Œéœ€è¦å¢åŠ è¯¥äº§å“å¯¹åº”çš„å·¥ç¨‹ã€‚ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯å¼•å…¥äº†å¤æ‚æ€§ï¼‰</p><p>æŠ½è±¡å·¥å‚ï¼šç”¨æ¥ç”Ÿäº§ä¸åŒäº§å“æ—çš„å…¨éƒ¨äº§å“ã€‚ï¼ˆå¢åŠ æ–°äº§å“æ—¶ï¼Œéœ€è¦ä¿®æ”¹å·¥å‚ï¼Œå¢åŠ äº§å“æ—æ—¶ï¼Œéœ€è¦å¢åŠ å·¥å‚ã€‚ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œéƒ¨åˆ†ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œé™ä½äº†å¤æ‚æ€§ï¼‰</p><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><p>æ¯æ¬¡å¯ä»¥é€šè¿‡å…·ä½“å·¥å‚ç±»åˆ›å»ºä¸€ä¸ªäº§å“æ—çš„å¤šä¸ªå¯¹è±¡ï¼Œå¢åŠ æ–°çš„å…·ä½“å·¥å‚å’Œäº§å“æ—å¾ˆæ–¹ä¾¿ã€‚</p><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„å¾ˆå¤æ‚ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚å’Œæ‰€æœ‰çš„å…·ä½“å·¥å‚ç±»ã€‚</p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://lujunqiu.github.io/2017/11/13/å·¥å‚æ¨¡å¼-ä¸‹/" target="_blank" rel="noopener">å·¥å‚æ¨¡å¼-ä¸‹</a></p><p><a href="http://www.hollischuang.com/archives/1430" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼ˆå…«ï¼‰â€”â€”å·¥å‚æ¨¡å¼æ€»ç»“</a><br><a href="http://www.hollischuang.com/archives/1420" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼ˆä¸ƒï¼‰â€”â€”æŠ½è±¡å·¥å‚æ¨¡å¼</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼åˆç§°ä¸ºKitæ¨¡å¼ï¼Œå±äºå¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°†åŒä¸€äº§å“æ—çš„å•ç‹¬çš„å·¥å‚å°è£…èµ·æ¥ã€‚é€šè¿‡åˆ›å»ºæŠ½è±¡å·¥å‚çš„å…·ä½“å®ç°ï¼Œç„¶åä½¿ç”¨æŠ½è±¡å·¥å‚åšä¸ºæ¥å£æ¥åˆ›å»ºè¿™ä¸€äº§å“æ—çš„å…·ä½“å¯¹è±¡ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>å·¥å‚æ–¹æ³•</title>
    <link href="https://hsb786.github.io/2018/04/17/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/"/>
    <id>https://hsb786.github.io/2018/04/17/å·¥å‚æ–¹æ³•/</id>
    <published>2018-04-17T09:05:30.000Z</published>
    <updated>2018-04-20T13:21:25.925Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å®šä¹‰äº†ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚</p></blockquote><p>å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method Pattern)åˆç§°ä¸ºå·¥å‚æ¨¡å¼ï¼Œä¹Ÿå«è™šæ‹Ÿæ„é€ å™¨(Virtual Constructor)æ¨¡å¼æˆ–è€…å¤šæ€å·¥å‚(Polymorphic Factory)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚<br><a id="more"></a><br><img src="/images/design-pattern-factory01.png" alt=""></p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li>åœ¨ç³»ç»Ÿä¸­åŠ å…¥æ–°äº§å“æ—¶ï¼Œæ— é¡»ä¿®æ”¹æŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“æä¾›çš„æ¥å£ï¼Œä¹Ÿæ— é¡»ä¿®æ”¹å…¶ä»–çš„å…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ï¼Œè€Œåªè¦æ·»åŠ ä¸€ä¸ªå…·ä½“å·¥å‚å’Œå…·ä½“äº§å“å°±å¯ä»¥äº†ã€‚è¿™æ ·ï¼Œç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¹Ÿå°±å˜å¾—éå¸¸å¥½ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚</li><li>åŸºäºå·¥å‚è§’è‰²å’Œäº§å“è§’è‰²çš„å¤šæ€æ€§è®¾è®¡æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å…³é”®ã€‚å®ƒèƒ½å¤Ÿä½¿å·¥å‚å¯ä»¥è‡ªä¸»ç¡®å®šåˆ›å»ºä½•ç§äº§å“å¯¹è±¡ï¼Œè€Œå¦‚ä½•åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„ç»†èŠ‚åˆ™å®Œå…¨å°è£…åœ¨å…·ä½“å·¥å‚å†…éƒ¨ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ä¹‹æ‰€ä»¥åˆè¢«ç§°ä¸ºå¤šæ€å·¥å‚æ¨¡å¼ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰çš„å…·ä½“å·¥å‚ç±»éƒ½å…·æœ‰åŒä¸€æŠ½è±¡çˆ¶ç±»ã€‚</li></ul><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><p>åœ¨æ·»åŠ æ–°äº§å“æ—¶ï¼Œéœ€è¦ç¼–å†™æ–°çš„å…·ä½“äº§å“ç±»ï¼Œè€Œä¸”è¿˜è¦æä¾›ä¸ä¹‹å¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°å°†æˆå¯¹å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œæœ‰æ›´å¤šçš„ç±»éœ€è¦ç¼–è¯‘å’Œè¿è¡Œï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚</p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://lujunqiu.github.io/2017/11/08/å·¥å‚æ¨¡å¼/" target="_blank" rel="noopener">å·¥å‚æ¨¡å¼(ä¸Š)</a></p><p><a href="http://www.cnblogs.com/xiaoxi/p/7641358.html" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼</a></p><p><a href="http://www.hollischuang.com/archives/1401" target="_blank" rel="noopener">è®¾è®¡æ¨¡å¼ï¼ˆäº”ï¼‰â€”â€”å·¥å‚æ–¹æ³•æ¨¡å¼</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å®šä¹‰äº†ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method Pattern)åˆç§°ä¸ºå·¥å‚æ¨¡å¼ï¼Œä¹Ÿå«è™šæ‹Ÿæ„é€ å™¨(Virtual Constructor)æ¨¡å¼æˆ–è€…å¤šæ€å·¥å‚(Polymorphic Factory)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="https://hsb786.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ClassLoader</title>
    <link href="https://hsb786.github.io/2018/04/16/ClassLoader/"/>
    <id>https://hsb786.github.io/2018/04/16/ClassLoader/</id>
    <published>2018-04-16T12:21:34.000Z</published>
    <updated>2018-04-24T06:31:55.684Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Javaä¸­çš„æ‰€æœ‰ç±»ï¼Œå¿…é¡»è¢«è£…è½½åˆ°jvmä¸­æ‰èƒ½è¿è¡Œï¼Œè¿™ä¸ªè£…è½½å·¥ä½œæ˜¯ç”±jvmä¸­çš„ç±»è£…è½½å™¨å®Œæˆçš„ï¼Œç±»è£…è½½å™¨æ‰€åšçš„å·¥ä½œå®è´¨æ˜¯æŠŠç±»æ–‡ä»¶ä»ç¡¬ç›˜è¯»å–åˆ°å†…å­˜ä¸­ï¼ŒJVMåœ¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡ClassLoaderçš„loadClassï¼ˆï¼‰æ–¹æ³•æ¥åŠ è½½classçš„ï¼ŒloadClassä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å¼ã€‚</p></blockquote><a id="more"></a><pre><code>public abstract class ClassLoader</code></pre><blockquote><p>class loaderæ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½classesçš„å¯¹è±¡ï¼ŒClassLoaderç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œéœ€è¦ç»™å‡ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œclass loaderå°è¯•å®šä½æˆ–è€…äº§ç”Ÿä¸€ä¸ªclassçš„æ•°æ®ï¼Œä¸€ä¸ªå…¸å‹çš„ç­–ç•¥æ˜¯æŠŠäºŒè¿›åˆ¶åå­—è½¬æ¢æˆæ–‡ä»¶åç„¶ååˆ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">protected Class&lt;?&gt; loadClass(String name, boolean resolve)</span><br><span class="line">       throws ClassNotFoundException</span><br><span class="line">   &#123;</span><br><span class="line">       synchronized (getClassLoadingLock(name)) &#123;</span><br><span class="line">           // First, check if the class has already been loaded</span><br><span class="line">           Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">           if (c == null) &#123;</span><br><span class="line">               long t0 = System.nanoTime();</span><br><span class="line">               try &#123;</span><br><span class="line">                   if (parent != null) &#123;</span><br><span class="line">                       c = parent.loadClass(name, false);</span><br><span class="line">                   &#125; else &#123;</span><br><span class="line">                       c = findBootstrapClassOrNull(name);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">                   // ClassNotFoundException thrown if class not found</span><br><span class="line">                   // from the non-null parent class loader</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               if (c == null) &#123;</span><br><span class="line">                   // If still not found, then invoke findClass in order</span><br><span class="line">                   // to find the class.</span><br><span class="line">                   long t1 = System.nanoTime();</span><br><span class="line">                   c = findClass(name);</span><br><span class="line"></span><br><span class="line">                   // this is the defining class loader; record the stats</span><br><span class="line">                   sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                   sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                   sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           if (resolve) &#123;</span><br><span class="line">               resolveClass(c);</span><br><span class="line">           &#125;</span><br><span class="line">           return c;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨æŒ‡å®šçš„äºŒè¿›åˆ¶åç§°æ¥åŠ è½½ç±»ï¼Œè¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°æŒ‰ç…§ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ç±»ï¼š è°ƒç”¨findLoadedClass(String)æ–¹æ³•æ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦è¢«åŠ è½½è¿‡ ä½¿ç”¨çˆ¶åŠ è½½å™¨è°ƒç”¨loadClass(String)æ–¹æ³•ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨ä¸ºNullï¼Œç±»åŠ è½½å™¨è£…è½½è™šæ‹Ÿæœºå†…ç½®çš„åŠ è½½å™¨è°ƒç”¨findClass(String)æ–¹æ³•è£…è½½ç±»ï¼Œ å¦‚æœï¼ŒæŒ‰ç…§ä»¥ä¸Šçš„æ­¥éª¤æˆåŠŸçš„æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•æ¥æ”¶çš„resolveå‚æ•°çš„å€¼ä¸ºtrue,é‚£ä¹ˆå°±è°ƒç”¨resolveClass(Class)æ–¹æ³•æ¥å¤„ç†ç±»ã€‚</p></blockquote><hr><p>javaä¸­çš„ç±»å¤§è‡´åˆ†ä¸ºä¸‰ç§:</p><ol><li>ç³»ç»Ÿç±»</li><li>æ‰©å±•ç±»</li><li>ç”±ç¨‹åºå‘˜è‡ªå®šä¹‰çš„ç±»</li></ol><p>ç±»è£…è½½æ–¹å¼ï¼Œæœ‰ä¸¤ç§ï¼š</p><ol><li>éšå¼è£…è½½ï¼Œ ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å½“ç¢°åˆ°é€šè¿‡new ç­‰æ–¹å¼ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œéšå¼è°ƒç”¨ç±»è£…è½½å™¨åŠ è½½å¯¹åº”çš„ç±»åˆ°jvmä¸­ã€‚</li><li>æ˜¾å¼è£…è½½ï¼Œ é€šè¿‡class.forName()ç­‰æ–¹æ³•ï¼Œæ˜¾å¼åŠ è½½éœ€è¦çš„ç±»</li></ol><p>ç±»åŠ è½½çš„åŠ¨æ€æ€§ä½“ç°ï¼š</p><blockquote><p>ä¸€ä¸ªåº”ç”¨ç¨‹åºæ€»æ˜¯ç”±nå¤šä¸ªç±»ç»„æˆï¼ŒJavaç¨‹åºå¯åŠ¨æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰çš„ç±»å…¨éƒ¨åŠ è½½åå†è¿è¡Œï¼Œå®ƒæ€»æ˜¯å…ˆæŠŠä¿è¯ç¨‹åºè¿è¡Œçš„åŸºç¡€ç±»ä¸€æ¬¡æ€§åŠ è½½åˆ°jvmä¸­ï¼Œå…¶å®ƒç±»ç­‰åˆ°jvmç”¨åˆ°çš„æ—¶å€™å†åŠ è½½ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èŠ‚çœäº†å†…å­˜çš„å¼€é”€ï¼Œå› ä¸ºjavaæœ€æ—©å°±æ˜¯ä¸ºåµŒå…¥å¼ç³»ç»Ÿè€Œè®¾è®¡çš„ï¼Œå†…å­˜å®è´µï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥ç†è§£çš„æœºåˆ¶ï¼Œè€Œç”¨åˆ°æ—¶å†åŠ è½½è¿™ä¹Ÿæ˜¯javaåŠ¨æ€æ€§çš„ä¸€ç§ä½“ç°</p></blockquote><h2 id="javaç±»è£…è½½å™¨"><a href="#javaç±»è£…è½½å™¨" class="headerlink" title="javaç±»è£…è½½å™¨"></a>javaç±»è£…è½½å™¨</h2><p>Javaä¸­çš„ç±»è£…è½½å™¨å®è´¨ä¸Šä¹Ÿæ˜¯ç±»ï¼ŒåŠŸèƒ½æ˜¯æŠŠç±»è½½å…¥jvmä¸­ï¼Œjvmçš„ç±»è£…è½½å™¨æœ‰ä¸‰ä¸ªï¼Œå±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/ClassLoader01.png" alt=""></p><h2 id="ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„"><a href="#ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„" class="headerlink" title="ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„"></a>ç±»åŠ è½½å™¨ä¹‹é—´æ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„</h2><p>javaæ˜¯å¦‚ä½•åŒºåˆ†ä¸€ä¸ªç±»è¯¥ç”±å“ªä¸ªç±»åŠ è½½å™¨æ¥å®Œæˆå‘¢ã€‚ åœ¨è¿™é‡Œjavaé‡‡ç”¨äº†å§”æ‰˜æ¨¡å‹æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ç®€å•æ¥è®²ï¼Œå°±æ˜¯â€œ<strong>ç±»è£…è½½å™¨æœ‰è½½å…¥ç±»çš„éœ€æ±‚æ—¶ï¼Œä¼šå…ˆè¯·ç¤ºå…¶Parentä½¿ç”¨å…¶æœç´¢è·¯å¾„å¸®å¿™è½½å…¥ï¼Œå¦‚æœParent æ‰¾ä¸åˆ°,é‚£ä¹ˆæ‰ç”±è‡ªå·±ä¾ç…§è‡ªå·±çš„æœç´¢è·¯å¾„æœç´¢ç±»</strong>â€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Public class Test&#123;</span><br><span class="line">    Public static void main(String[] arg)&#123;</span><br><span class="line">        ClassLoader c  = Test.class.getClassLoader();  //è·å–Testç±»çš„ç±»åŠ è½½å™¨</span><br><span class="line">        System.out.println(c); </span><br><span class="line">        ClassLoader c1 = c.getParent();  //è·å–cè¿™ä¸ªç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">        ClassLoader c2 = c1.getParent();//è·å–c1è¿™ä¸ªç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨</span><br><span class="line">        System.out.println(c2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//output</span><br><span class="line">AppClassLoader</span><br><span class="line">ExtClassLoader</span><br><span class="line">Null</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºTestæ˜¯ç”±<strong>AppClassLoader</strong>åŠ è½½å™¨åŠ è½½çš„ï¼Œ<strong>AppClassLoader</strong>çš„<code>Parent</code> åŠ è½½å™¨æ˜¯ <strong>ExtClassLoader</strong>,ä½†æ˜¯<strong>ExtClassLoader</strong>çš„<code>Parent</code>ä¸º <code>null</code> æ˜¯æ€ä¹ˆå›äº‹ã€‚<strong>Bootstrap Loader</strong>æ˜¯ç”¨C++è¯­è¨€å†™çš„ï¼Œä¾javaçš„è§‚ç‚¹æ¥çœ‹ï¼Œé€»è¾‘ä¸Šå¹¶ä¸å­˜åœ¨<strong>Bootstrap Loader</strong>çš„ç±»å®ä½“ï¼Œæ‰€ä»¥åœ¨javaç¨‹åºä»£ç é‡Œè¯•å›¾æ‰“å°å‡ºå…¶å†…å®¹æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°è¾“å‡ºä¸º<code>null</code>ã€‚</p><p>javaç±»åŠ è½½å™¨åŸºäºä¸‰ä¸ªæœºåˆ¶ï¼šå§”æ‰˜ï¼Œå¯è§ï¼Œå•ä¸€ã€‚</p><ul><li>å§”æ‰˜æœºåˆ¶ï¼šæŒ‡çš„æ˜¯å°†åŠ è½½ç±»çš„è¯·æ±‚ä¼ é€’ç»™çˆ¶åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ‰¾ä¸åˆ°æˆ–è€…ä¸èƒ½åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå†åŠ è½½ä»–ã€‚</li><li>å¯è§æ€§æœºåˆ¶ï¼šæŒ‡çš„æ˜¯çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»éƒ½èƒ½è¢«å­åŠ è½½å™¨çœ‹è§ï¼Œä½†æ˜¯å­åŠ è½½å™¨åŠ è½½çš„ç±»çˆ¶åŠ è½½å™¨æ˜¯çœ‹ä¸è§çš„ã€‚</li><li>å•ä¸€æ€§æœºåˆ¶ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªç±»åªèƒ½è¢«åŒä¸€ç§åŠ è½½å™¨åŠ è½½ä¸€æ¬¡ã€‚</li></ul><hr><h2 id="JVMåŠ è½½classæ–‡ä»¶çš„åŸç†æœºåˆ¶"><a href="#JVMåŠ è½½classæ–‡ä»¶çš„åŸç†æœºåˆ¶" class="headerlink" title="JVMåŠ è½½classæ–‡ä»¶çš„åŸç†æœºåˆ¶"></a>JVMåŠ è½½classæ–‡ä»¶çš„åŸç†æœºåˆ¶</h2><p>ç±»è£…è½½å™¨å°±æ˜¯å¯»æ‰¾ç±»æˆ–æ¥å£å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œè§£æå¹¶æ„é€ JVMå†…éƒ¨å¯¹è±¡è¡¨ç¤ºçš„ç»„ä»¶ï¼Œåœ¨javaä¸­ç±»è£…è½½å™¨æŠŠä¸€ä¸ªç±»è£…å…¥JVMï¼Œç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>è£…è½½ï¼šæŸ¥æ‰¾å’Œå¯¼å…¥Classæ–‡ä»¶</li><li>é“¾æ¥ï¼š<ul><li>éªŒè¯ï¼šæ£€æŸ¥è½½å…¥çš„classæ–‡ä»¶æ•°æ®çš„æ­£ç¡®æ€§</li><li>å‡†å¤‡ï¼š ç»™ç±»çš„é™æ€å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´</li><li>è§£æï¼š å°†ç¬¦å·å¼•ç”¨è½¬æˆç›´æ¥å¼•ç”¨</li></ul></li><li>åˆå§‹åŒ–ï¼šå¯¹é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ</li></ul><p>ç±»è£…è½½å·¥ä½œç”±<code>ClassLoder</code>å’Œå…¶å­ç±»è´Ÿè´£ã€‚JVMåœ¨è¿è¡Œæ—¶ä¼šäº§ç”Ÿä¸‰ä¸ªClassLoaderï¼š<strong>æ ¹è£…è½½å™¨</strong>ï¼Œ<code>ExtClassLoader</code>(<strong>æ‰©å±•ç±»è£…è½½å™¨</strong>)å’Œ<code>AppClassLoader</code>ï¼Œå…¶ä¸­æ ¹è£…è½½å™¨ä¸æ˜¯ClassLoaderçš„å­ç±»ï¼Œç”±C++ç¼–å†™ï¼Œå› æ­¤åœ¨javaä¸­çœ‹ä¸åˆ°ä»–ï¼Œè´Ÿè´£è£…è½½JREçš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚JREç›®å½•ä¸‹çš„rt.jar,charsets.jarç­‰ã€‚<code>ExtClassLoader</code>æ˜¯<code>ClassLoder</code>çš„å­ç±»ï¼Œè´Ÿè´£è£…è½½JREæ‰©å±•ç›®å½•extä¸‹çš„jarç±»åŒ…ï¼›<code>AppClassLoader</code><strong>è´Ÿè´£è£…è½½classpathè·¯å¾„ä¸‹çš„ç±»åŒ…ï¼Œè¿™ä¸‰ä¸ªç±»è£…è½½å™¨å­˜åœ¨çˆ¶å­å±‚çº§å…³ç³»ï¼Œå³æ ¹è£…è½½å™¨æ˜¯ExtClassLoaderçš„çˆ¶è£…è½½å™¨ï¼ŒExtClassLoaderæ˜¯AppClassLoaderçš„çˆ¶è£…è½½å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨AppClassLoaderè£…è½½åº”ç”¨ç¨‹åºçš„ç±»</strong></p><p>Javaè£…è½½ç±»ä½¿ç”¨â€œ<strong>å…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶</strong>â€ã€‚â€œ<strong>å…¨ç›˜è´Ÿè´£</strong>â€æ˜¯æŒ‡å½“ä¸€ä¸ª<code>ClassLoder</code>è£…è½½ä¸€ä¸ªç±»æ—¶ï¼Œé™¤éæ˜¾ç¤ºçš„ä½¿ç”¨å¦å¤–ä¸€ä¸ª<code>ClassLoder</code>ï¼Œè¯¥ç±»æ‰€ä¾èµ–åŠå¼•ç”¨çš„ç±»ä¹Ÿç”±è¿™ä¸ª<code>ClassLoderè½½å…¥</code>ï¼›â€œ<strong>å§”æ‰˜æœºåˆ¶</strong>â€æ˜¯æŒ‡å…ˆå§”æ‰˜çˆ¶ç±»è£…è½½å™¨å¯»æ‰¾ç›®æ ‡ç±»ï¼Œåªæœ‰åœ¨æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å¹¶è£…è½½ç›®æ ‡ç±»ã€‚è¿™ä¸€ç‚¹æ˜¯ä»å®‰å…¨æ–¹é¢è€ƒè™‘çš„ï¼Œè¯•æƒ³å¦‚æœä¸€ä¸ªäººå†™äº†ä¸€ä¸ªæ¶æ„çš„åŸºç¡€ç±»ï¼ˆå¦‚<code>java.lang.String</code>ï¼‰å¹¶åŠ è½½åˆ°<code>JVM</code>å°†ä¼šå¼•èµ·ä¸¥é‡çš„åæœï¼Œä½†æœ‰äº†å…¨ç›˜è´Ÿè´£åˆ¶ï¼Œ<code>java.lang.String</code>æ°¸è¿œæ˜¯ç”±æ ¹è£…è½½å™¨æ¥è£…è½½ï¼Œé¿å…ä»¥ä¸Šæƒ…å†µå‘ç”Ÿ é™¤äº†JVMé»˜è®¤çš„ä¸‰ä¸ª<code>ClassLoder</code>ä»¥å¤–ï¼Œç¬¬ä¸‰æ–¹å¯ä»¥ç¼–å†™è‡ªå·±çš„ç±»è£…è½½å™¨ï¼Œä»¥å®ç°ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ã€‚ç±»æ–‡ä»¶è¢«è£…è½½è§£æåï¼Œåœ¨<code>JVM</code>ä¸­éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<code>java.lang.Class</code>å¯¹è±¡ï¼Œæä¾›äº†ç±»ç»“æ„ä¿¡æ¯çš„æè¿°ã€‚æ•°ç»„ï¼Œæšä¸¾åŠåŸºæœ¬æ•°æ®ç±»å‹ï¼Œç”šè‡³<code>void</code>éƒ½æ‹¥æœ‰å¯¹åº”çš„<code>Class</code>å¯¹è±¡ã€‚</p><hr><p>è£…è½½è¿‡ç¨‹æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ç‰¹å¾ï¼š<strong>å±‚æ¬¡ç»„ç»‡ç»“æ„</strong>å’Œ<strong>ä»£ç†æ¨¡å¼</strong>ã€‚<strong>å±‚æ¬¡ç»„ç»‡ç»“æ„</strong>æŒ‡çš„æ˜¯æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ï¼Œé€šè¿‡getParent()æ–¹æ³•å¯ä»¥è·å–åˆ°ã€‚ç±»åŠ è½½å™¨é€šè¿‡è¿™ç§çˆ¶äº²-åä»£çš„æ–¹å¼ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå½¢æˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„ã€‚<strong>ä»£ç†æ¨¡å¼</strong>åˆ™æŒ‡çš„æ˜¯ä¸€ä¸ªç±»åŠ è½½å™¨æ—¢å¯ä»¥è‡ªå·±å®ŒæˆJavaç±»çš„å®šä¹‰å·¥ä½œï¼Œä¹Ÿå¯ä»¥ä»£ç†ç»™å…¶å®ƒçš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚ç”±äºä»£ç†æ¨¡å¼çš„å­˜åœ¨ï¼Œå¯åŠ¨ä¸€ä¸ªç±»çš„åŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨å’Œæœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„ç±»åŠ è½½å™¨å¯èƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªã€‚ClassLoaderçš„åŠ è½½ç±»è¿‡ç¨‹ä¸»è¦ä½¿ç”¨loadClassæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­å°è£…äº†ä¸­åŠ è½½æœºåˆ¶ï¼š<strong>åŒäº²å§”æ´¾æ¨¡å¼</strong>ã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œçˆ¶ç±»ä¼˜å…ˆçš„ç­–ç•¥å°±è¶³å¤Ÿå¥½äº†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é‡‡å–ç›¸åçš„ç­–ç•¥ï¼Œå³å…ˆå°è¯•è‡ªå·±åŠ è½½ï¼Œæ‰¾ä¸åˆ°çš„æ—¶å€™å†ä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™ç§åšæ³•åœ¨Javaçš„Webå®¹å™¨ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¹Ÿæ˜¯<code>Servlet</code>è§„èŒƒæ¨èçš„åšæ³•ã€‚æ¯”å¦‚ï¼Œ<code>Apache Tomcat</code>ä¸ºæ¯ä¸ª<code>Web</code>åº”ç”¨éƒ½æä¾›ä¸€ä¸ªç‹¬ç«‹çš„ç±»åŠ è½½å™¨ï¼Œä½¿ç”¨çš„å°±æ˜¯è‡ªå·±ä¼˜å…ˆåŠ è½½çš„ç­–ç•¥ã€‚</p><p>ç±»åŠ è½½å™¨çš„ä¸€ä¸ªé‡è¦ç”¨é€”æ˜¯åœ¨<code>JVM</code>ä¸­ä¸ºç›¸åŒåç§°çš„Javaç±»åˆ›å»ºéš”ç¦»ç©ºé—´ã€‚åœ¨<code>JVM</code>ä¸­ï¼Œåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒï¼Œä¸ä»…æ˜¯æ ¹æ®è¯¥ç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œè¿˜éœ€è¦æ ¹æ®ä¸¤ä¸ªç±»çš„å®šä¹‰ç±»åŠ è½½å™¨ã€‚åªæœ‰ä¸¤è€…å®Œå…¨ä¸€æ ·ï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»çš„æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œå³ä¾¿æ˜¯åŒæ ·çš„<code>Java</code>å­—èŠ‚ä»£ç ï¼Œè¢«ä¸¤ä¸ªä¸åŒçš„ç±»åŠ è½½å™¨å®šä¹‰ä¹‹åï¼Œæ‰€å¾—åˆ°çš„<code>Java</code>ç±»ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å¦‚æœè¯•å›¾åœ¨ä¸¤ä¸ªç±»çš„å¯¹è±¡ä¹‹é—´è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä¼šæŠ›å‡º<code>java.lang.ClassCastException</code>ã€‚è¿™ä¸ªç‰¹æ€§ä¸ºåŒæ ·åç§°çš„<code>Java</code>ç±»åœ¨<code>JVM</code>ä¸­å…±å­˜åˆ›é€ äº†æ¡ä»¶ã€‚åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šè¦æ±‚åŒä¸€åç§°çš„<code>Java</code>ç±»çš„ä¸åŒç‰ˆæœ¬åœ¨<code>JVM</code>ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨ã€‚é€šè¿‡ç±»åŠ è½½å™¨å°±å¯ä»¥æ»¡è¶³è¿™ç§éœ€æ±‚ã€‚</p></blockquote><h2 id="Javaç±»çš„é“¾æ¥"><a href="#Javaç±»çš„é“¾æ¥" class="headerlink" title="Javaç±»çš„é“¾æ¥"></a>Javaç±»çš„é“¾æ¥</h2><p>Javaç±»çš„é“¾æ¥æŒ‡çš„æ˜¯å°†Javaç±»çš„äºŒè¿›åˆ¶ä»£ç åˆå¹¶åˆ°JVMçš„è¿è¡ŒçŠ¶æ€ä¹‹ä¸­çš„è¿‡ç¨‹ã€‚åœ¨é“¾æ¥ä¹‹å‰ï¼Œè¿™ä¸ªç±»å¿…é¡»è¢«æˆåŠŸåŠ è½½ã€‚<br>é“¾æ¥çš„è¿‡ç¨‹æ¯”åŠ è½½è¿‡ç¨‹è¦å¤æ‚å¾ˆå¤šï¼Œè¿™æ˜¯å®ç°javaçš„åŠ¨æ€æ€§çš„é‡è¦ä¸€æ­¥ï¼åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<code>verification</code> ï¼ˆéªŒè¯ï¼‰ï¼Œ <code>preparation</code>ï¼ˆå‡†å¤‡ï¼‰ å’Œ <code>resolution</code>ï¼ˆè§£æï¼‰</p><p><strong>1. verificationï¼ˆéªŒè¯ï¼‰ï¼š</strong><br>éªŒè¯æ˜¯ç”¨æ¥ç¡®ä¿Javaç±»çš„äºŒè¿›åˆ¶è¡¨ç¤ºåœ¨ç»“æ„ä¸Šæ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚è¦éªŒè¯æ¯”å¦‚classæ–‡ä»¶æ ¼å¼è§„èŒƒã€è¿™ä¸ªç±»æ˜¯å¦ç»§æ‰¿äº†finalç±»ã€ä¸èƒ½æŠŠä¸€ä¸ªçˆ¶ç±»å¯¹è±¡èµ‹å€¼ç»™å­ç±»æ•°æ®ç±»å‹ç­‰ç­‰ã€‚å¦‚æœéªŒè¯è¿‡ç¨‹å‡ºç°é”™è¯¯çš„è¯ï¼Œä¼šæŠ›å‡ºjava.lang.VerifyErroré”™è¯¯ã€‚</p><p><strong>2.preparationï¼ˆå‡†å¤‡ï¼‰ï¼š</strong></p><p>å‡†å¤‡é˜¶æ®µä¸ºæ–¹æ³•åŒºä¸­çš„é™æ€å˜é‡åˆ†é…å†…å­˜ç©ºé—´ã€‚å¹¶å°†å…¶èµ‹å€¼ä¸ºåˆå§‹å€¼ï¼Œæ‰€æœ‰åŸå§‹ç±»å‹çš„å€¼éƒ½ä¸º0ã€‚å¦‚floatä¸º0fã€ intä¸º0ã€booleanä¸º0ã€å¼•ç”¨ç±»å‹ä¸ºnullã€‚</p><p><strong>3.resolutionï¼ˆè§£æï¼‰ï¼š</strong></p><p>è§£æçš„è¿‡ç¨‹å°±æ˜¯ç¡®ä¿è¿™äº›è¢«å¼•ç”¨çš„ç±»èƒ½è¢«æ­£ç¡®çš„æ‰¾åˆ°ã€‚è§£æçš„è¿‡ç¨‹å¯èƒ½ä¼šå¯¼è‡´å…¶å®ƒçš„Javaç±»è¢«åŠ è½½ã€‚</p><p>ä¸ºç±»ã€æ¥å£ã€æ–¹æ³•ã€æˆå‘˜å˜é‡çš„ç¬¦å·å¼•ç”¨å®šä½ç›´æ¥å¼•ç”¨ã€‚</p><p>ç¬¦å·å¼•ç”¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå”¯ä¸€æ ‡è¯†ä¸€ä¸ªç±»ã€ä¸€ä¸ªå­—æ®µã€ä¸€ä¸ªæ–¹æ³•ç­‰ç›®æ ‡ã€‚</p><p>è€Œç›´æ¥å¼•ç”¨å¯¹äºç±»å˜é‡ã€ç±»æ–¹æ³•æŒ‡çš„æ˜¯æŒ‡å‘æ–¹æ³•åŒºçš„æŒ‡é’ˆï¼Œç„¶åå¯¹äºå®ä¾‹æ–¹æ³•ã€å®ä¾‹å¯¹è±¡æ¥è¯´å°±æ˜¯åç§»é‡ï¼Œæ¯”å¦‚ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå­ç±»ä¸­æ–¹æ³•è¡¨ä¸­çš„åç§»é‡å’Œçˆ¶ç±»æ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¸ªåç§»é‡å¯ä»¥ç¡®å®šæŸä¸ªæ–¹æ³•çš„ä½ç½®ã€‚</p><h2 id="Javaç±»çš„åˆå§‹åŒ–"><a href="#Javaç±»çš„åˆå§‹åŒ–" class="headerlink" title="Javaç±»çš„åˆå§‹åŒ–"></a>Javaç±»çš„åˆå§‹åŒ–</h2><p>ç±»çš„åˆå§‹åŒ–æ˜¯å»¶è¿Ÿçš„ï¼Œç›´åˆ°ç±»ç¬¬ä¸€æ¬¡è¢«ä¸»åŠ¨ä½¿ç”¨(active use)ï¼ŒJVM æ‰ä¼šåˆå§‹åŒ–ç±»ã€‚<br>å½“ä¸€ä¸ªJavaç±»ç¬¬ä¸€æ¬¡è¢«çœŸæ­£ä½¿ç”¨åˆ°çš„æ—¶å€™ï¼ŒJVMä¼šè¿›è¡Œè¯¥ç±»çš„åˆå§‹åŒ–æ“ä½œã€‚åˆå§‹åŒ–è¿‡ç¨‹çš„ä¸»è¦æ“ä½œæ˜¯æ‰§è¡Œé™æ€ä»£ç å—å’Œåˆå§‹åŒ–é™æ€åŸŸã€‚åœ¨ä¸€ä¸ªç±»è¢«åˆå§‹åŒ–ä¹‹å‰ï¼Œå®ƒçš„ç›´æ¥çˆ¶ç±»ä¹Ÿéœ€è¦è¢«åˆå§‹åŒ–ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ªæ¥å£çš„åˆå§‹åŒ–ï¼Œä¸ä¼šå¼•èµ·å…¶çˆ¶æ¥å£çš„åˆå§‹åŒ–ã€‚åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§æºä»£ç ä¸­ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä¾æ¬¡æ‰§è¡Œé™æ€ä»£ç å—å’Œåˆå§‹åŒ–é™æ€åŸŸã€‚</p><p>åˆå§‹åŒ–è¿‡ç¨‹ä¼šè¢«è§¦å‘çš„æ¡ä»¶æ±‡æ€»ï¼š</p><ol><li>ä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡ã€è®¿é—®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µã€é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚</li><li>å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ã€‚</li><li>å½“åˆå§‹åŒ–å­ç±»æ—¶ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œçˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li></ol><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="http://www.hollischuang.com/archives/199" target="_blank" rel="noopener">æ·±åº¦åˆ†æJavaçš„ClassLoaderæœºåˆ¶ï¼ˆæºç çº§åˆ«ï¼‰</a></p><p><a href="http://www.hollischuang.com/archives/201" target="_blank" rel="noopener">Javaç±»çš„åŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–</a></p><p><a href="http://brianway.github.io/2016/02/03/javase-learn-note-3-ClassLoader/" target="_blank" rel="noopener">javaåŸºç¡€å·©å›ºç¬”è®°(3)-ç±»åŠ è½½å™¨</a></p><p><a href="https://blog.csdn.net/seu_calvin/article/details/52301541" target="_blank" rel="noopener">JVMâ€”â€”Javaç±»åŠ è½½æœºåˆ¶æ€»ç»“ </a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Javaä¸­çš„æ‰€æœ‰ç±»ï¼Œå¿…é¡»è¢«è£…è½½åˆ°jvmä¸­æ‰èƒ½è¿è¡Œï¼Œè¿™ä¸ªè£…è½½å·¥ä½œæ˜¯ç”±jvmä¸­çš„ç±»è£…è½½å™¨å®Œæˆçš„ï¼Œç±»è£…è½½å™¨æ‰€åšçš„å·¥ä½œå®è´¨æ˜¯æŠŠç±»æ–‡ä»¶ä»ç¡¬ç›˜è¯»å–åˆ°å†…å­˜ä¸­ï¼ŒJVMåœ¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡ClassLoaderçš„loadClassï¼ˆï¼‰æ–¹æ³•æ¥åŠ è½½classçš„ï¼ŒloadClassä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="JVM" scheme="https://hsb786.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://hsb786.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>TCP/IP</title>
    <link href="https://hsb786.github.io/2018/04/16/TCP-IP/"/>
    <id>https://hsb786.github.io/2018/04/16/TCP-IP/</id>
    <published>2018-04-16T10:43:52.000Z</published>
    <updated>2018-04-25T06:57:56.248Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ„Ÿè§‰è®¡ç®—æœºç½‘ç»œè¯¾ä¸Šå­¦çš„ä¸œè¥¿å¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆåŠï¼Ÿ</p><p>è¿˜èƒ½æ€ä¹ˆåŠï¼Œå­¦å•Šã€‚</p></blockquote><h2 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h2><p>ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Š</p><blockquote><p>Transmission Control Protocol/Internet Protocolçš„ç®€å†™ï¼Œä¸­è¯‘åä¸ºä¼ è¾“æ§åˆ¶åè®®/å› ç‰¹ç½‘äº’è”åè®®ï¼Œåˆåç½‘ç»œé€šè®¯åè®®ï¼Œæ˜¯Internetæœ€åŸºæœ¬çš„åè®®ã€Internetå›½é™…äº’è”ç½‘ç»œçš„åŸºç¡€ï¼Œç”±ç½‘ç»œå±‚çš„IPåè®®å’Œä¼ è¾“å±‚çš„TCPåè®®ç»„æˆã€‚TCP/IP å®šä¹‰äº†ç”µå­è®¾å¤‡å¦‚ä½•è¿å…¥å› ç‰¹ç½‘ï¼Œä»¥åŠæ•°æ®å¦‚ä½•åœ¨å®ƒä»¬ä¹‹é—´ä¼ è¾“çš„æ ‡å‡†ã€‚åè®®é‡‡ç”¨äº†4å±‚çš„å±‚çº§ç»“æ„ï¼Œæ¯ä¸€å±‚éƒ½å‘¼å«å®ƒçš„ä¸‹ä¸€å±‚æ‰€æä¾›çš„åè®®æ¥å®Œæˆè‡ªå·±çš„éœ€æ±‚ã€‚é€šä¿—è€Œè¨€ï¼šTCPè´Ÿè´£å‘ç°ä¼ è¾“çš„é—®é¢˜ï¼Œä¸€æœ‰é—®é¢˜å°±å‘å‡ºä¿¡å·ï¼Œè¦æ±‚é‡æ–°ä¼ è¾“ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®å®‰å…¨æ­£ç¡®åœ°ä¼ è¾“åˆ°ç›®çš„åœ°ã€‚è€ŒIPæ˜¯ç»™å› ç‰¹ç½‘çš„æ¯ä¸€å°è”ç½‘è®¾å¤‡è§„å®šä¸€ä¸ªåœ°å€ã€‚<br><a id="more"></a></p></blockquote><p>TCP/IPåè®®æ—å°±é‡‡ç”¨äº†åˆ†å±‚çš„æ€æƒ³ï¼Œè‡ªä¸Šè€Œä¸‹åˆ†æˆäº†å››å±‚ï¼š åº”ç”¨å±‚ï¼Œä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼Œé“¾è·¯å±‚ï¼Œæ¯ä¸€å±‚çš„åè®®åªçº¦å®šäº†ç‰¹å®šçš„åŠŸèƒ½ï¼ŒHTTPå°±ä½äºåº”ç”¨å±‚ã€‚åˆ©ç”¨TCP/IPåè®®æ—è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œä¼šé€šè¿‡åˆ†å±‚é¡ºåºä¸å¯¹æ–¹è¿›è¡Œé€šä¿¡ã€‚å‘é€ç«¯ä»åº”ç”¨å±‚å¾€ä¸‹èµ°ï¼Œæ¥æ”¶ç«¯åˆ™å¾€åº”ç”¨å±‚å¾€ä¸Šèµ°ã€‚ä¸€æ¬¡HTTPè¯·æ±‚çš„å…¸å‹è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/images/HTTP01.jpg" alt=""></p><h2 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h2><blockquote><p>URIæ˜¯Uniform Resource Identifierçš„ç¼©å†™ï¼Œæ˜¯ç”±æŸä¸ªåè®®æ–¹æ¡ˆè¡¨ç¤ºçš„èµ„æºçš„å®šä½æ ‡è¯†ç¬¦ã€‚åè®®æ–¹æ¡ˆæ˜¯æŒ‡è®¿é—®èµ„æºæ‰€ä½¿ç”¨çš„åè®®ç±»å‹åç§°ã€‚ é‡‡ç”¨HTTPåè®®æ—¶ï¼Œåè®®æ–¹æ¡ˆå°±æ˜¯httpã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ftpã€mailtoã€telnetã€fileç­‰ã€‚</p></blockquote><p>æ¯”å¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://</span><br><span class="line">ftp://</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„URLï¼ˆ<code>Uniform Resource Locator</code>ï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰è¡¨ç¤ºèµ„æºåœ¨äº’è”ç½‘ä¸Šçš„åœ°å€ï¼Œå®ƒå…¶å®æ˜¯URIçš„ä¸€ä¸ªå­é›†ï¼Œå› ä¸ºURIä»…ä»…è¡¨ç¤ºã€Œæ ‡è¯†ã€ï¼Œ æ ‡è¯†çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ISBNå·ç ï¼Œç”µè¯å·ç ï¼Œé‚®ç®±ï¼Œç½‘é¡µé“¾æ¥åœ°å€ç­‰ï¼Œè€ŒURLåˆ™æŠŠæ¦‚å¿µç¼©å°åˆ°äº†ã€Œåœ°å€ã€ã€‚ ç”±äºURIåœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½æ˜¯ä»¥URLçš„å½¢å¼å­˜åœ¨ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½è¯´URLå±…å¤šï¼Œè¿™ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨å¿ƒé‡Œè¦æ¸…æ¥šURIå’ŒURLè¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ã€‚</p><h2 id="HTTPåè®®å†…å®¹"><a href="#HTTPåè®®å†…å®¹" class="headerlink" title="HTTPåè®®å†…å®¹"></a>HTTPåè®®å†…å®¹</h2><p>æ¥ä¸‹æ¥çš„å†…å®¹åŸºäºHTTP 1.1ç‰ˆæœ¬ã€‚</p><h3 id="è¯·æ±‚-amp-å“åº”æŠ¥æ–‡ç»“æ„"><a href="#è¯·æ±‚-amp-å“åº”æŠ¥æ–‡ç»“æ„" class="headerlink" title="è¯·æ±‚ &amp; å“åº”æŠ¥æ–‡ç»“æ„"></a>è¯·æ±‚ &amp; å“åº”æŠ¥æ–‡ç»“æ„</h3><blockquote><p>åœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´ä½¿ç”¨HTTPåè®®é€šä¿¡æ—¶ï¼Œåœ¨ä¸€æ¡é€šä¿¡çº¿è·¯ä¸Šå¿…å®šæœ‰ä¸€ç«¯æ˜¯å®¢æˆ·ç«¯ï¼Œå¦ä¸€ç«¯åˆ™æ˜¯æœåŠ¡å™¨ç«¯ã€‚HTTPåè®®è§„å®šï¼Œè¯·æ±‚ä»å®¢æˆ·ç«¯å‘å‡ºï¼Œ æœ€åæœåŠ¡å™¨ç«¯å“åº”è¯¥è¯·æ±‚å¹¶è¿”å›ã€‚æ¢å¥è¯è¯´ï¼Œè‚¯å®šæ˜¯å…ˆä»å®¢æˆ·ç«¯å¼€å§‹å»ºç«‹é€šä¿¡çš„ï¼ŒæœåŠ¡å™¨ç«¯åœ¨æ²¡æœ‰æ¥æ”¶åˆ°è¯·æ±‚ä¹‹å‰ä¸ä¼šå‘é€å“åº”ã€‚</p><p>HTTPæŠ¥æ–‡æœ¬èº«æ˜¯ç”±å¤šè¡Œï¼ˆç”¨CR+LFä½œæ¢è¡Œç¬¦ï¼‰æ•°æ®æ„æˆçš„å­—ç¬¦ä¸²æ–‡æœ¬ã€‚è¯·æ±‚ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰çš„HTTPæŠ¥æ–‡å«åšè¯·æ±‚æŠ¥æ–‡ï¼Œå“åº”ç«¯ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰çš„å«åšå“åº”æŠ¥æ–‡ã€‚HTTPæŠ¥æ–‡å¤§è‡´å¯åˆ†ä¸ºæŠ¥æ–‡é¦–éƒ¨å’ŒæŠ¥æ–‡ä¸»ä½“ä¸¤å—ã€‚ ä¸¤è€…ç”±æœ€åˆå‡ºç°çš„ç©ºè¡Œï¼ˆCR+LFï¼‰æ¥åˆ’åˆ†ã€‚é€šå¸¸ï¼Œå¹¶ä¸ä¸€å®šè¦æœ‰æŠ¥æ–‡ä¸»ä½“ã€‚</p></blockquote><p><img src="/images/HTTP02.jpg" alt=""></p><p>è¯·æ±‚æŠ¥æ–‡æ˜¯ç”±è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚URIã€åè®®ç‰ˆæœ¬ã€å¯é€‰çš„è¯·æ±‚é¦–éƒ¨å­—æ®µå’Œå†…å®¹å®ä½“æ„æˆçš„ã€‚å“åº”æŠ¥æ–‡åŸºæœ¬ä¸Šç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆè¡¨ç¤ºè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥çš„æ•°å­—ä»£ç ï¼‰ã€ç”¨ä»¥è§£é‡ŠçŠ¶æ€ç çš„åŸå› çŸ­è¯­ã€å¯é€‰çš„å“åº”é¦–éƒ¨å­—æ®µä»¥åŠå®ä½“ä¸»ä½“æ„æˆã€‚ å¦‚ä¸‹æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„å®ä¾‹</p><p><img src="/images/HTTP03.jpg" alt=""></p><h3 id="å“åº”çŠ¶æ€ç "><a href="#å“åº”çŠ¶æ€ç " class="headerlink" title="å“åº”çŠ¶æ€ç "></a>å“åº”çŠ¶æ€ç </h3><blockquote><p>çŠ¶æ€ç çš„èŒè´£æ˜¯å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæè¿°è¿”å›çš„è¯·æ±‚ç»“æœã€‚å€ŸåŠ©çŠ¶æ€ç ï¼Œç”¨æˆ·å¯ä»¥çŸ¥é“æœåŠ¡å™¨ç«¯æ˜¯æ­£å¸¸å¤„ç†äº†è¯·æ±‚ï¼Œè¿˜æ˜¯å‡ºç°äº†é”™è¯¯ã€‚ æ•°å­—ä¸­çš„ç¬¬ä¸€ä½æŒ‡å®šäº†å“åº”ç±»åˆ«ï¼Œåä¸¤ä½æ— åˆ†ç±»ã€‚</p></blockquote><p>çŠ¶æ€ç ä¸»è¦ç±»å‹ä¸€è§ˆï¼š</p><p><img src="/images/HTTP04.jpg" alt=""></p><h3 id="é¦–éƒ¨-amp-å®ä½“"><a href="#é¦–éƒ¨-amp-å®ä½“" class="headerlink" title="é¦–éƒ¨ &amp; å®ä½“"></a>é¦–éƒ¨ &amp; å®ä½“</h3><blockquote><p>HTTPé¦–éƒ¨å­—æ®µæ˜¯æ„æˆHTTPæŠ¥æ–‡çš„è¦ç´ ä¹‹ä¸€ã€‚åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä»¥HTTPåè®®è¿›è¡Œé€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œæ— è®ºæ˜¯è¯·æ±‚è¿˜æ˜¯å“åº”éƒ½ä¼šä½¿ç”¨é¦–éƒ¨å­—æ®µï¼Œå®ƒèƒ½èµ·åˆ°ä¼ é€’é¢å¤–é‡è¦ä¿¡æ¯çš„ä½œç”¨ã€‚ä½¿ç”¨é¦–éƒ¨å­—æ®µæ˜¯ä¸ºäº†ç»™æµè§ˆå™¨å’ŒæœåŠ¡å™¨æä¾›æŠ¥æ–‡ä¸»ä½“å¤§å°ã€æ‰€ä½¿ç”¨çš„è¯­è¨€ã€è®¤è¯ä¿¡æ¯ç­‰å†…å®¹ã€‚</p></blockquote><p>HTTPé¦–éƒ¨å­—æ®µç”±é¦–éƒ¨å­—æ®µåå’Œå­—æ®µå€¼æ„æˆçš„ï¼Œä¸­é—´ç”¨å†’å·â€œ:â€åˆ†éš”ã€‚æ¯”å¦‚ï¼š<code>Content-Type: text/html</code>ã€‚ HTTPå®ä½“æ˜¯HTTPè¯·æ±‚å’Œå“åº”ä¼ è¾“çš„ä¸»ä½“å†…å®¹ï¼Œæ ¹æ®åœºæ™¯ä¸åŒå¯èƒ½æ˜¯è¡¨å•å‚æ•°ï¼ŒHTMLæ–‡æœ¬ï¼ŒJSONæ–‡æœ¬ï¼ŒäºŒè¿›åˆ¶æµç­‰ã€‚</p><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><blockquote><p>HTTPæ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€ï¼ˆstatelessï¼‰åè®®ã€‚<strong>HTTPåè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨HTTPè¿™ä¸ªçº§åˆ«ï¼Œåè®®å¯¹äºå‘é€è¿‡çš„è¯·æ±‚æˆ–å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†ã€‚ ä½¿ç”¨HTTPåè®®ï¼Œæ¯å½“æœ‰æ–°çš„è¯·æ±‚å‘é€æ—¶ï¼Œå°±ä¼šæœ‰å¯¹åº”çš„æ–°å“åº”äº§ç”Ÿã€‚<strong>åè®®æœ¬èº«å¹¶ä¸ä¿ç•™ä¹‹å‰ä¸€åˆ‡çš„è¯·æ±‚æˆ–å“åº”æŠ¥æ–‡çš„ä¿¡æ¯</strong>ã€‚è¿™æ˜¯ä¸ºäº†æ›´å¿«åœ°å¤„ç†å¤§é‡äº‹åŠ¡ï¼Œç¡®ä¿åè®®çš„å¯ä¼¸ç¼©æ€§ï¼Œè€Œç‰¹æ„æŠŠHTTPåè®®è®¾è®¡æˆå¦‚æ­¤ç®€å•çš„ã€‚ ä¸å¯å¦è®¤ï¼Œæ— çŠ¶æ€åè®®å½“ç„¶ä¹Ÿæœ‰å®ƒçš„ä¼˜ç‚¹ã€‚ç”±äºä¸å¿…ä¿å­˜çŠ¶æ€ï¼Œè‡ªç„¶å¯å‡å°‘æœåŠ¡å™¨çš„CPUåŠå†…å­˜èµ„æºçš„æ¶ˆè€—ã€‚ä»å¦ä¸€ä¾§é¢æ¥è¯´ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºHTTPåè®®æœ¬èº«æ˜¯éå¸¸ç®€å•çš„ï¼Œæ‰€ä»¥æ‰ä¼šè¢«åº”ç”¨åœ¨å„ç§åœºæ™¯é‡Œã€‚</p></blockquote><blockquote><p><strong>Cookieä¼šæ ¹æ®ä»æœåŠ¡å™¨ç«¯å‘é€çš„å“åº”æŠ¥æ–‡å†…çš„ä¸€ä¸ªå«åšSet-Cookieçš„é¦–éƒ¨å­—æ®µä¿¡æ¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ä¿å­˜Cookieã€‚å½“ä¸‹æ¬¡å®¢æˆ·ç«¯å†å¾€è¯¥æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­åŠ å…¥Cookieå€¼åå‘é€å‡ºå»ã€‚æœåŠ¡å™¨ç«¯å‘ç°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„Cookieåï¼Œä¼šå»æ£€æŸ¥ç©¶ç«Ÿæ˜¯ä»å“ªä¸€ä¸ªå®¢æˆ·ç«¯å‘æ¥çš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå¯¹æ¯”æœåŠ¡å™¨ä¸Šçš„è®°å½•ï¼Œæœ€åå¾—åˆ°ä¹‹å‰çš„çŠ¶æ€ä¿¡æ¯</strong>ã€‚</p></blockquote><p><img src="/images/HTTP05.png" alt=""></p><h2 id="GETå’ŒPOSTçš„åŒºåˆ«"><a href="#GETå’ŒPOSTçš„åŒºåˆ«" class="headerlink" title="GETå’ŒPOSTçš„åŒºåˆ«"></a>GETå’ŒPOSTçš„åŒºåˆ«</h2><p><strong>GETå’ŒPOSTæœ€ç›´è§‚çš„åŒºåˆ«å°±æ˜¯GETæŠŠå‚æ•°åŒ…å«åœ¨URLä¸­ï¼ŒPOSTé€šè¿‡request bodyä¼ é€’å‚æ•°</strong></p><p>W3schoolçš„è§£ç­”</p><table><thead><tr><th>æ–¹æ³•</th><th>GET</th><th>POST</th></tr></thead><tbody><tr><td>åé€€æŒ‰é’®/åˆ·æ–°</td><td>æ— å®³</td><td>æ•°æ®ä¼šè¢«é‡æ–°æäº¤ï¼ˆæµè§ˆå™¨åº”è¯¥å‘ŠçŸ¥ç”¨æˆ·æ•°æ®ä¼šè¢«é‡æ–°æäº¤ï¼‰ã€‚</td></tr><tr><td>ä¹¦ç­¾</td><td>å¯æ”¶è—ä¸ºä¹¦ç­¾</td><td>ä¸å¯æ”¶è—ä¸ºä¹¦ç­¾</td></tr><tr><td>ç¼“å­˜</td><td>èƒ½è¢«ç¼“å­˜</td><td>ä¸èƒ½ç¼“å­˜</td></tr><tr><td>ç¼–ç ç±»å‹</td><td>application/x-www-form-urlencoded</td><td>application/x-www-form-urlencoded æˆ– multipart/form-dataã€‚ä¸ºäºŒè¿›åˆ¶æ•°æ®ä½¿ç”¨å¤šé‡ç¼–ç ã€‚</td></tr><tr><td>å†å²</td><td>å‚æ•°ä¿ç•™åœ¨æµè§ˆå™¨å†å²ä¸­ã€‚</td><td>å‚æ•°ä¸ä¼šä¿å­˜åœ¨æµè§ˆå™¨å†å²ä¸­ã€‚</td></tr><tr><td>å¯¹æ•°æ®é•¿åº¦çš„é™åˆ¶</td><td>æ˜¯çš„ã€‚å½“å‘é€æ•°æ®æ—¶ï¼ŒGET æ–¹æ³•å‘ URL æ·»åŠ æ•°æ®ï¼›URL çš„é•¿åº¦æ˜¯å—é™åˆ¶çš„ï¼ˆURL çš„æœ€å¤§é•¿åº¦æ˜¯ 2048 ä¸ªå­—ç¬¦ï¼‰ã€‚</td><td>æ— é™åˆ¶ã€‚</td></tr><tr><td>å¯¹æ•°æ®ç±»å‹çš„é™åˆ¶</td><td>åªå…è®¸ ASCII å­—ç¬¦ã€‚</td><td>æ²¡æœ‰é™åˆ¶ã€‚ä¹Ÿå…è®¸äºŒè¿›åˆ¶æ•°æ®ã€‚</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸ POST ç›¸æ¯”ï¼ŒGET çš„å®‰å…¨æ€§è¾ƒå·®ï¼Œå› ä¸ºæ‰€å‘é€çš„æ•°æ®æ˜¯ URL çš„ä¸€éƒ¨åˆ†ã€‚åœ¨å‘é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯æ—¶ç»ä¸è¦ä½¿ç”¨ GET ï¼</td><td>POST æ¯” GET æ›´å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ä¸ä¼šè¢«ä¿å­˜åœ¨æµè§ˆå™¨å†å²æˆ– web æœåŠ¡å™¨æ—¥å¿—ä¸­ã€‚</td></tr><tr><td>å¯è§æ€§</td><td>æ•°æ®åœ¨ URL ä¸­å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯è§çš„ã€‚</td><td>æ•°æ®ä¸ä¼šæ˜¾ç¤ºåœ¨ URL ä¸­ã€‚</td></tr></tbody></table><p>è¿™ä¸ªå¯¹æ¯”åªæ˜¯ç»™å‡ºäº†ä¸€äº›ç°è±¡ä¸Šçš„åŒºåˆ«</p><hr><p>GETå’ŒPOSTæ˜¯ä»€ä¹ˆï¼Ÿ<strong>HTTPåè®®ä¸­çš„ä¸¤ç§å‘é€è¯·æ±‚çš„æ–¹æ³•ã€‚</strong></p><p>HTTPæ˜¯ä»€ä¹ˆï¼Ÿ<strong>HTTPæ˜¯åŸºäºTCP/IPçš„å…³äºæ•°æ®å¦‚ä½•åœ¨ä¸‡ç»´ç½‘ä¸­å¦‚ä½•é€šä¿¡çš„åè®®</strong></p><p><strong>HTTPçš„åº•å±‚æ˜¯TCP/IPã€‚æ‰€ä»¥GETå’ŒPOSTçš„åº•å±‚ä¹Ÿæ˜¯TCP/IPï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGET/POSTéƒ½æ˜¯TCPé“¾æ¥ã€‚GETå’ŒPOSTèƒ½åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ã€‚ä½ è¦ç»™GETåŠ ä¸Šrequest bodyï¼Œç»™POSTå¸¦ä¸Šurlå‚æ•°ï¼ŒæŠ€æœ¯ä¸Šæ˜¯å®Œå…¨è¡Œçš„é€šçš„</strong>ã€‚ </p><p><strong>å¦‚æœä½ ç”¨GETæœåŠ¡ï¼Œåœ¨request bodyä¸­å­˜äº†æ•°æ®ï¼Œä¸åŒæœåŠ¡å™¨çš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œæœ‰äº›æœåŠ¡å™¨ä¼šè¯»å‡ºæ•°æ®ï¼Œæœ‰äº›æœåŠ¡å™¨ç›´æ¥å¿½ç•¥ã€‚æ‰€ä»¥ï¼Œè™½ç„¶GETå¯ä»¥å¸¦request bodyï¼Œä½†ä¸èƒ½ä¿è¯ä¸€å®šèƒ½è¢«æ¥å—åˆ°</strong>ã€‚</p><h2 id="RFC"><a href="#RFC" class="headerlink" title="RFC"></a>RFC</h2><blockquote><p>å¾æ±‚æ„è§ç¨¿ï¼ˆè‹±è¯­ï¼šRequest For Commentsï¼Œç¼©å†™ä¸ºRFCï¼‰ï¼Œæ˜¯ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰å‘å¸ƒçš„ä¸€ç³»åˆ—å¤‡å¿˜å½•ã€‚æ–‡ä»¶æ”¶é›†äº†æœ‰å…³äº’è”ç½‘ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠUNIXå’Œäº’è”ç½‘ç¤¾åŒºçš„è½¯ä»¶æ–‡ä»¶ï¼Œä»¥ç¼–å·æ’å®šã€‚ç›®å‰RFCæ–‡ä»¶æ˜¯ç”±äº’è”ç½‘åä¼šï¼ˆISOCï¼‰èµåŠ©å‘è¡Œã€‚</p></blockquote><p>ç®€å•ç†è§£RFCå°±æ˜¯äº’è”ç½‘çš„è§„èŒƒï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ã€Œåè®®ã€å°±æ˜¯ä»¥RFCçš„å½¢å¼å­˜åœ¨ï¼Œè€Œç°è¡Œçš„HTTP/1.1è§„èŒƒçš„RFCæœ‰å¦‚ä¸‹å‡ ä¸ªï¼š RFC7230ï¼Œ RFC7231ï¼Œ RFC7232ï¼Œ RFC7233ï¼Œ RFC7234ï¼Œ RFC7235ã€‚ å…¶ä¸­RFC7231é‡Œçš„Section 4. Request Methodsæ¶‰åŠåˆ°äº†å‡ ä¸ªHTTPæ–¹æ³•ï¼Œæ¥ä¸‹æ¥ä»”ç»†é˜…è¯»è¿™ä¸€ç« èŠ‚ã€‚</p><blockquote><p>The request method token is the primary source of request semantics; it indicates the purpose for which the client has made this request and what is expected by the client as a successful result.</p></blockquote><p>semantic[è¯­ä¹‰]ï¼Œè¯­æ³•ä¸è¯­ä¹‰çš„åŒºåˆ«ï¼š</p><blockquote><p>ä¸€ç§è¯­è¨€æ˜¯åˆæ³•å¥å­çš„é›†åˆã€‚ä»€ä¹ˆæ ·çš„å¥å­æ˜¯åˆæ³•çš„å‘¢ï¼Ÿå¯ä»¥ä»ä¸¤æ–¹é¢æ¥åˆ¤æ–­ï¼šè¯­æ³•å’Œè¯­ä¹‰ã€‚è¯­æ³•æ˜¯å’Œæ–‡æ³•ç»“æ„æœ‰å…³ï¼Œç„¶è€Œè¯­ä¹‰æ˜¯å’ŒæŒ‰ç…§è¿™ä¸ªç»“æ„æ‰€ç»„åˆçš„å•è¯ç¬¦å·çš„æ„ä¹‰æœ‰å…³ã€‚åˆç†çš„è¯­æ³•ç»“æ„å¹¶ä¸è¡¨æ˜è¯­ä¹‰æ˜¯åˆæ³•çš„ã€‚ä¾‹å¦‚æˆ‘ä»¬å¸¸è¯´ï¼šæˆ‘ä¸Šå¤§å­¦ï¼Œè¿™ä¸ªå¥å­æ˜¯ç¬¦åˆè¯­æ³•è§„åˆ™çš„ï¼Œä¹Ÿç¬¦åˆè¯­ä¹‰è§„åˆ™ã€‚ä½†æ˜¯å¤§å­¦ä¸Šæˆ‘ï¼Œè™½ç„¶ç¬¦åˆè¯­æ³•è§„åˆ™ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥è¯´æ˜¯ä¸ç¬¦åˆè¯­ä¹‰çš„ã€‚</p></blockquote><p>å¯¹äºHTTPè¯·æ±‚æ¥è¯´ï¼Œè¯­æ³•æ˜¯æŒ‡è¯·æ±‚å“åº”çš„æ ¼å¼ï¼Œæ¯”å¦‚è¯·æ±‚ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯ æ–¹æ³•å URI åè®®/ç‰ˆæœ¬ è¿™æ ·çš„æ ¼å¼ã€‚</p><p>è¯­ä¹‰åˆ™å®šä¹‰äº†è¿™ä¸€ç±»å‹çš„è¯·æ±‚å…·æœ‰ä»€ä¹ˆæ ·çš„æ€§è´¨ã€‚æ¯”å¦‚GETçš„è¯­ä¹‰å°±æ˜¯ã€Œè·å–èµ„æºã€ï¼ŒPOSTçš„è¯­ä¹‰æ˜¯ã€Œå¤„ç†èµ„æºã€ï¼Œé‚£ä¹ˆåœ¨å…·ä½“å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶ï¼Œå°±å¿…é¡»è€ƒè™‘å…¶è¯­ä¹‰ï¼Œåšå‡ºç¬¦åˆå…¶è¯­ä¹‰çš„è¡Œä¸ºã€‚</p><p><strong>å½“ç„¶åœ¨ç¬¦åˆè¯­æ³•çš„å‰æä¸‹å®ç°è¿èƒŒè¯­ä¹‰çš„è¡Œä¸ºä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œæ¯”å¦‚ä½¿ç”¨GETæ–¹æ³•ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼ŒPOSTè·å–èµ„æºåˆ—è¡¨ï¼Œè¿™æ ·å°±åªèƒ½è¯´è¿™ä¸ªè¯·æ±‚æ˜¯ã€Œåˆæ³•ã€çš„ï¼Œä½†ä¸æ˜¯ã€Œç¬¦åˆè¯­ä¹‰ã€çš„</strong>ã€‚ </p><p>RFC7231é‡Œç´§æ¥ç€å®šä¹‰äº†HTTPæ–¹æ³•çš„å‡ ä¸ªç‰¹æ€§ï¼š</p><blockquote><p>Safe - å®‰å…¨<br>è¿™é‡Œçš„ã€Œå®‰å…¨ã€å’Œé€šå¸¸ç†è§£çš„ã€Œå®‰å…¨ã€æ„ä¹‰ä¸åŒï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•çš„è¯­ä¹‰åœ¨æœ¬è´¨ä¸Šæ˜¯ã€Œåªè¯»ã€çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±æ˜¯å®‰å…¨çš„ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„èµ„æºå‘èµ·çš„è¯·æ±‚å¦‚æœä½¿ç”¨äº†æ˜¯å®‰å…¨çš„æ–¹æ³•ï¼Œå°±ä¸åº”è¯¥å¼•èµ·æœåŠ¡ç«¯ä»»ä½•çš„çŠ¶æ€å˜åŒ–ï¼Œå› æ­¤ä¹Ÿæ˜¯æ— å®³çš„ã€‚ æ­¤RFCå®šä¹‰ï¼ŒGET, HEAD, OPTIONS å’Œ TRACE è¿™å‡ ä¸ªæ–¹æ³•æ˜¯å®‰å…¨çš„ã€‚<br>ä½†æ˜¯è¿™ä¸ªå®šä¹‰åªæ˜¯è§„èŒƒï¼Œå¹¶ä¸èƒ½ä¿è¯æ–¹æ³•çš„å®ç°ä¹Ÿæ˜¯å®‰å…¨çš„ï¼ŒæœåŠ¡ç«¯çš„å®ç°å¯èƒ½ä¼šä¸ç¬¦åˆæ–¹æ³•è¯­ä¹‰ï¼Œæ­£å¦‚ä¸Šæ–‡è¯´è¿‡çš„ä½¿ç”¨GETä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„æƒ…å†µã€‚<br>å¼•å…¥å®‰å…¨è¿™ä¸ªæ¦‚å¿µçš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç½‘ç»œçˆ¬è™«å’Œç¼“å­˜ï¼Œä»¥å…è°ƒç”¨æˆ–è€…ç¼“å­˜æŸäº›ä¸å®‰å…¨æ–¹æ³•æ—¶å¼•èµ·æŸäº›æ„å¤–çš„åæœã€‚User Agentï¼ˆæµè§ˆå™¨ï¼‰åº”è¯¥åœ¨æ‰§è¡Œå®‰å…¨å’Œä¸å®‰å…¨æ–¹æ³•æ—¶åšå‡ºåŒºåˆ†å¯¹å¾…ï¼Œå¹¶ç»™ç”¨æˆ·ä»¥æç¤ºã€‚</p><p>Idempotent - å¹‚ç­‰<br>å¹‚ç­‰çš„æ¦‚å¿µæ˜¯æŒ‡åŒä¸€ä¸ªè¯·æ±‚æ–¹æ³•æ‰§è¡Œå¤šæ¬¡å’Œä»…æ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœå®Œå…¨ç›¸åŒã€‚æŒ‰ç…§RFCè§„èŒƒï¼ŒPUTï¼ŒDELETEå’Œå®‰å…¨æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ã€‚åŒæ ·ï¼Œè¿™ä¹Ÿä»…ä»…æ˜¯è§„èŒƒï¼ŒæœåŠ¡ç«¯å®ç°æ˜¯å¦å¹‚ç­‰æ˜¯æ— æ³•ç¡®ä¿çš„ã€‚<br>å¼•å…¥å¹‚ç­‰ä¸»è¦æ˜¯ä¸ºäº†å¤„ç†åŒä¸€ä¸ªè¯·æ±‚é‡å¤å‘é€çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨è¯·æ±‚å“åº”å‰å¤±å»è¿æ¥ï¼Œå¦‚æœæ–¹æ³•æ˜¯å¹‚ç­‰çš„ï¼Œå°±å¯ä»¥æ”¾å¿ƒåœ°é‡å‘ä¸€æ¬¡è¯·æ±‚ã€‚è¿™ä¹Ÿæ˜¯æµè§ˆå™¨åœ¨åé€€/åˆ·æ–°æ—¶é‡åˆ°POSTä¼šç»™ç”¨æˆ·æç¤ºçš„åŸå› ï¼šPOSTè¯­ä¹‰ä¸æ˜¯å¹‚ç­‰çš„ï¼Œé‡å¤è¯·æ±‚å¯èƒ½ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„åæœã€‚</p><p>Cacheable - å¯ç¼“å­˜æ€§<br>é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å¯ä»¥è¢«ç¼“å­˜ï¼Œæ­¤RFCé‡ŒGETï¼ŒHEADå’ŒæŸäº›æƒ…å†µä¸‹çš„POSTéƒ½æ˜¯å¯ç¼“å­˜çš„ï¼Œä½†æ˜¯ç»å¤§å¤šæ•°çš„æµè§ˆå™¨çš„å®ç°é‡Œä»…ä»…æ”¯æŒGETå’ŒHEADã€‚</p></blockquote><p><strong>åœ¨è¿™ä¸‰ä¸ªç‰¹æ€§é‡Œä¸€ç›´åœ¨å¼ºè°ƒåŒä¸€ä¸ªäº‹æƒ…ï¼Œé‚£å°±æ˜¯åè®®ä¸ç­‰äºå®ç°ï¼šåè®®è§„å®šå®‰å…¨åœ¨å®ç°é‡Œä¸ä¸€å®šå®‰å…¨ï¼Œåè®®è§„å®šå¹‚ç­‰åœ¨å®ç°é‡Œä¸ä¸€å®šå¹‚ç­‰ï¼Œåè®®è§„å®šå¯ç¼“å­˜åœ¨å®ç°é‡Œä¸ä¸€å®šå¯ç¼“å­˜ã€‚</strong></p><h3 id="è¯­ä¹‰ä¹‹äº‰"><a href="#è¯­ä¹‰ä¹‹äº‰" class="headerlink" title="è¯­ä¹‰ä¹‹äº‰"></a>è¯­ä¹‰ä¹‹äº‰</h3><p>GETçš„è¯­ä¹‰æ˜¯è¯·æ±‚è·å–æŒ‡å®šçš„èµ„æºã€‚<strong>GETæ–¹æ³•æ˜¯å®‰å…¨ã€å¹‚ç­‰ã€å¯ç¼“å­˜çš„</strong>ï¼ˆé™¤éæœ‰ Cache-Control Headerçš„çº¦æŸï¼‰,GETæ–¹æ³•çš„æŠ¥æ–‡ä¸»ä½“æ²¡æœ‰ä»»ä½•è¯­ä¹‰ã€‚</p><p>POSTçš„è¯­ä¹‰æ˜¯æ ¹æ®è¯·æ±‚è´Ÿè·ï¼ˆæŠ¥æ–‡ä¸»ä½“ï¼‰å¯¹æŒ‡å®šçš„èµ„æºåšå‡ºå¤„ç†ï¼Œå…·ä½“çš„å¤„ç†æ–¹å¼è§†èµ„æºç±»å‹è€Œä¸åŒã€‚<strong>POSTä¸å®‰å…¨ï¼Œä¸å¹‚ç­‰ï¼Œï¼ˆå¤§éƒ¨åˆ†å®ç°ï¼‰ä¸å¯ç¼“å­˜</strong>ã€‚</p><hr><h2 id="TCPä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹"></a>TCPä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹</h2><p><img src="/images/ä¸‰æ¬¡æ¡æ‰‹.png" alt=""></p><p>TCPä½œä¸ºä¸€ç§å¯é ä¼ è¾“æ§åˆ¶åè®®,å…¶æ ¸å¿ƒæ€æƒ³:<strong>æ—¢è¦ä¿è¯æ•°æ®å¯é ä¼ è¾“,åˆè¦æé«˜ä¼ è¾“çš„æ•ˆç‡</strong></p><p><strong>ä¸‰æ¬¡æ˜¯ä¿è¯åŒæ–¹äº’ç›¸æ˜ç¡®å¯¹æ–¹èƒ½æ”¶èƒ½å‘çš„æœ€ä½å€¼</strong></p><hr><p><em>å‚è€ƒ</em></p><blockquote><p><a href="https://baike.baidu.com/item/TCP%2FIPåè®®/212915?fr=aladdin&amp;fromid=214077&amp;fromtitle=tcp%2Fip" target="_blank" rel="noopener">TCP/IPåè®® ç™¾åº¦ç™¾ç§‘</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzI3NzIzMzg3Mw==&amp;mid=100000054&amp;idx=1&amp;sn=71f6c214f3833d9ca20b9f7dcd9d33e4#rd" target="_blank" rel="noopener">99%çš„äººéƒ½ç†è§£é”™äº†HTTPä¸­GETä¸POSTçš„åŒºåˆ« </a></p><p><a href="https://sunshinevvv.coding.me/blog/2017/01/26/å›¾è§£HTTP-è¯»ä¹¦ç¬”è®°/" target="_blank" rel="noopener">å›¾è§£HTTP-è¯»ä¹¦ç¬”è®°</a></p><p><a href="http://www.w3school.com.cn/tags/html_ref_httpmethods.asp" target="_blank" rel="noopener">HTTP æ–¹æ³•ï¼šGET å¯¹æ¯” POST</a></p><p><a href="https://sunshinevvv.coding.me/blog/2017/02/09/HttpGETv.s.POST/" target="_blank" rel="noopener">HTTPåè®®ä¸­GETå’ŒPOSTæ–¹æ³•çš„åŒºåˆ«</a></p><p><a href="https://www.zhihu.com/question/24853633" target="_blank" rel="noopener">TCP ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–å››æ¬¡ï¼Ÿ</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æ„Ÿè§‰è®¡ç®—æœºç½‘ç»œè¯¾ä¸Šå­¦çš„ä¸œè¥¿å¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿˜èƒ½æ€ä¹ˆåŠï¼Œå­¦å•Šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;TCP-IP&quot;&gt;&lt;a href=&quot;#TCP-IP&quot; class=&quot;headerlink&quot; title=&quot;TCP/IP&quot;&gt;&lt;/a&gt;TCP/IP&lt;/h2&gt;&lt;p&gt;ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Transmission Control Protocol/Internet Protocolçš„ç®€å†™ï¼Œä¸­è¯‘åä¸ºä¼ è¾“æ§åˆ¶åè®®/å› ç‰¹ç½‘äº’è”åè®®ï¼Œåˆåç½‘ç»œé€šè®¯åè®®ï¼Œæ˜¯Internetæœ€åŸºæœ¬çš„åè®®ã€Internetå›½é™…äº’è”ç½‘ç»œçš„åŸºç¡€ï¼Œç”±ç½‘ç»œå±‚çš„IPåè®®å’Œä¼ è¾“å±‚çš„TCPåè®®ç»„æˆã€‚TCP/IP å®šä¹‰äº†ç”µå­è®¾å¤‡å¦‚ä½•è¿å…¥å› ç‰¹ç½‘ï¼Œä»¥åŠæ•°æ®å¦‚ä½•åœ¨å®ƒä»¬ä¹‹é—´ä¼ è¾“çš„æ ‡å‡†ã€‚åè®®é‡‡ç”¨äº†4å±‚çš„å±‚çº§ç»“æ„ï¼Œæ¯ä¸€å±‚éƒ½å‘¼å«å®ƒçš„ä¸‹ä¸€å±‚æ‰€æä¾›çš„åè®®æ¥å®Œæˆè‡ªå·±çš„éœ€æ±‚ã€‚é€šä¿—è€Œè¨€ï¼šTCPè´Ÿè´£å‘ç°ä¼ è¾“çš„é—®é¢˜ï¼Œä¸€æœ‰é—®é¢˜å°±å‘å‡ºä¿¡å·ï¼Œè¦æ±‚é‡æ–°ä¼ è¾“ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®å®‰å…¨æ­£ç¡®åœ°ä¼ è¾“åˆ°ç›®çš„åœ°ã€‚è€ŒIPæ˜¯ç»™å› ç‰¹ç½‘çš„æ¯ä¸€å°è”ç½‘è®¾å¤‡è§„å®šä¸€ä¸ªåœ°å€ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="HTTP" scheme="https://hsb786.github.io/categories/HTTP/"/>
    
    
      <category term="HTTP" scheme="https://hsb786.github.io/tags/HTTP/"/>
    
  </entry>
  
</feed>
